# ä½ä»£ç å¹³å°æ•°æ®åº“é…ç½®è¯´æ˜

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†ä½ä»£ç å¹³å°çš„æ•°æ®åº“é…ç½®ï¼Œç¡®ä¿ä¸ä¸»ç³»ç»Ÿï¼ˆbackendï¼‰çš„æ•°æ®åº“é…ç½®ä¿æŒä¸€è‡´ï¼ŒåŒæ—¶ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“å®ä¾‹é¿å…å†²çªã€‚

## é…ç½®ä¿¡æ¯

### æ•°æ®åº“é…ç½®
- **æ•°æ®åº“ç±»å‹**: PostgreSQL 16.3
- **æ•°æ®åº“å**: `lowcode_platform`
- **ç”¨æˆ·å**: `soybean`
- **å¯†ç **: `soybean@123.`
- **Dockeræ˜ å°„ç«¯å£**: `25432` (ä¸»æœº) â†’ `5432` (å®¹å™¨)
- **è¿æ¥å­—ç¬¦ä¸²**: `postgresql://soybean:soybean@123.@localhost:25432/lowcode_platform?schema=public`

### Redisé…ç½®ï¼ˆå…±ç”¨ä¸»ç³»ç»Ÿï¼‰
- **Redisç‰ˆæœ¬**: 7.2.0-v11 (redis-stack)
- **å¯†ç **: `123456`
- **ç«¯å£**: `26379` (ä¸»æœºç«¯å£)
- **æ•°æ®åº“**: `6` (é¿å…ä¸ä¸»ç³»ç»Ÿå†²çª)

### åç«¯æœåŠ¡é…ç½®
- **ç«¯å£**: `3000`
- **APIæ–‡æ¡£**: `http://localhost:3000/api-docs`

## ä¸ä¸»ç³»ç»Ÿçš„ä¸€è‡´æ€§

### ç›¸åŒé…ç½®
- âœ… æ•°æ®åº“ç”¨æˆ·å: `soybean`
- âœ… æ•°æ®åº“å¯†ç : `soybean@123.`
- âœ… RedisæœåŠ¡: å…±ç”¨ä¸»ç³»ç»ŸRedisæœåŠ¡
- âœ… Rediså¯†ç : `123456` (ä¸ä¸»ç³»ç»Ÿä¸€è‡´)
- âœ… JWTå¯†é’¥æ ¼å¼: ç»Ÿä¸€çš„å®‰å…¨å¯†é’¥æ ¼å¼

### ç‹¬ç«‹é…ç½®
- ğŸ”„ æ•°æ®åº“ç«¯å£: `25432` (é¿å…ä¸ä¸»ç³»ç»Ÿçš„ `5432` å†²çª)
- ğŸ”„ æ•°æ®åº“å: `lowcode_platform` (ç‹¬ç«‹çš„æ•°æ®åº“)
- ğŸ”„ Redisæ•°æ®åº“: `6` (é¿å…ä¸ä¸»ç³»ç»Ÿçš„æ•°æ®åº“å†²çª)
- ğŸ”„ åç«¯ç«¯å£: `3000` (é¿å…ä¸ä¸»ç³»ç»Ÿçš„ `9528` å†²çª)

## æ–‡ä»¶ç»“æ„

```
lowcode-platform-backend/
â”œâ”€â”€ .env                          # ç¯å¢ƒé…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml            # Dockerç¼–æ’æ–‡ä»¶ï¼ˆä»…åŒ…å«PostgreSQLï¼‰
â”œâ”€â”€ start-services.sh             # æœåŠ¡å¯åŠ¨è„šæœ¬
â”œâ”€â”€ verify-config.sh              # é…ç½®éªŒè¯è„šæœ¬
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init/
â”‚       â””â”€â”€ 01-init-database.sql  # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ redis/                        # Redisé…ç½®æ–‡ä»¶ï¼ˆå·²åºŸå¼ƒï¼Œå…±ç”¨ä¸»ç³»ç»Ÿï¼‰
â”‚   â””â”€â”€ redis.conf               # ä¿ç•™ç”¨äºå‚è€ƒ
â””â”€â”€ logs/                        # æ—¥å¿—ç›®å½•
    â””â”€â”€ postgres/               # PostgreSQLæ—¥å¿—
```

## å¯åŠ¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-services.sh start

# ä»…å¯åŠ¨æ•°æ®åº“æœåŠ¡
./start-services.sh db-only

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./start-services.sh status

# åœæ­¢æ‰€æœ‰æœåŠ¡
./start-services.sh stop

# é‡å¯æ‰€æœ‰æœåŠ¡
./start-services.sh restart
```

### æ–¹å¼äºŒï¼šä½¿ç”¨Docker Compose
```bash
# ç¡®ä¿ä¸»ç³»ç»ŸRediså·²å¯åŠ¨
cd ../backend && docker-compose up -d redis

# å¯åŠ¨lowcodeæ•°æ®åº“æœåŠ¡
cd ../lowcode-platform-backend
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f lowcode-postgres

# åœæ­¢æœåŠ¡
docker-compose down
```

### æ–¹å¼ä¸‰ï¼šå¼€å‘æ¨¡å¼
```bash
# ç¡®ä¿ä¸»ç³»ç»ŸRediså·²å¯åŠ¨
cd ../backend && docker-compose up -d redis

# ä»…å¯åŠ¨æ•°æ®åº“
cd ../lowcode-platform-backend
docker-compose up -d lowcode-postgres

# æœ¬åœ°è¿è¡Œåç«¯æœåŠ¡
npm run start:dev
```

## æ•°æ®åº“è¿æ¥æµ‹è¯•

### ä½¿ç”¨psqlè¿æ¥
```bash
psql -h localhost -p 25432 -U soybean -d lowcode_platform
```

### ä½¿ç”¨Redis CLIè¿æ¥ï¼ˆå…±ç”¨ä¸»ç³»ç»Ÿï¼‰
```bash
redis-cli -h localhost -p 26379 -a "123456"
```

## ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | å€¼ | è¯´æ˜ |
|--------|----|----|
| `DATABASE_URL` | `postgresql://soybean:soybean@123.@localhost:25432/lowcode_platform?schema=public` | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² |
| `PORT` | `3000` | åç«¯æœåŠ¡ç«¯å£ |
| `REDIS_HOST` | `localhost` | Redisä¸»æœºåœ°å€ï¼ˆå…±ç”¨ä¸»ç³»ç»Ÿï¼‰ |
| `REDIS_PORT` | `26379` | Redisç«¯å£ï¼ˆå…±ç”¨ä¸»ç³»ç»Ÿï¼‰ |
| `REDIS_PASSWORD` | `123456` | Rediså¯†ç ï¼ˆä¸ä¸»ç³»ç»Ÿä¸€è‡´ï¼‰ |
| `JWT_SECRET` | `JWT_SECRET-lowcode-platform@123456!@#.` | JWTå¯†é’¥ |

## ç«¯å£æ˜ å°„è¡¨

| æœåŠ¡ | å®¹å™¨ç«¯å£ | ä¸»æœºç«¯å£ | è¯´æ˜ |
|------|----------|----------|------|
| PostgreSQL | 5432 | 25432 | æ•°æ®åº“æœåŠ¡ï¼ˆç‹¬ç«‹ï¼‰ |
| Redis | - | 26379 | ç¼“å­˜æœåŠ¡ï¼ˆå…±ç”¨ä¸»ç³»ç»Ÿï¼‰ |
| Backend API | 3000 | 3000 | åç«¯APIæœåŠ¡ |

## æ•°æ®åº“åˆå§‹åŒ–

æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ `database/init/01-init-database.sql` åŒ…å«ï¼š
- æ—¶åŒºè®¾ç½®ä¸º `Asia/Shanghai`
- å¿…è¦çš„PostgreSQLæ‰©å±•
- å®¡è®¡æ—¥å¿—è¡¨å’Œè§¦å‘å™¨
- æ€§èƒ½ç›‘æ§è§†å›¾
- å®ç”¨å‡½æ•°

## æ•…éšœæ’é™¤

### ç«¯å£å†²çª
å¦‚æœç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ï¼š
1. ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„
2. åœæ­¢å ç”¨ç«¯å£çš„æœåŠ¡
3. ä½¿ç”¨ `lsof -i :ç«¯å£å·` æŸ¥çœ‹å ç”¨è¿›ç¨‹

### æ•°æ®åº“è¿æ¥å¤±è´¥
1. æ£€æŸ¥Dockerå®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
4. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²åˆ›å»º

### Redisè¿æ¥å¤±è´¥
1. æ£€æŸ¥ä¸»ç³»ç»ŸRedisæœåŠ¡çŠ¶æ€
2. ç¡®ä¿ä¸»ç³»ç»Ÿå·²å¯åŠ¨ï¼š`cd ../backend && docker-compose up -d redis`
3. éªŒè¯å¯†ç é…ç½®ï¼ˆåº”ä¸º123456ï¼‰
4. æ£€æŸ¥ç«¯å£26379æ˜¯å¦å¼€æ”¾

## ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—
```bash
# æŸ¥çœ‹PostgreSQLæ—¥å¿—
docker-compose logs -f lowcode-postgres

# æŸ¥çœ‹ä¸»ç³»ç»ŸRedisæ—¥å¿—
cd ../backend && docker-compose logs -f redis

# æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
docker-compose logs -f lowcode-backend
```

### æ•°æ®åº“å¤‡ä»½
```bash
# å¤‡ä»½æ•°æ®åº“
docker-compose exec lowcode-postgres pg_dump -U soybean lowcode_platform > backup.sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T lowcode-postgres psql -U soybean lowcode_platform < backup.sql
```

### æ€§èƒ½ç›‘æ§
- æ•°æ®åº“è¿æ¥æ•°ç›‘æ§
- Rediså†…å­˜ä½¿ç”¨ç›‘æ§
- APIå“åº”æ—¶é—´ç›‘æ§

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šè¯·ä¿®æ”¹é»˜è®¤å¯†ç 
2. **ç½‘ç»œå®‰å…¨**ï¼šé…ç½®é˜²ç«å¢™è§„åˆ™
3. **æ•°æ®åŠ å¯†**ï¼šå¯ç”¨TLSè¿æ¥
4. **è®¿é—®æ§åˆ¶**ï¼šé™åˆ¶æ•°æ®åº“è®¿é—®IP
5. **å®šæœŸå¤‡ä»½**ï¼šè®¾ç½®è‡ªåŠ¨å¤‡ä»½ç­–ç•¥
