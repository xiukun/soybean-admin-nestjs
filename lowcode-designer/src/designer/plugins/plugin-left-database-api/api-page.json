{
  "type": "page",
  "body": [
    {
      "type": "flex",
      "id": "u:b9404f57fe0f",
      "items": [
        {
          "type": "container",
          "body": [
            {
              "type": "button",
              "label": "添加",
              "onEvent": {
                "click": {
                  "actions": [
                    {
                      "ignoreError": false,
                      "actionType": "dialog",
                      "dialog": {
                        "type": "dialog",
                        "title": "新建接口",
                        "body": [
                          {
                            "id": "u:e5b61ae886a7",
                            "type": "form",
                            "title": "表单",
                            "mode": "horizontal",
                            "dsType": "api",
                            "feat": "Insert",
                            "body": [
                              {
                                "name": "name",
                                "label": "接口名称",
                                "type": "input-text",
                                "id": "u:45712d36b65a",
                                "required": true
                              },
                              {
                                "name": "apiPath",
                                "label": "请求地址",
                                "type": "input-text",
                                "id": "u:db761df40d4a",
                                "required": true
                              },
                              {
                                "name": "method",
                                "label": "请求方法",
                                "type": "select",
                                "id": "u:09c594faf35f",
                                "multiple": false,
                                "required": true,
                                "selectFirst": false,
                                "creatable": false,
                                "options": [
                                  {
                                    "label": "GET",
                                    "value": "GET"
                                  },
                                  {
                                    "label": "POST",
                                    "value": "POST"
                                  },
                                  {
                                    "label": "OPTIONS",
                                    "value": "OPTIONS"
                                  },
                                  {
                                    "label": "PUT",
                                    "value": "PUT"
                                  },
                                  {
                                    "label": "PATCH",
                                    "value": "PATCH"
                                  },
                                  {
                                    "label": "DELETE",
                                    "value": "DELETE"
                                  }
                                ],
                                "value": "GET"
                              }
                            ],
                            "actions": [],
                            "resetAfterSubmit": false,
                            "closeDialogOnSubmit": false,
                            "preventEnterSubmit": true
                          }
                        ],
                        "showCloseButton": true,
                        "showErrorMsg": true,
                        "showLoading": true,
                        "className": "app-popover",
                        "actions": [
                          {
                            "type": "button",
                            "actionType": "cancel",
                            "label": "取消",
                            "id": "u:804c2b23b1fc"
                          },
                          {
                            "type": "button",
                            "actionType": "confirm",
                            "label": "确认",
                            "primary": true,
                            "id": "u:40eb4dd98c59",
                            "onEvent": {
                              "click": {
                                "weight": 0,
                                "actions": [
                                  {
                                    "ignoreError": false,
                                    "actionType": "validate",
                                    "componentId": "u:e5b61ae886a7",
                                    "outputVar": "validateResult"
                                  },
                                  {
                                    "ignoreError": false,
                                    "actionType": "custom",
                                    "script": "\nconst validate = !event.data?.validateResult?.errors;\nif (!validate) {\n  return false;\n};\nconst apiData = localStorage.getItem('AG_API_DATA');\nlet apiList = [];\nif (apiData) {\n  apiList = JSON.parse(apiData) || [];\n};\nconst obj = apiList.find(item => item.name == context.props.data?.name);\nif (obj) {\n  const myMsg = '数据源id已存在';\n  doAction({\n    actionType: 'toast',\n    args: {\n      msg: myMsg,\n      level: 'warning'\n    }\n  });\n} else {\n  const obj = context.props.data;\n  apiList.push({ ...context.props.data, id: obj.method+'::'+obj.apiPath});\n  localStorage.setItem('AG_API_DATA', JSON.stringify(apiList));\n  const myMsg = '添加成功';\n  doAction({\n    actionType: 'toast',\n    args: {\n      msg: myMsg,\n      level:'success'\n    }\n  });\n};\ndoAction({ actionType: 'closeDialog' });\nreturn true;\n\n",
                                    "args": {}
                                  },
                                  {
                                    "componentId": "u:84efffa4e68e",
                                    "groupType": "component",
                                    "actionType": "reload"
                                  }
                                ]
                              }
                            },
                            "close": false,
                            "hidden": false,
                            "visible": true
                          }
                        ],
                        "id": "u:9e5c4ff4a972",
                        "actionType": "dialog",
                        "closeOnOutside": false,
                        "closeOnEsc": false,
                        "draggable": true
                      }
                    }
                  ]
                }
              },
              "id": "u:ac5229283399",
              "icon": ""
            },
            {
              "type": "button",
              "label": "刷新",
              "onEvent": {
                "click": {
                  "actions": [
                    {
                      "componentId": "u:84efffa4e68e",
                      "groupType": "component",
                      "actionType": "reload"
                    }
                  ]
                }
              },
              "id": "u:fe81a0213f5d",
              "className": "px-1"
            }
          ],
          "size": "xs",
          "style": {
            "position": "static",
            "display": "flex",
            "flex": "1 1 auto",
            "flexGrow": 1,
            "flexBasis": "auto",
            "flexWrap": "nowrap",
            "justifyContent": "flex-end"
          },
          "wrapperBody": false,
          "isFixedHeight": false,
          "isFixedWidth": false,
          "id": "u:746c9db55090"
        }
      ],
      "style": {
        "position": "relative"
      }
    },
    {
      "type": "service",
      "body": [
        {
          "type": "table",
          "columns": [
            {
              "name": "name",
              "type": "text",
              "placeholder": "-",
              "id": "u:591c79806856"
            }
          ],
          "id": "apiTableList",
          "source": "$rows",
          "itemActions": [
            {
              "label": "",
              "type": "button",
              "onEvent": {
                "click": {
                  "actions": [
                    {
                      "ignoreError": false,
                      "actionType": "dialog",
                      "dialog": {
                        "type": "dialog",
                        "title": "编辑接口",
                        "body": [
                          {
                            "id": "u:746a8433bc75",
                            "type": "form",
                            "title": "表单",
                            "mode": "horizontal",
                            "dsType": "api",
                            "feat": "Insert",
                            "body": [
                              {
                                "type": "hidden",
                                "name": "id",
                                "id": "u:4eafe92453cb",
                                "label": "ID",
                                "required": true
                              },
                              {
                                "name": "name",
                                "label": "接口名称",
                                "type": "input-text",
                                "id": "u:352327914b99",
                                "required": true
                              },
                              {
                                "name": "apiPath",
                                "label": "请求地址",
                                "type": "input-text",
                                "id": "u:949a982b0bce",
                                "required": true
                              },
                              {
                                "name": "method",
                                "label": "请求方法",
                                "type": "select",
                                "id": "u:0b16cbf35814",
                                "multiple": false,
                                "required": true,
                                "selectFirst": false,
                                "creatable": false,
                                "options": [
                                  {
                                    "label": "get",
                                    "value": "get"
                                  },
                                  {
                                    "label": "post",
                                    "value": "post"
                                  },
                                  {
                                    "label": "options",
                                    "value": "options"
                                  },
                                  {
                                    "label": "put",
                                    "value": "put"
                                  },
                                  {
                                    "label": "patch",
                                    "value": "patch"
                                  },
                                  {
                                    "label": "delete",
                                    "value": "delete"
                                  }
                                ],
                                "value": "get"
                              }
                            ],
                            "actions": [],
                            "resetAfterSubmit": false,
                            "closeDialogOnSubmit": false,
                            "preventEnterSubmit": true
                          }
                        ],
                        "showCloseButton": true,
                        "showErrorMsg": true,
                        "showLoading": true,
                        "className": "app-popover",
                        "actions": [
                          {
                            "type": "button",
                            "actionType": "cancel",
                            "label": "取消",
                            "id": "u:a890f5cc4c05"
                          },
                          {
                            "type": "button",
                            "actionType": "confirm",
                            "label": "确认",
                            "primary": true,
                            "id": "u:fb2701d759bb",
                            "onEvent": {
                              "click": {
                                "weight": 0,
                                "actions": [
                                  {
                                    "ignoreError": false,
                                    "actionType": "validate",
                                    "componentId": "u:746a8433bc75",
                                    "outputVar": "validateResult"
                                  },
                                  {
                                    "ignoreError": false,
                                    "actionType": "custom",
                                    "script": "\nconst validate = !event.data?.validateResult?.errors;\nif (!validate) {\n  return false;\n};\nconst apiData = localStorage.getItem('AG_API_DATA');\nlet apiList = [];\nif (apiData) {\n  apiList = JSON.parse(apiData) || [];\n};\nconst index = apiList.findIndex(item => item.id == context.props.data?.id);\nif (index>=0) {\n  const obj = context.props.data;\n  apiList[index] = { ...context.props.data, id: obj.method+'::'+obj.apiPath};\n  localStorage.setItem('AG_API_DATA', JSON.stringify(apiList));\n  const myMsg = '编辑成功';\n  doAction({\n    actionType: 'toast',\n    args: {\n      msg: myMsg,\n      level: 'success'\n    }\n  });\n  doAction({ actionType: 'closeDialog' });\n} else {\n  const myMsg = '编辑失败';\n  doAction({\n    actionType: 'toast',\n    args: {\n      msg: myMsg,\n      level: 'error'\n    }\n  });\n  return false;\n};\nreturn true;\n\n",
                                    "args": {}
                                  },
                                  {
                                    "componentId": "u:84efffa4e68e",
                                    "groupType": "component",
                                    "actionType": "reload"
                                  }
                                ]
                              }
                            },
                            "close": false,
                            "hidden": false,
                            "visible": true
                          }
                        ],
                        "id": "u:3bf558606145",
                        "closeOnOutside": false,
                        "closeOnEsc": false,
                        "actionType": "dialog",
                        "draggable": true
                      }
                    }
                  ]
                }
              },
              "id": "u:3023bd139f44",
              "icon": "fa fa-edit"
            },
            {
              "label": "",
              "type": "button",
              "onEvent": {
                "click": {
                  "actions": [
                    {
                      "ignoreError": false,
                      "script": "const apiData = localStorage.getItem('AG_API_DATA');\nlet apiList = JSON.parse(apiData) || [];\nconst index = apiList.findIndex(item => item.id == context.props.data?.id);\napiList.splice(index, 1);\nlocalStorage.setItem('AG_API_DATA', JSON.stringify(apiList));",
                      "actionType": "custom"
                    },
                    {
                      "componentId": "u:84efffa4e68e",
                      "ignoreError": false,
                      "actionType": "reload"
                    }
                  ]
                }
              },
              "id": "u:429c833a0aee",
              "icon": "fa fa-trash-o"
            }
          ],
          "showHeader": false,
          "visible": true,
          "placeholder": "暂无数据"
        }
      ],
      "id": "u:84efffa4e68e",
      "dsType": "api",
      "dataProvider": "const json = localStorage.getItem('AG_API_DATA');\nconst rows = JSON.parse(json) || [];\nsetData({ rows });",
      "name": "loadApiDataService"
    }
  ],
  "regions": ["body"],
  "id": "u:39e3fa83567c",
  "pullRefresh": {
    "disabled": true
  },
  "definitions": {},
  "className": "overflow-auto"
}
