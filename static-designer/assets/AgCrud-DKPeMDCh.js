import{b as le,d as be,L as ye,dN as Fe,dO as ge,$ as k,af as D,c as F,dz as Ce,aQ as Ie,dP as Z,dM as V,be as Se,Q as se,b7 as Ae,cb as Pe,b_ as Oe,h as de,aY as Te,a7 as ce,f as N,cc as W,dQ as j,ae as T,dF as ee,dR as ue,a_ as _e,dS as ke,dT as De,ap as xe,cn as te,aL as Me,au as pe,w as he,dU as Be,at as K,al as fe,aZ as Re,dV as we,a as re,M as ve,dW as ne,R as P,ag as Y,E as Ee,B as ae,I as ie,as as me,aJ as Qe,_ as oe,T as Ne,a4 as Le,bp as Ue,dX as qe}from"./amis-CX4p0iDy.js";import{aJ as Ve}from"./amis-editor-sioseBVH.js";import{o as We}from"./omitBy-DyySdvxR.js";import{p as je}from"./partition-BgtHcPC_.js";import"./react-vendor-DeqkGhWy.js";import"./index-ChmYUKkS.js";import"./index-C4jr8rYc.js";var He=["selectedChange","columnSort","columnFilter","columnSearch","columnToggled","orderChange","rowClick","rowDbClick","rowMouseEnter","rowMouseLeave","selected"],$e=function(x){le(f,x);function f(r){var e=x.call(this,r)||this;e.filterOnEvent=Ie(function(d){return We(d,function(c,p){return!He.includes(p)})}),e.controlRef=e.controlRef.bind(e),e.handleFilterReset=e.handleFilterReset.bind(e),e.handleFilterSubmit=e.handleFilterSubmit.bind(e),e.handleFilterInit=e.handleFilterInit.bind(e),e.handleAction=e.handleAction.bind(e),e.handleBulkAction=e.handleBulkAction.bind(e),e.handleChangePage=e.handleChangePage.bind(e),e.handleBulkGo=e.handleBulkGo.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e.handleDialogClose=e.handleDialogClose.bind(e),e.handleItemChange=e.handleItemChange.bind(e),e.handleSave=e.handleSave.bind(e),e.handleSaveOrder=e.handleSaveOrder.bind(e),e.handleSelect=e.handleSelect.bind(e),e.handleChildPopOverOpen=e.handleChildPopOverOpen.bind(e),e.handleChildPopOverClose=e.handleChildPopOverClose.bind(e),e.search=e.search.bind(e),e.silentSearch=e.silentSearch.bind(e),e.handleQuery=e.handleQuery.bind(e),e.renderHeaderToolbar=e.renderHeaderToolbar.bind(e),e.renderFooterToolbar=e.renderFooterToolbar.bind(e),e.clearSelection=e.clearSelection.bind(e),e.filterItemIndex=e.filterItemIndex.bind(e);var t=r.location,n=r.store,i=r.pageField,a=r.perPageField,o=r.syncLocation;r.loadDataOnce;var l=e.getParseQueryOptions(r);e.mounted=!0,o&&t&&(t.query||t.search)?n.updateQuery(Z(t,l),void 0,i,a):o&&!t&&window.location.search&&n.updateQuery(Z(window.location,l),void 0,i,a),e.props.store.setFilterTogglable(!!e.props.filterTogglable,e.props.filterDefaultVisible),e.props.api&&e.props.store.updateData({items:[]});var s;return e.props.pickerMode&&(s=V(e.props))&&e.syncSelectedFromPicker(s),e}return f.prototype.componentDidMount=function(){var r=this.props,e=r.store,t=r.autoGenerateFilter,n=r.perPageField;r.columns,this.props.perPage&&!e.query[n||"perPage"]&&e.changePage(e.page,this.props.perPage),(!this.props.filter&&!t||e.filterTogggable&&!e.filterVisible)&&this.handleFilterInit({}),this.parentContainer=this.getClosestParentContainer()},f.prototype.componentDidUpdate=function(r){var e,t=this.props,n=r.store;Se(["toolbar","headerToolbar","footerToolbar","bulkActions"],r,t)&&(this.renderHeaderToolbar=this.renderHeaderToolbar.bind(this),this.renderFooterToolbar=this.renderFooterToolbar.bind(this));var i;this.props.pickerMode&&!se(i=V(this.props),V(r))&&!se(i,n.selectedItems.concat())&&this.syncSelectedFromPicker(i),!!this.props.filterTogglable!=!!r.filterTogglable&&n.setFilterTogglable(!!t.filterTogglable,t.filterDefaultVisible);var a=!1;if(r.syncLocation&&r.location&&r.location.search!==t.location.search&&(n.updateQuery(Z(t.location,this.getParseQueryOptions(t)),void 0,t.pageField,t.perPageField),a=!!(t.api&&Ae(n.query,this.lastQuery,!1))),!a){if(r.api&&t.api&&Pe(r.api,t.api,n.fetchCtxOf(r.data,{pageField:r.pageField,perPageField:r.perPageField}),n.fetchCtxOf(t.data,{pageField:t.pageField,perPageField:t.perPageField})))a=!0;else if(!t.api&&Oe(t.source)&&t.data!==r.data){var o=de(t.source,t.data,"| raw");(!this.lastData||this.lastData!==o)&&(n.initFromScope(t.data,t.source,{columns:(e=n.columns)!==null&&e!==void 0?e:t.columns}),this.props.pickerMode&&(i=V(this.props))&&this.syncSelectedFromPicker(i),this.lastData=o)}}a&&this.search()},f.prototype.componentWillUnmount=function(){var r,e;this.mounted=!1,clearTimeout(this.timer),(e=(r=this.filterOnEvent.cache).clear)===null||e===void 0||e.call(r)},f.prototype.getParseQueryOptions=function(r){var e,t=r.parsePrimitiveQuery,n={parsePrimitive:!!(Te(t)?t!=null&&t.enable:t),primitiveTypes:(e=t==null?void 0:t.types)!==null&&e!==void 0?e:["boolean"]};return n},f.prototype.getClosestParentContainer=function(){var r=ce.findDOMNode(this),e=r==null?void 0:r.closest("[role=dialog]");return e},f.prototype.controlRef=function(r){for(;r&&r.getWrappedInstance;)r=r.getWrappedInstance();this.control=r},f.prototype.handleAction=function(r,e,t,n,i){var a=this;n===void 0&&(n=!1);var o=this.props,l=o.onAction,s=o.store,d=o.messages,c=o.pickerMode,p=o.env;o.pageField;var v=o.stopAutoRefreshWhenModalIsOpen;if(!s.loading)if(e.actionType==="dialog"){s.setCurrentAction(e,this.props.resolveDefinitions);var m=t.index,y=s.items.length;return v&&clearTimeout(this.timer),new Promise(function(A){s.openDialog(t,{hasNext:m<y-1,nextIndex:m+1,hasPrev:m>0,prevIndex:m-1,index:m},function(g,I){var b;(b=e.callback)===null||b===void 0||b.call(e,g,I),A({confirmed:g,value:I})},i||a.context)})}else if(e.actionType==="ajax"){s.setCurrentAction(e,this.props.resolveDefinitions);var u=t,h=e.redirect&&N(e.redirect,u);return h&&e.blank&&p.jumpTo(h,e,u),W(e.api,u)?s.saveRemote(e.api,u,{successMessage:e.messages&&e.messages.success||d&&d.saveSuccess,errorMessage:e.messages&&e.messages.failed||d&&d.saveFailed}).then(function(A){return k(a,void 0,void 0,function(){var g,I;return D(this,function(b){switch(b.label){case 0:return g=T(t,A),e.feedback&&ee(e.feedback,g)?[4,this.openFeedback(e.feedback,g)]:[3,2];case 1:b.sent(),v&&clearTimeout(this.timer),b.label=2;case 2:return I=e.redirect&&N(e.redirect,g),I&&!e.blank&&p.jumpTo(I,e,g),e.reload?this.reloadTarget(j(e.reload,g),g):I||this.search(void 0,void 0,!0,!0),e.close&&this.closeTarget(e.close),[2]}})})}).catch(function(A){if(n||e.countDown)throw A}):void 0}else if(e.actionType==="reload"&&!e.target)this.reload();else{if(c&&(e.actionType==="confirm"||e.actionType==="submit"))return s.setCurrentAction(e,this.props.resolveDefinitions),Promise.resolve({items:s.selectedItems.concat()});if(e.onClick){s.setCurrentAction(e,this.props.resolveDefinitions);var C=e.onClick;typeof C=="string"&&(C=ue(C,"event","props","data")),C&&C(r,this.props,t)}else l(r,e,t,n,i||this.context)}},f.prototype.handleBulkAction=function(r,e,t,n){var i=this,a,o=this.props,l=o.store,s=o.primaryField,d=o.onAction,c=o.messages,p=o.pageField,v=o.stopAutoRefreshWhenModalIsOpen,m=o.env;if(!(!r.length&&n.requireSelected!==!1)){var y=r.map(function(A){return A.hasOwnProperty(s)?A[s]:null}).filter(function(A){return A}).join(","),u=_e([l.mergedData,{event:t},F(F(F({},r[0]),l.eventContext),{currentPageData:(((a=l.mergedData)===null||a===void 0?void 0:a.items)||[]).concat(),rows:r,items:r,ids:y})]),h=function(){if(n.actionType==="dialog")return i.handleAction(t,F(F({},n),{__from:"bulkAction"}),u);n.actionType==="ajax"?W(n.api,u)&&l.saveRemote(n.api,u,{successMessage:n.messages&&n.messages.success||c&&c.saveSuccess,errorMessage:n.messages&&n.messages.failed||c&&c.saveFailed}).then(function(A){return k(i,void 0,void 0,function(){var g,I,b;return D(this,function(S){switch(S.label){case 0:return g=T(u,A),n.feedback&&ee(n.feedback,g)?[4,this.openFeedback(n.feedback,g)]:[3,2];case 1:S.sent(),v&&clearTimeout(this.timer),S.label=2;case 2:return n.reload?this.reloadTarget(j(n.reload,g),g):this.search((b={},b[p||"page"]=1,b),void 0,!0,!0),n.close&&this.closeTarget(n.close),I=n.redirect&&N(n.redirect,g),I&&m.jumpTo(I,n,g),[2]}})})}).catch(function(){return null}):d&&d(t,n,u,!1,i.context)},C="";!n.ignoreConfirm&&n.confirmText&&m.confirm&&(C=N(n.confirmText,u))?m.confirm(C,N(n.confirmTitle,u)||void 0).then(function(A){return A&&h()}):h()}},f.prototype.handleItemAction=function(r,e){this.doAction(r,e)},f.prototype.handleFilterInit=function(r){var e,t=this.props,n=t.defaultParams,i=t.columns,a=t.matchFunc,o=t.store,l=t.orderBy,s=t.orderDir;t.dispatchEvent;var d=F({},n);l&&(d.orderBy=l,d.orderDir=s||"asc"),this.handleFilterSubmit(F(F(F({},d),r),o.query),!1,!0,this.props.initFetch!==!1,!0),o.setPristineQuery();var c=this.props,p=c.pickerMode,v=c.options;if(p){o.initFromScope({items:v||[]},"${items}",{columns:(e=o.columns)!==null&&e!==void 0?e:i,matchFunc:a});var m=void 0;(m=V(this.props))&&this.syncSelectedFromPicker(m)}},f.prototype.handleFilterReset=function(r,e){var t=this.props,n=t.store,i=t.syncLocation,a=t.env,o=t.pageField,l=t.perPageField,s={};Object.keys(r).forEach(function(d){return s[d]=""}),n.updateQuery(F(F({},s),n.pristineQuery),i&&a&&a.updateLocation?function(d){return a.updateLocation(d)}:void 0,o,l,!0),this.lastQuery=n.query,!(e!=null&&e.actionType&&["reset-and-submit","clear-and-submit","submit"].includes(e.actionType))&&this.search()},f.prototype.handleFilterSubmit=function(r,e,t,n,i){var a,o,l;e===void 0&&(e=!0),t===void 0&&(t=!1),n===void 0&&(n=!0),i===void 0&&(i=!1);var s=this.props,d=s.store,c=s.syncLocation,p=s.env,v=s.pageField,m=s.perPageField,y=s.loadDataOnceFetchOnFilter,u=s.parsePrimitiveQuery,h=this.getParseQueryOptions(this.props);r=F(F({},r),Ve((l=(o=r==null?void 0:r.__super)===null||o===void 0?void 0:o.diff)!==null&&l!==void 0?l:{},function(C){return C===void 0})),r=c?ke(ge(r,void 0,!0)):r,u&&(r=De(r,h)),d.updateQuery(F(F({},r),(a={},a[v||"page"]=e?1:d.page,a)),c&&p&&p.updateLocation?function(C){return p.updateLocation(C,t)}:void 0,v,m),this.lastQuery=d.query,n&&this.search(void 0,void 0,void 0,y!==!1,i)},f.prototype.handleBulkGo=function(r,e,t){var n=this,i=this.props.store.selectedAction,a=this.props.env,o="";return i.confirmText&&(o=N(i.confirmText,this.props.store.mergedData))?a.confirm(o).then(function(l){return l&&n.handleBulkAction(r,e,t,i)}):this.handleBulkAction(r,e,t,i)},f.prototype.handleDialogConfirm=function(r,e,t,n){var i,a,o,l,s=this.props,d=s.store,c=s.pageField,p=s.stopAutoRefreshWhenModalIsOpen,v=s.interval,m=s.silentPolling,y=s.env;d.closeDialog(!0,r);var u=d.action;if(p&&v&&(this.timer=setTimeout(m?this.silentSearch:this.search,Math.max(v,1e3))),e.actionType==="next"&&typeof t.nextIndex=="number"&&d.data.items[t.nextIndex])return this.handleAction(void 0,F({},u),T(T(d.data,{index:t.nextIndex}),d.data.items[t.nextIndex]));if(e.actionType==="prev"&&typeof t.prevIndex=="number"&&d.data.items[t.prevIndex])return this.handleAction(void 0,F({},u),T(T(d.data,{index:t.prevIndex}),d.data.items[t.prevIndex]));if(r.length){var h=r[0];t=T(t,h);var C=n[0];if(C&&C.props.type==="form")if(h&&h.__saved){var A=(a=e.reload)!==null&&a!==void 0?a:u.reload;A||this.search(u.__from?(i={},i[c||"page"]=1,i):void 0,void 0,!0,!0)}else h&&(h.hasOwnProperty("items")&&h.items||h.hasOwnProperty("ids"))&&this.control.bulkUpdate&&this.control.bulkUpdate(h,h.items)}var g=(o=e.reload)!==null&&o!==void 0?o:u.reload;g&&this.reloadTarget(j(g,t),t);var I=(l=e.redirect)!==null&&l!==void 0?l:u.redirect;I=I&&N(I,t),I&&y.jumpTo(I,u,t)},f.prototype.handleDialogClose=function(r){r===void 0&&(r=!1);var e=this.props,t=e.store,n=e.stopAutoRefreshWhenModalIsOpen,i=e.silentPolling,a=e.interval;t.closeDialog(r),n&&a&&(this.timer=setTimeout(i?this.silentSearch:this.search,Math.max(a,1e3)))},f.prototype.openFeedback=function(r,e){var t=this;return new Promise(function(n){var i=t.props.store;i.setCurrentAction({type:"button",actionType:"dialog",dialog:r},t.props.resolveDefinitions),i.openDialog(e,void 0,function(a){n(a)},t.context)})},f.prototype.search=function(r,e,t,n,i){var a,o,l,s;return n===void 0&&(n=!1),i===void 0&&(i=!1),k(this,void 0,void 0,function(){var d,c,p,v,m,y,u,h,C,A,g,I,b,S,_,M,E,H,B,L,R,$,O,G,U,q,z,w,w,J,X;return D(this,function(Q){switch(Q.label){case 0:return d=this.props,c=d.store,p=d.api,v=d.messages,m=d.pageField,y=d.perPageField,u=d.interval,h=d.stopAutoRefreshWhen,C=d.stopAutoRefreshWhenModalIsOpen,A=d.silentPolling,g=d.syncLocation,I=d.syncResponse2Query,b=d.pickerMode,S=d.env,_=d.loadDataOnce,M=d.loadDataOnceFetchOnFilter,E=d.source,H=d.columns,B=d.dispatchEvent,t&&!b&&c.resetSelection(),L="",r&&typeof r.loadDataMode=="string"&&(L="load-more",delete r.loadDataMode),clearTimeout(this.timer),r&&c.updateQuery(r,!L&&g&&S&&S.updateLocation?S.updateLocation:void 0,m,y),this.lastQuery=c.query,R=T(c.data,c.query),$=!((a=this.props)===null||a===void 0)&&a.matchFunc&&typeof this.props.matchFunc=="string"?ue(this.props.matchFunc,"items","itemsRaw","options"):void 0,W(p,R)?[4,c.fetchInitData(p,R,{successMessage:v&&v.fetchSuccess,errorMessage:v&&v.fetchFailed,autoAppend:!0,forceReload:n,loadDataOnce:_,source:E,silent:e,pageField:m,perPageField:y,loadDataMode:L,syncResponse2Query:I,columns:(o=c.columns)!==null&&o!==void 0?o:H,matchFunc:$,filterOnAllColumns:M===!1})]:[3,8];case 1:return O=Q.sent(),xe(c)?(G=c.page,U=c.lastPage,q=c.msg,z=c.error,i?[4,B==null?void 0:B("fetchInited",T(this.props.data,{responseData:O!=null&&O.ok?(l=c.data)!==null&&l!==void 0?l:{}:O,responseStatus:(O==null?void 0:O.status)===void 0?z?1:0:O==null?void 0:O.status,responseMsg:q}))]:[3,3]):[2,O];case 2:return w=Q.sent(),w!=null&&w.prevented?[2,c.data]:[3,5];case 3:return[4,B==null?void 0:B("research",T(this.props.data,{responseData:O!=null&&O.ok?R??{}:O,responseStatus:(O==null?void 0:O.status)===void 0?z?1:0:O==null?void 0:O.status,responseMsg:q}))];case 4:if(w=Q.sent(),w!=null&&w.prevented)return[2];Q.label=5;case 5:return!_&&!c.data.items.length&&!u&&G>1&&U<G?[4,this.search(F(F({},c.query),(X={},X[m||"page"]=U,X)),!1,void 0)]:[3,7];case 6:Q.sent(),Q.label=7;case 7:return O!=null&&O.ok&&u&&this.mounted&&(!h||!(C&&c.hasModalOpened||te(h,T(c.data,c.query))))&&(this.timer=setTimeout(A?this.silentSearch.bind(this,void 0,void 0,!0):this.search.bind(this,void 0,void 0,void 0,!0),Math.max(u,1e3))),[3,9];case 8:E&&c.initFromScope(R,E,{columns:(s=c.columns)!==null&&s!==void 0?s:H,matchFunc:$}),Q.label=9;case 9:return this.props.pickerMode&&(J=V(this.props))&&this.syncSelectedFromPicker(J),[2,c.data]}})})},f.prototype.silentSearch=function(r,e,t){return t===void 0&&(t=!1),this.search(r,!0,e,t)},f.prototype.handleChangePage=function(r,e,t){var n;return k(this,void 0,void 0,function(){var i,a,o,l,s,d,c,p,v,m,y,u,h,C,A;return D(this,function(g){switch(g.label){case 0:return i=this.props,a=i.store,o=i.syncLocation,l=i.env,s=i.pageField,d=i.perPageField,c=i.pageDirectionField,p=i.autoJumpToTopOnPagerChange,v=i.translate,m=i.api,y=i.loadDataOnce,m&&!y&&(!((n=this.control)===null||n===void 0)&&n.hasModifiedItems())?[4,Me(v("CRUD.confirmLeaveUnSavedPage"))]:[3,2];case 1:if(u=g.sent(),!u)return[2];g.label=2;case 2:return h=(A={},A[s||"page"]=r,A),t&&(h[c||"pageDir"]=t),e&&(h[d||"perPage"]=e),a.updateQuery(h,o&&(l!=null&&l.updateLocation)?l.updateLocation:void 0,s,d),this.search(void 0,void 0,void 0),p&&this.control&&(this.control.scrollToTop?this.control.scrollToTop():(ce.findDOMNode(this.control).scrollIntoView(),C=window.scrollY,C&&window.scroll(0,C))),[2]}})})},f.prototype.syncSelectedFromPicker=function(r){var e=this.props,t=e.store,n=e.primaryField,i=e.strictMode,a=function(l,s){var d=l[n||"id"],c=s[n||"id"],p=i?d===c:d==c;return!!(l===s||d&&p)},o=r.map(function(l){var s;return pe(l)||(l=(s={},s[n||"id"]=l,s)),he(t.items,function(d){return a(d,l)})||l});this.props.store.setSelectedItems(o)},f.prototype.handleItemChange=function(r,e,t){var n=this.props.store,i="".concat(t).split(".").map(function(o){return parseInt(o,10)}),a=Be(n.items,i,1,r);n.replaceItems(a)},f.prototype.handleSave=function(r,e,t,n,i,a){var o=this,l=this.props,s=l.store,d=l.quickSaveApi,c=l.quickSaveItemApi,p=l.primaryField,v=l.env,m=l.messages,y=l.reload,u=l.dispatchEvent;if(Array.isArray(r)){if(!W(d)){v&&v.alert("CRUD quickSaveApi is required");return}var h=T(s.data,{rows:r,rowsDiff:e,indexes:t,rowsOrigin:i});return r.length&&r[0].hasOwnProperty(p||"id")&&(h.ids=r.map(function(g){return g[p||"id"]}).join(",")),n&&(h.unModifiedItems=n),s.saveRemote(d,h,{successMessage:m&&m.saveSuccess,errorMessage:m&&m.saveFailed}).then(function(g){return k(o,void 0,void 0,function(){var I,b,S;return D(this,function(_){switch(_.label){case 0:return g?[4,u==null?void 0:u("quickSaveSucc",K(h,{result:g}))]:[2];case 1:return I=_.sent(),I!=null&&I.prevented?[2]:(b=(S=a==null?void 0:a.reload)!==null&&S!==void 0?S:y,[2,b?this.reloadTarget(j(b,h),h):this.search(void 0,void 0,!0,!0)])}})})}).catch(function(g){return k(o,void 0,void 0,function(){return D(this,function(I){switch(I.label){case 0:return[4,u==null?void 0:u("quickSaveFail",T(this.props.data,{error:g}))];case 1:return I.sent(),[2]}})})})}else{if(!W(c)){v&&v.alert("CRUD quickSaveItemApi is required!");return}var C=T(s.data,{item:r,modified:e,origin:i}),A=T(C,r);return s.saveRemote(c,A).then(function(g){return k(o,void 0,void 0,function(){var I,b,S;return D(this,function(_){switch(_.label){case 0:return g?[4,u==null?void 0:u("quickSaveItemSucc",K(C,{result:g}))]:[2];case 1:return I=_.sent(),I!=null&&I.prevented?[2]:(b=(S=a==null?void 0:a.reload)!==null&&S!==void 0?S:y,[2,b?this.reloadTarget(j(b,C),C):this.search(void 0,void 0,!0,!0)])}})})}).catch(function(g){return k(o,void 0,void 0,function(){return D(this,function(I){switch(I.label){case 0:return a!=null&&a.resetOnFailed&&this.control.reset(),[4,u==null?void 0:u("quickSaveItemFail",T(this.props.data,{error:g}))];case 1:return I.sent(),[2]}})})})}},f.prototype.handleSaveOrder=function(r,e){var t=this,n=this.props,i=n.store,a=n.saveOrderApi,o=n.orderField,l=n.primaryField,s=n.env,d=n.reload,c=n.dispatchEvent;if(!a){s&&s.alert("CRUD saveOrderApi is required!");return}var p=T(i.data),v,m,y=[],u=l&&e[0]&&e[0].hasOwnProperty(l);if(u||(p.idMap={}),p.insertAfter={},e.forEach(function(b){if(~r.indexOf(b))if(v){var S=u?v[l]:e.indexOf(v);p.insertAfter[S]=p.insertAfter[S]||[],u||(p.idMap[S]=v),p.insertAfter[S].push(u?b[l]:b)}else y.push(b);else v=b,m=m||b}),m&&y.length){var h=u?m[l]:e.indexOf(m);u||(p.idMap[h]=m),p.insertBefore={},p.insertBefore[h]=y.map(function(b){return u?b[l]:b})}else if(y.length){var C=y[0],A=u?C[l]:e.indexOf(C);u||(p.idMap[A]=C),p.insertAfter[A]=y.slice(1).map(function(b){return u?b[l]:b})}if(o){var g=(i.page-1)*i.perPage||0;e=fe(e,function(b,S,_){var M;return K(b,(M={},M[o]=(_===1?g:0)+S+1,M))})}if(p.rows=e.concat(),u){var I=function(b){return b.map(function(S){return"".concat(S[l]).concat(Array.isArray(S.children)&&S.children.length?"[".concat(I(S.children),"]"):"")}).join(",")};p.ids=I(e),o&&(p.order=fe(e,function(b){return Re(b,[l,o,"children"])}))}return W(a,p)&&i.saveRemote(a,p).then(function(b){return k(t,void 0,void 0,function(){var S;return D(this,function(_){switch(_.label){case 0:return b?[4,c==null?void 0:c("saveOrderSucc",K(p,{result:b}))]:[2];case 1:return S=_.sent(),S!=null&&S.prevented?[2]:(d&&this.reloadTarget(j(d,p),p),this.search(void 0,void 0,!0,!0),[2])}})})}).catch(function(b){return k(t,void 0,void 0,function(){return D(this,function(S){switch(S.label){case 0:return[4,c==null?void 0:c("saveOrderFail",T(this.props.data,{error:b}))];case 1:return S.sent(),[2]}})})})},f.prototype.handleSelect=function(r,e){var t=this.props,n=t.store,i=t.keepItemSelectionOnPageChange,a=t.primaryField,o=t.multiple,l=t.pickerMode,s=t.strictMode,d=t.onSelect,c=r;if(i&&n.selectedItems.length){var p;n.items.length>r.length+e.length?p=function(y,u){return(y.__pristine||y)===(u.__pristine||u)}:p=function(y,u){var h=y[a||"id"],C=u[a||"id"],A=s?h===C:h==C;return y===u||h&&A};var v=r.concat();c=n.selectedItems.map(function(y){var u=v.findIndex(function(h){return p(h,y)});return~u?v.splice(u,1)[0]:he(e,function(h){return p(h,y)})?null:y}).filter(function(y){return y}).concat(v)}var m=n.items.filter(function(y){return!c.find(function(u){return(u.__pristine||u)===y})}).map(function(y){return e.find(function(u){return u.__pristine===y})||y});l&&o===!1&&c.length>1&&m.push.apply(m,c.splice(0,c.length-1)),n.setSelectedItems(c),n.setUnSelectedItems(m),d&&d(c,m)},f.prototype.handleChildPopOverOpen=function(r){this.props.interval&&r&&~["dialog","drawer"].indexOf(r.mode)&&(this.props.stopAutoRefreshWhenModalIsOpen&&clearTimeout(this.timer),this.props.store.setInnerModalOpened(!0))},f.prototype.handleChildPopOverClose=function(r){var e=this.props,t=e.stopAutoRefreshWhenModalIsOpen,n=e.silentPolling,i=e.interval;r&&~["dialog","drawer"].indexOf(r.mode)&&(this.props.store.setInnerModalOpened(!1),t&&i&&(this.timer=setTimeout(n?this.silentSearch:this.search,Math.max(i,1e3))))},f.prototype.handleQuery=function(r,e,t,n,i){var a,o=this.props,l=o.store,s=o.syncLocation,d=o.env,c=o.pageField,p=o.perPageField,v=o.loadDataOnceFetchOnFilter;return l.updateQuery(n?F((a={},a[c||"page"]=1,a),r):r,s&&d&&d.updateLocation?d.updateLocation:void 0,c,p,t),this.search(void 0,void 0,i??t,e??v===!0)},f.prototype.reload=function(r,e,t,n,i,a){return e?this.receive(e,void 0,i,a==null?void 0:a.resetPage,!0):this.search(void 0,void 0,!0,!0)},f.prototype.receive=function(r,e,t,n,i){return this.handleQuery(r,!0,t,n,i)},f.prototype.reloadTarget=function(r,e){},f.prototype.closeTarget=function(r){},f.prototype.doAction=function(r,e,t,n){var i;return t===void 0&&(t=!1),k(this,void 0,void 0,function(){var a,o,l;return D(this,function(s){switch(s.label){case 0:return a=this.props.store,r.actionType&&["submitQuickEdit","toggleExpanded","setExpanded","initDrag","cancelDrag","selectAll","clearAll"].includes(r.actionType)?[2,(i=this.control)===null||i===void 0?void 0:i.doAction(r,e,t,n)]:[3,1];case 1:return r.actionType!=="select"?[3,3]:[4,we(a.items,e,n==null?void 0:n.index,n==null?void 0:n.condition)];case 2:return o=s.sent(),l=a.items.filter(function(d){return!o.includes(d)}),[2,this.handleSelect(o,l)];case 3:return[2,this.handleAction(void 0,r,e,t)]}})})},f.prototype.unSelectItem=function(r,e){var t=this.props.store,n=t.selectedItems.concat(),i=t.unSelectedItems.concat(),a=n.indexOf(r);~a&&i.push.apply(i,n.splice(a,1)),t.setSelectedItems(n),t.setUnSelectedItems(i)},f.prototype.clearSelection=function(){var r=this.props,e=r.store,t=r.itemCheckableOn,n=re(je(e.selectedItems,function(l){return!t||te(t,l)}),2),i=n[0],a=n[1],o=e.unSelectedItems.concat(i);e.setSelectedItems(a),e.setUnSelectedItems(o)},f.prototype.hasBulkActionsToolbar=function(){var r=this.props,e=r.headerToolbar,t=r.footerToolbar,n=function(i){return~["bulkActions","bulk-actions"].indexOf(i.type||i)};return Array.isArray(e)&&ve(e,n)||Array.isArray(t)&&ve(t,n)},f.prototype.hasBulkActions=function(){var r=this.props,e=r.bulkActions;r.itemActions;var t=r.store;if(!e||!e.length)return!1;var n=[],i=t.mergedData;return e&&e.length&&(n=e.map(function(a){return F(F({},a),ne(a,i))}).filter(function(a){return!a.hidden&&a.visible!==!1})),n.length},f.prototype.renderBulkActions=function(r){var e=this,t,n=this.props,i=n.bulkActions,a=n.itemActions,o=n.store,l=n.render,s=n.classnames,d=n.primaryField;if(!i||!i.length)return null;var c=o.selectedItems,p=o.unSelectedItems,v=[],m=[],y=T(o.mergedData,F(F({currentPageData:(((t=o.mergedData)===null||t===void 0?void 0:t.items)||[]).concat()},o.eventContext),{rows:c.concat(),items:c.concat(),ids:c.map(function(h){return h.hasOwnProperty(d)?h[d]:null}).filter(function(h){return h}).join(",")}));i&&i.length&&(!a||!a.length||c.length>1)&&(v=i.map(function(h){return F(F({},h),ne(h,y))}).filter(function(h){return!h.hidden&&h.visible!==!1}));var u=T(o.data,c.length?c[0]:{});return a&&c.length<=1&&(m=a.map(function(h){return F(F({},h),ne(h,u))}).filter(function(h){return!h.hidden&&h.visible!==!1})),v.length||m.length?P.createElement("div",{className:s("Crud-actions")},v.map(function(h,C){return l("bulk-action/".concat(C),F(F({},Y(h,["visibleOn","hiddenOn","disabledOn"])),{type:h.type||"button",ignoreConfirm:!0}),{key:"bulk-".concat(C),data:y,disabled:h.disabled||(h.requireSelected!==!1?!c.length:!1),onAction:e.handleBulkAction.bind(e,c.concat(),p.concat())})}),m.map(function(h,C){return l("bulk-action/".concat(C),F(F({},Y(h,["visibleOn","hiddenOn","disabledOn"])),{type:"button"}),{key:"item-".concat(C),data:u,disabled:h.disabled||c.length!==1,onAction:e.handleItemAction.bind(e,h,u)})})):null},f.prototype.renderPagination=function(r){var e=this.props,t=e.store,n=e.render,i=e.classnames,a=e.alwaysShowPagination,o=e.perPageAvailable,l=e.testIdBuilder,s=t.page,d=t.lastPage;if(t.mode!=="simple"&&t.lastPage<2&&!a)return null;var c={};if(Array.isArray(o)&&(c.perPageAvailable=o),typeof r!="string"){Object.assign(c,r);var p=r.showPageInput;c.showPageInput=p===!0||d>9&&p==null,c.total=de(r.total,t.data)}else c.showPageInput=d>9;return P.createElement("div",{className:i("Crud-pager")},n("pagination",{type:"pagination",testIdBuilder:l==null?void 0:l.getChild("pagination")},F(F({},c),{activePage:s,lastPage:d,hasNext:t.hasNext,mode:t.mode,perPage:t.perPage,popOverContainer:this.parentContainer,onPageChange:this.handleChangePage})))},f.prototype.renderStatistics=function(){var r=this.props,e=r.store,t=r.classnames,n=r.translate,i=r.alwaysShowPagination;return e.lastPage<=1&&!i?null:P.createElement("div",{className:t("Crud-statistics")},n("CRUD.stat",{page:e.page,lastPage:e.lastPage,total:e.total}))},f.prototype.renderSwitchPerPage=function(r){var e=this,t=this.props,n=t.mobileUI,i=t.store,a=t.perPageAvailable,o=t.classnames,l=t.classPrefix,s=t.translate,d=t.testIdBuilder,c=r.items;if(!c.length)return null;var p=n?(a||[5,10,20,50,100]).map(function(v){return{label:v+" 条/页",value:v+""}}):(a||[5,10,20,50,100]).map(function(v){return{label:v,value:v+""}});return P.createElement("div",{className:o("Crud-pageSwitch")},n?null:P.createElement("span",null,s("CRUD.perPage")),P.createElement(Ee,{classPrefix:l,searchable:!1,placeholder:s("Select.placeholder"),options:p,value:i.perPage+"",onChange:function(v){return e.handleChangePage(1,v.value)},clearable:!1,popOverContainer:this.parentContainer,testIdBuilder:d==null?void 0:d.getChild("perPage")}))},f.prototype.renderLoadMore=function(){var r=this,e=this.props,t=e.store,n=e.classPrefix,i=e.classnames,a=e.translate,o=e.testIdBuilder,l=t.page,s=t.lastPage;return P.createElement("div",{className:i("Crud-loadMore")},P.createElement(ae,F({disabled:l>=s,disabledTip:a("CRUD.loadMoreDisableTip"),classPrefix:n,onClick:function(){return r.search({page:l+1,loadDataMode:"load-more"})},size:"sm"},o==null?void 0:o.getChild("loadMore").getTestId()),a("CRUD.loadMore")))},f.prototype.renderFilterToggler=function(){var r,e,t,n=this.props,i=n.store,a=n.classnames,o=n.translate,l=n.filterTogglable;if(!i.filterTogggable)return null;var s=pe(l)?F({},l):{};return i.filterVisible&&(s.icon=(r=s.activeIcon)!==null&&r!==void 0?r:s.icon,s.label=(e=s.activeLabel)!==null&&e!==void 0?e:s.label),P.createElement("button",{onClick:function(){return i.setFilterVisible(!i.filterVisible)},className:a("Button Button--size-default Button--default",{"is-active":i.filterVisible})},s.icon?P.createElement(ie,{icon:s.icon,className:"icon m-r-xs"}):(s==null?void 0:s.icon)!==!1?P.createElement(ie,{icon:"filter",className:"icon m-r-xs"}):null,(t=s==null?void 0:s.label)!==null&&t!==void 0?t:o("CRUD.filter"))},f.prototype.renderExportCSV=function(r){var e=this.props,t=e.store,n=e.classPrefix,i=e.translate,a=e.loadDataOnce,o=r.api,l=r.filename;return P.createElement(ae,{classPrefix:n,onClick:function(){return t.exportAsCSV({loadDataOnce:a,api:o,filename:l,data:t.filterData})}},r.label||i("CRUD.exportCSV"))},f.prototype.renderToolbar=function(r,e,t,n){var i=this;if(e===void 0&&(e=0),t===void 0&&(t={}),!r)return null;var a=this.props,o=a.render,l=a.store,s=a.mobileUI,d=a.translate,c=a.testIdBuilder,p=a.addable,v=r.type||r;if(v==="bulkActions"||v==="bulk-actions")return this.renderBulkActions(t);if(v==="pagination")return this.renderPagination(r);if(v==="statistics")return this.renderStatistics();if(v==="switch-per-page")return this.renderSwitchPerPage(t);if(v==="load-more")return this.renderLoadMore();if(v==="filter-toggler")return this.renderFilterToggler();if(v==="export-csv")return this.renderExportCSV(r);if(v==="add-row")return p?P.createElement(ae,{onClick:function(){return i.addItem()},level:typeof p=="object"&&p.addBtnLevel?p.addBtnLevel:"default",size:"sm",className:"m-r-xs"},typeof p=="object"&&p.addBtnIcon?P.createElement(ie,{icon:p.addBtnIcon,className:"icon m-r-xs"}):null,typeof p=="object"&&p.addBtnLabel?p.addBtnLabel:d("新增行")):null;if(v==="reload"){var m={label:"",icon:"fa fa-sync",tooltip:d("reload"),tooltipPlacement:"top",type:"button"};return typeof r=="object"&&(m=F(F({},m),Y(r,["type","align"]))),o("toolbar/".concat(e),m,{onAction:function(){i.reload()}})}else if(Array.isArray(r)){var y=r.filter(function(g){return ee(g,l.toolbarData)}).map(function(g,I){return{dom:i.renderToolbar(g,I,t,n),toolbar:g}}).filter(function(g){return g.dom}),u=y.length,h=this.props.classnames;return u?P.createElement("div",F({className:h("Crud-toolbar"),key:e},c==null?void 0:c.getChild("toolbar").getTestId()),y.map(function(g,I){var b=g.toolbar,S=g.dom,_=b.type||b,M=b.align||(_==="pagination"?"right":"left");return P.createElement("div",{key:b.id||I,className:h("Crud-toolbar-item",M?"Crud-toolbar-item--".concat(M):"",{"is-mobile":s})},S)})):null}var C=n?n(r,e):void 0;if(C!==void 0)return C;var A=t.$$editable;return o("toolbar/".concat(e),r,{data:l.toolbarData,page:l.page,lastPage:l.lastPage,perPage:l.perPage,total:l.total,onQuery:this.handleQuery,onAction:this.handleAction,onChangePage:this.handleChangePage,onBulkAction:this.handleBulkAction,$$editable:A})},f.prototype.renderHeaderToolbar=function(r,e){var t=this.props,n=t.toolbar,i=t.toolbarInline,a=t.headerToolbar;return n&&(Array.isArray(a)?a=i?a.concat(n):[a,n]:a?a=[a,n]:a=n),this.renderToolbar(a||[],0,r,e)},f.prototype.renderFooterToolbar=function(r,e){var t=this.props,n=t.toolbar,i=t.toolbarInline,a=t.footerToolbar;return n&&(Array.isArray(a)?a=i?a.concat(n):[a,n]:a?a=[a,n]:a=n),this.renderToolbar(a,0,r,e)},f.prototype.renderTag=function(r,e){var t=this.props,n=t.classnames,i=t.labelField,a=t.labelTpl,o=t.primaryField,l=t.valueField;t.translate;var s=t.env,d=t.itemCheckableOn,c=d?te(d,r):!0;return P.createElement("div",{key:e,className:n("Crud-value",c?"":"is-disabled")},P.createElement("span",{className:n("Crud-valueIcon"),onClick:this.unSelectItem.bind(this,r,e)},"×"),P.createElement("span",{className:n("Crud-valueLabel")},a?P.createElement(Qe,{html:N(a,r),filterHtml:s.filterHtml}):me(r,i||"label")||me(r,l||o||"id")))},f.prototype.renderSelection=function(){var r=this,e=this.props,t=e.store,n=e.classPrefix,i=e.classnames;e.labelField,e.labelTpl,e.primaryField,e.valueField;var a=e.translate;e.env;var o=e.popOverContainer,l=e.multiple,s=e.maxTagCount,d=e.overflowTagPopover,c=e.keepItemSelectionOnPageChange;if(!t.selectedItems.length||!c||l===!1)return null;var p=t.selectedItems.length,v=t.selectedItems,m=l!==!1&&qe(s,{start:0,end:p,left:"inclusive",right:"exclusive"});return m&&(v=oe(oe([],re(t.selectedItems.slice(0,s)),!1),[{label:"+ ".concat(p-s," ..."),value:"__overflow_tag__"}],!1)),P.createElement("div",{className:i("Crud-selection")},P.createElement("div",{className:i("Crud-selectionLabel")},a("CRUD.selected",{total:t.selectedItems.length})),v.map(function(y,u){return m&&u===s?P.createElement(Ne,{key:u,container:o,tooltip:F(F({placement:"top",trigger:"hover",showArrow:!1,offset:[0,-10],tooltipClassName:i("Crud-selection-overflow",d==null?void 0:d.tooltipClassName),title:a("已选项")},Y(d,["children","content","tooltipClassName"])),{children:function(){return P.createElement("div",{className:i("".concat(n,"Crud-selection-overflow-wrapper"))},t.selectedItems.slice(s,p).map(function(h,C){var A=C+s;return r.renderTag(h,A)}))}})},P.createElement("div",{key:u,className:i("Crud-value")},P.createElement("span",{className:i("Crud-valueLabel")},y.label))):r.renderTag(y,u)}),P.createElement("a",{onClick:this.clearSelection,className:i("Crud-selectionClear")},a("clear")))},f.prototype.renderFilter=function(){var r,e=this.props,t=e.store,n=e.render,i=e.classnames,a=e.filter,o=e.translate,l=e.testIdBuilder,s=e.filterCanAccessSuperData,d=s===void 0?!0:s;return!a&&(!t.filterTogggable||t.filterVisible)?null:n("filter",F(F({title:o("CRUD.filter"),mode:"inline",submitText:o("search")},a),{type:"form",api:null,testIdBuilder:l==null?void 0:l.getChild("filter")}),{key:"filter",panelClassName:i("Crud-filter",a.panelClassName||"Panel--default"),data:t.filterData,onReset:this.handleFilterReset,onSubmit:this.handleFilterSubmit,onInit:this.handleFilterInit,formStore:void 0,canAccessSuperData:(r=a==null?void 0:a.canAccessSuperData)!==null&&r!==void 0?r:d})},f.prototype.filterItemIndex=function(r){var e,t=this.props.store,n="".concat(r).split(".").map(function(a){return parseInt(a,10)});if(!Array.isArray(t.data.items))return r;var i=(e=t.data.items)===null||e===void 0?void 0:e[n[0]];return i&&(n[0]=t.items.findIndex(function(a){return(a.__pristine||a)===(i.__pristine||i)})),n.join(".")},f.prototype.filterBodySchema=function(r){return r},f.prototype.renderBody=function(){var r=this,e,t=this.props;t.className,t.style;var n=t.bodyClassName,i=t.filter,a=t.render,o=t.store,l=t.mode;t.syncLocation,t.children;var s=t.bulkActions,d=t.pickerMode,c=t.multiple,p=t.strictMode,v=t.valueField,m=t.primaryField;t.value;var y=t.hideQuickSaveBtn,u=t.itemActions,h=t.classnames,C=t.keepItemSelectionOnPageChange,A=t.maxKeepItemSelectionLength,g=t.maxItemSelectionLength;t.onAction;var I=t.popOverContainer,b=t.translate;t.onQuery;var S=t.autoGenerateFilter;t.onSelect;var _=t.autoFillHeight,M=t.onEvent;t.onSave,t.onSaveOrder,t.onPopOverOpened,t.onPopOverClosed,t.onSearchableFromReset,t.onSearchableFromSubmit,t.onSearchableFromInit,t.headerToolbarRender,t.footerToolbarRender;var E=t.testIdBuilder,H=t.id,B=t.filterCanAccessSuperData,L=B===void 0?!0:B,R=t.selectable,$=R===void 0?!1:R,O=t.addable;t.addBtnLabel,t.addBtnIcon;var G=t.scaffold,U=Le(t,["className","style","bodyClassName","filter","render","store","mode","syncLocation","children","bulkActions","pickerMode","multiple","strictMode","valueField","primaryField","value","hideQuickSaveBtn","itemActions","classnames","keepItemSelectionOnPageChange","maxKeepItemSelectionLength","maxItemSelectionLength","onAction","popOverContainer","translate","onQuery","autoGenerateFilter","onSelect","autoFillHeight","onEvent","onSave","onSaveOrder","onPopOverOpened","onPopOverClosed","onSearchableFromReset","onSearchableFromSubmit","onSearchableFromInit","headerToolbarRender","footerToolbarRender","testIdBuilder","id","filterCanAccessSuperData","selectable","addable","addBtnLabel","addBtnIcon","scaffold"]),q=u?oe([],re(u),!1):[];return q.push({type:"button",label:b("删除"),icon:"fa fa-trash",hiddenOnHoverOn:"${!__isNewItem}",actionType:"custom",onAction:function(z,w,J){r.deleteNewItem(J)}}),a("body",F(F({},this.filterBodySchema(U)),{id:H,onEvent:this.filterOnEvent(M),columns:(e=o.columns)!==null&&e!==void 0?e:U.columns,type:l||"table",addable:O,scaffold:G}),{key:"body",className:h("Crud-body",n),ref:this.controlRef,autoGenerateFilter:!i&&S,filterCanAccessSuperData:L,autoFillHeight:_,selectable:!!(this.hasBulkActionsToolbar()&&this.hasBulkActions()||d||$),itemActions:q,multiple:c===void 0?!!(s&&s.length>0):c,selected:o.selectedItemsAsArray,strictMode:p,keepItemSelectionOnPageChange:C,maxKeepItemSelectionLength:A,maxItemSelectionLength:g,valueField:v||m,primaryField:m,hideQuickSaveBtn:y,items:o.data.items,fullItems:o.itemsAsArray,query:o.query,orderBy:o.query.orderBy,orderDir:o.query.orderDir,popOverContainer:I,onAction:this.handleAction,onItemChange:this.handleItemChange,onSave:this.handleSave,onSaveOrder:this.handleSaveOrder,onQuery:this.handleQuery,onSelect:this.handleSelect,onPopOverOpened:this.handleChildPopOverOpen,onPopOverClosed:this.handleChildPopOverClose,onSearchableFromReset:this.handleFilterReset,onSearchableFromSubmit:this.handleFilterSubmit,onSearchableFromInit:this.handleFilterInit,headerToolbarRender:this.renderHeaderToolbar,footerToolbarRender:this.renderFooterToolbar,data:o.mergedData,loading:o.loading,host:this,filterItemIndex:this.filterItemIndex,onDbClick:this.props.rowDbClick,testIdBuilder:E==null?void 0:E.getChild("body"),onAddItem:this.addItem.bind(this)})},f.prototype.addItem=function(){return k(this,void 0,void 0,function(){var r,e,t,n,i,a,o,l;return D(this,function(s){return r=this.props,e=r.scaffold,t=e===void 0?{}:e,n=r.store,r.dispatchEvent,r.primaryField,r.env,i=r.columns,a=n.items.concat(),o={},i&&Array.isArray(i)&&i.forEach(function(d){d.editable!==!1&&d.name&&(o[d.name]=null)}),l="new_".concat(Date.now(),"_").concat(Math.floor(Math.random()*1e3)),Object.assign(o,t,{__isNewItem:!0,__tempId:l}),a.push(o),n.replaceItems(a),n.updateData({items:a}),this.handleItemAction({actionType:"submitQuickEdit",type:"button"},{item:o,index:a.length-1,itemsLength:a.length}),[2,!1]})})},f.prototype.deleteNewItem=function(r){var e=this.props.store,t=e.items.concat(),n=t.findIndex(function(i){return i.__tempId===r.__tempId});return t.splice(n,1),e.replaceItems(t),e.updateData({items:t}),!1},f.prototype.render=function(){var r=this.props,e=r.className,t=r.style,n=r.render,i=r.store,a=r.classnames;r.translate;var o=r.testIdBuilder,l=r.id;return P.createElement("div",F({className:a("Crud",e,{"is-loading":i.loading,"is-mobile":Ue()}),style:t,"data-id":l,"data-role":"container"},o==null?void 0:o.getChild("wrapper").getTestId()),this.renderFilter(),this.renderSelection(),this.renderBody(),n("dialog",F(F({},i.action&&i.action.dialog),{type:"dialog"}),{key:"dialog",data:i.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:i.dialogOpen}))},f.propsList=["bulkActions","itemActions","mode","orderField","syncLocation","toolbar","toolbarInline","messages","value","options","multiple","valueField","defaultParams","bodyClassName","perPageAvailable","pageField","perPageField","pageDirectionField","hideQuickSaveBtn","autoJumpToTopOnPagerChange","interval","silentPolling","stopAutoRefreshWhen","stopAutoRefreshWhenModalIsOpen","api","affixHeader","columnsTogglable","placeholder","tableClassName","headerClassName","footerClassName","headerToolbar","footerToolbar","filterTogglable","filterDefaultVisible","autoGenerateFilter","syncResponse2Query","keepItemSelectionOnPageChange","labelTpl","labelField","loadDataOnce","loadDataOnceFetchOnFilter","source","header","columns","size","onChange","onInit","onSaved","onSave","onQuery","formStore","autoFillHeight","maxTagCount","overflowTagPopover","parsePrimitiveQuery","matchFunc"],f.defaultProps={toolbarInline:!0,headerToolbar:["bulkActions","add-row"],footerToolbar:["statistics","pagination"],primaryField:"id",syncLocation:!0,pageField:"page",perPageField:"perPage",pageDirectionField:"pageDir",hideQuickSaveBtn:!1,autoJumpToTopOnPagerChange:!0,silentPolling:!1,filterTogglable:!1,filterDefaultVisible:!0,loadDataOnce:!1,autoFillHeight:!1,parsePrimitiveQuery:!0},f}(P.Component),Ge=function(x){le(f,x);function f(r,e){var t=x.call(this,r)||this,n=e;return n.registerComponent(t),t}return f.prototype.componentWillUnmount=function(){x.prototype.componentWillUnmount.call(this);var r=this.context;r.unRegisterComponent(this)},f.prototype.reload=function(r,e,t,n,i,a){var o,l=this.context;return a!=null&&a.index||a!=null&&a.condition?(o=this.control)===null||o===void 0?void 0:o.reload("",e,t,void 0,void 0,a):r?l.reload(e?"".concat(r,"?").concat(ge(e)):r,t):x.prototype.reload.call(this,r,e,t,n,i,a)},f.prototype.receive=function(r,e,t,n,i){return k(this,void 0,void 0,function(){var a;return D(this,function(o){return a=this.context,e?[2,a.send(e,r)]:[2,x.prototype.receive.call(this,r,void 0,t,n,i)]})})},f.prototype.reloadTarget=function(r,e){var t=this.context;t.reload(r,e)},f.prototype.closeTarget=function(r){var e=this.context;e.close(r)},f.prototype.setData=function(r,e,t,n){var i,a,o;return k(this,void 0,void 0,function(){var l,s,d;return D(this,function(c){return l=this.props.store,t!==void 0||n!==void 0?[2,(a=(i=this.control)===null||i===void 0?void 0:i.setData)===null||a===void 0?void 0:a.call(i,r,e,t,n)]:(s=(r==null?void 0:r.total)||(r==null?void 0:r.count),d=(o=r.rows)!==null&&o!==void 0?o:r.items,s!==void 0&&l.updateTotal(parseInt(s,10)),[2,l.updateData(F(F({},r),d?{items:d}:{}),void 0,e)])})})},f.prototype.getData=function(){var r=this.props,e=r.store,t=r.data;return e.getData(t)},f.contextType=Ce,f}($e),tt=function(x){le(f,x);function f(){return x!==null&&x.apply(this,arguments)||this}return f=be([ye({type:"ag-crud",storeType:Fe.name,isolateScope:!0})],f),f}(Ge);export{tt as AgCRUDRenderer,Ge as AgCRUDRendererBase,$e as default};
