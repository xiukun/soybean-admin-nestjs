const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PdfViewer-BrnhAdYa.js","assets/amis-WMe1Knp9.js","assets/react-vendor-DeqkGhWy.js","assets/index-Drhytg7r.js","assets/amis-editor-DguYiGUI.js","assets/index-COnuhKgu.css"])))=>i.map(i=>d[i]);
import{R as d,a$ as b,b as _,dz as E,d as c,L as P,a2 as i,cb as S,h as g,as as f,$ as v,af as w,a1 as l}from"./amis-WMe1Knp9.js";import"./react-vendor-DeqkGhWy.js";var C=d.lazy(function(){return b(()=>import("./PdfViewer-BrnhAdYa.js"),__vite__mapDeps([0,1,2,3,4,5]))}),x=function(p){_(t,p);function t(e){var r=p.call(this,e)||this;return r.wrapper=d.createRef(),r.state={inited:!1,loading:!1,error:!1},r}return t.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},t.prototype.componentDidUpdate=function(e){var r=this,n=this.props;(S(e.src,n.src,e.data,n.data)||g(n.src,n.data,"| raw")!==g(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout(function(){r.fetchPdf()},0)),f(n.data,n.name)&&f(e.data,e.name)!==f(n.data,n.name)&&(this.abortLoad(),this.renderPdf())},t.prototype.componentWillUnmount=function(){this.abortLoad()},t.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},t.prototype.renderPdf=function(){return v(this,void 0,void 0,function(){var e,r,n,s;return w(this,function(a){switch(a.label){case 0:return e=this.props,r=e.src,n=e.name,s=e.data,this.setState({error:!1}),r?this.file?[3,2]:[4,this.fetchPdf()]:[3,3];case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return f(s,n)?[4,this.renderFormFile()]:[3,5];case 4:a.sent(),a.label=5;case 5:return[2]}})})},t.prototype.fetchPdf=function(){return v(this,void 0,void 0,function(){var e,r,n,s,a,o,m,h,y=this;return w(this,function(u){switch(u.label){case 0:if(e=this.props,r=e.env,n=e.src,s=e.data,e.translate,n&&(o=g(n,s,"| raw"),typeof o=="string"?a=o:typeof o=="object"&&typeof o.value=="string"&&(a=o.value)),!a)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,r.fetcher(a,s,{responseType:"arraybuffer",cancelExecutor:function(F){return y.fetchCancel=F}})];case 2:return m=u.sent(),this.file=m.data,this.forceUpdate(),[3,5];case 3:return h=u.sent(),this.setState({error:!0}),console.error(h),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},t.prototype.renderFormFile=function(){return v(this,void 0,void 0,function(){var e,r,n,s,a,o=this;return w(this,function(m){return e=this.props,r=e.name,n=e.data,s=f(n,r),this.setState({inited:!0,loading:!0}),s instanceof File&&(a=new FileReader,a.onload=function(h){var y=a.result;o.file=y,o.setState({loading:!1}),o.forceUpdate()},a.onerror=function(h){o.setState({error:!0})},a.readAsArrayBuffer(s),this.reader=a),[2]})})},t.prototype.renderEmpty=function(){var e=this.props,r=e.src,n=e.name;return!r&&!n?d.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},d.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),d.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"PDF viewer")):null},t.prototype.renderError=function(){var e=this.props,r=e.src,n=e.translate,s=this.state.error;return s&&r?d.createElement("div",null,n("loadingFailed")+" url:"+r):null},t.prototype.renderTip=function(){return d.createElement("div",null,d.createElement("p",null,"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."))},t.prototype.render=function(){var e=this.props;e.className,e.classnames,e.translate,e.height,e.background;var r=this.state;return r.loading,r.inited,r.error,Math.max(this.props.width||this.state.width,300),d.createElement("div",{ref:this.wrapper},this.renderEmpty(),this.renderTip(),this.renderError())},c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"abortLoad",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"renderPdf",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"fetchPdf",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],t.prototype,"renderFormFile",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderEmpty",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderError",null),c([l,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],t.prototype,"renderTip",null),t}(d.Component),L=function(p){_(t,p);function t(e,r){var n=p.call(this,e)||this,s=r;return s.registerComponent(n),n}return t.prototype.componentWillUnmount=function(){var e;(e=p.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var r=this.context;r.unRegisterComponent(this)},t.contextType=E,t=c([P({type:"pdf-viewer"}),i("design:paramtypes",[Object,Object])],t),t}(x);export{C as PdfView,L as PdfViewerRenderer,x as default};
