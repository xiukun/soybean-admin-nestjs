import{ef as fe,b as ee,$ as Z,af as q,eJ as z,eK as ge,eL as D,c as h,eM as G,dV as Q,w as ye,dK as me,bf as be,eh as X,al as Ce,M as Oe,ae as P,eN as Re,ap as Te,b_ as Fe,cc as Se,an as _e,as as Ae,R as V,eO as we,co as Y,aZ as Ie,cn as xe,ad as Me,d as O,a1 as S,a2 as r,e9 as Pe,dS as Ee}from"./amis-CpcGROCB.js";import"./react-vendor-DeqkGhWy.js";var Ne=function(R){switch(typeof R){case"string":return Ee(R,"options","inputValue","option");case"function":return R;default:return null}},Ve=function(R){ee(l,R);function l(){return R!==null&&R.apply(this,arguments)||this}return l.prototype.reload=function(){var t=this.props.reloadOptions;t==null||t()},l.prototype.handleChange=function(t,n){return Z(this,void 0,void 0,function(){var e,a,o,d,s,u,i,w,v,b,f,T,x,m,c,I,E,M,C;return q(this,function(g){switch(g.label){case 0:return e=this.props,a=e.onChange,o=e.joinValues,d=e.delimiter,s=e.valueField,u=e.extractValue,i=e.options,w=e.dispatchEvent,v=e.setOptions,b=e.selectMode,f=e.deferApi,T=e.deferField,x=T===void 0?"defer":T,m=t,c=i.concat(),Array.isArray(t)?(m=t.map(function(p){var F=z(i,D(p[s||"value"],s||"value"),{resolve:ge(s),value:p[s]||"value"});if(!F)c.push(h(h({},p),{visible:!1}));else if(n){var N=G(c,F);c=Q(c,F,1,h(h({},N),p))}return o||u?p[s||"value"]:p}),o&&(m=m.join(d||","))):t&&(m=o||u?t[s||"value"]:t,I=z(i,D(t[s||"value"],s||"value")),I?n&&(E=G(c,I),c=Q(c,I,1,h(h({},E),t))):c.push(h(h({},t),{visible:!1}))),M=b==="tree"&&(!!f||!!ye(i,function(p){return p.deferApi||p[x]})),(M===!0||c.length>i.length||n)&&v(c,!0),[4,w("change",me(this.props,{value:m,options:i,items:i}))];case 1:return C=g.sent(),C!=null&&C.prevented?[2]:(a(m),[2])}})})},l.prototype.option2value=function(t){return t},l.prototype.getResult=function(t){var n=t.data.options||t.data.items||t.data;return n},l.prototype.handleSearch=function(t,n,e){return Z(this,void 0,void 0,function(){var a,o,d,s,u,i,w,v,b,f,T,x,m,c,I,E,M;return q(this,function(C){switch(C.label){case 0:if(a=this.props,o=a.searchApi,d=a.options,s=a.labelField,u=a.valueField,i=a.env,w=a.data,v=a.translate,b=a.filterOption,!o)return[3,5];C.label=1;case 1:return C.trys.push([1,3,,4]),[4,i.fetcher(o,P(w,h({term:t},e||{})),{cancelExecutor:n})];case 2:if(f=C.sent(),!f.ok)throw new Error(v(f.msg||"networkError"));if(T=this.getResult(f),!Array.isArray(T))throw new Error(v("CRUD.invalidArray"));return x={},e&&(x={page:f.data.page,perPage:e.perPage,total:f.data.count}),[2,h({items:Ce(T,function(g){var p=null,F=g[u||"value"];return Array.isArray(d)&&F!==null&&F!==void 0&&(p=Oe(d,D(F,u)),g!=null&&g.children&&(p=h(h({},p),{children:g.children}))),p||g})},x)];case 3:return m=C.sent(),!i.isCancel(m)&&!o.silent&&i.notify("error",m.message),[2,{items:[]}];case 4:return[3,6];case 5:return t?(c=s||"label",I=u||"value",E={keys:[c,I]},b?(M=Ne(b),M?[2,{items:M(d,t,E)}]:(i.notify("error","自定义检索函数不符合要求"),[2,{items:[]}])):[2,{items:be(d,function(g,p,F,N){return!!(Array.isArray(g.children)&&g.children.length||X([g].concat(N),t,{keys:[s||"label",u||"value"],threshold:X.rankings.CONTAINS}).length)},0,!0)}]):[2,{items:d}];case 6:return[2]}})})},l.prototype.handleResultSearch=function(t,n){var e=this.props,a=e.valueField,o=e.labelField,d=Re(t),s=n[o||"label"],u=n[a||"value"];return d.test(s)||d.test(u)},l.prototype.handlePageChange=function(t,n,e){var a=this.props,o=a.source,d=a.data,s=a.formItem,u=a.onChange,i=P(d,h({page:t??1,perPage:n??10},e?{pageDir:e}:{}));!s||!Te(s)||(Fe(o)?s.loadOptionsFromDataScope(o,i,u):Se(o,i)&&s.loadOptions(o,i,void 0,!1,u,!1))},l.prototype.optionItemRender=function(t,n){var e=this.props,a=e.menuTpl,o=e.render,d=e.data;return o("item/".concat(n.index),a,{data:P(P(d,n),t)})},l.prototype.resultItemRender=function(t,n){var e=this.props,a=e.valueTpl,o=e.render,d=e.data;return o("value/".concat(n.index),a,{onChange:n.onChange,data:P(P(d,n),t)})},l.prototype.renderCell=function(t,n,e,a){var o=this.props,d=o.render,s=o.data,u=o.classnames,i=o.showInvalidMatch;return d("cell/".concat(e,"/").concat(a),h({type:"text",className:u({"is-invalid":i?n==null?void 0:n.__unmatched:!1})},t),{value:_e(t.name,n),data:P(s,n)})},l.prototype.getRef=function(t){for(;t&&t.getWrappedInstance;)t=t.getWrappedInstance();this.tranferRef=t},l.prototype.onSelectAll=function(t){var n=this.props,e=n.dispatchEvent,a=n.data;e("selectAll",P(a,{items:t}))},l.prototype.doAction=function(t,n,e){var a,o,d,s,u,i=this.props,w=i.resetValue,v=i.onChange,b=i.formStore,f=i.store,T=i.name;switch(t.actionType){case"clear":v==null||v("");break;case"reset":v==null||v((d=(o=Ae((a=b==null?void 0:b.pristine)!==null&&a!==void 0?a:f==null?void 0:f.pristine,T))!==null&&o!==void 0?o:w)!==null&&d!==void 0?d:"");break;case"selectAll":(s=this.tranferRef)===null||s===void 0||s.selectAll();break;case"clearSearch":{(u=this.tranferRef)===null||u===void 0||u.clearSearch(n);break}}},l.prototype.render=function(){var t,n,e=this.props,a=e.className;e.style;var o=e.classnames,d=e.selectedOptions,s=e.showArrow,u=e.sortable,i=e.selectMode,w=e.columns,v=e.loading,b=e.searchable,f=e.searchResultMode,T=e.searchResultColumns,x=e.deferLoad,m=e.leftMode,c=e.rightMode,I=e.disabled,E=e.selectTitle,M=e.resultTitle,C=e.menuTpl,g=e.valueTpl,p=e.searchPlaceholder,F=e.resultListModeFollowSelect,N=F===void 0?!1:F,te=e.resultSearchPlaceholder,L=e.resultSearchable,ne=L===void 0?!1:L,re=e.statistics,ae=e.labelField,le=e.valueField,ie=e.virtualThreshold,K=e.itemHeight,U=e.loadingConfig,oe=e.showInvalidMatch,se=e.onlyChildren,de=e.mobileUI,ue=e.noResultsText,_=e.pagination,y=e.formItem,j=e.env,k=e.popOverContainer,pe=e.data,H=e.autoCheckChildren,ce=H===void 0?!0:H,$=e.initiallyOpen,he=$===void 0?!0:$,ve=e.testIdBuilder,B=this.props,A=B.options,W=B.leftOptions,J=B.leftDefaultValue;return i==="associated"&&A&&A.length&&A[0].leftOptions&&Array.isArray(A[0].children)&&(W=A[0].leftOptions,J=(t=A[0].leftDefaultValue)!==null&&t!==void 0?t:J,A=A[0].children),V.createElement("div",{className:o("TransferControl",a)},V.createElement(we,{onlyChildren:se,value:d,options:A,accumulatedOptions:(n=y==null?void 0:y.accumulatedOptions)!==null&&n!==void 0?n:[],disabled:I,onChange:this.handleChange,option2value:this.option2value,sortable:u,showArrow:s,selectMode:i,searchResultMode:f,searchResultColumns:T,columns:w,onSearch:b?this.handleSearch:void 0,onDeferLoad:x,leftOptions:W,leftMode:m,rightMode:c,cellRender:this.renderCell,selectTitle:E,resultTitle:M,resultListModeFollowSelect:N,onResultSearch:this.handleResultSearch,searchPlaceholder:p,resultSearchable:ne,resultSearchPlaceholder:te,statistics:re,labelField:ae,valueField:le,optionItemRender:C?this.optionItemRender:void 0,resultItemRender:g?this.resultItemRender:void 0,onSelectAll:this.onSelectAll,onRef:this.getRef,virtualThreshold:ie,itemHeight:Y(K)>0?Y(K):void 0,loadingConfig:U,showInvalidMatch:oe,mobileUI:de,noResultsText:ue,pagination:h(h({},Ie(_,["className","layout","perPageAvailable","popOverContainerSelector"])),{enable:(_&&_.enable!==void 0?!!(typeof _.enable=="string"?xe(_.enable,pe):_.enable):!!(y!=null&&y.enableSourcePagination))&&(!i||i==="list"||i==="table")&&A.length>0,maxButtons:Number.isInteger(_==null?void 0:_.maxButtons)?_.maxButtons:5,page:y==null?void 0:y.sourcePageNum,perPage:y==null?void 0:y.sourcePerPageNum,total:y==null?void 0:y.sourceTotalNum,popOverContainer:k??(j==null?void 0:j.getModalContainer)}),onPageChange:this.handlePageChange,initiallyOpen:he,autoCheckChildren:ce,testIdBuilder:ve}),V.createElement(Me,{overlay:!0,key:"info",loadingConfig:U,show:v}))},l.defaultProps={multiple:!0},O([S,r("design:type",Function),r("design:paramtypes",[Object,Boolean]),r("design:returntype",Promise)],l.prototype,"handleChange",null),O([S,r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],l.prototype,"option2value",null),O([S,r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],l.prototype,"getResult",null),O([S,r("design:type",Function),r("design:paramtypes",[String,Function,Object]),r("design:returntype",Promise)],l.prototype,"handleSearch",null),O([S,r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",void 0)],l.prototype,"handleResultSearch",null),O([S,r("design:type",Function),r("design:paramtypes",[Number,Number,String]),r("design:returntype",void 0)],l.prototype,"handlePageChange",null),O([S,r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",void 0)],l.prototype,"optionItemRender",null),O([S,r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",void 0)],l.prototype,"resultItemRender",null),O([S,r("design:type",Function),r("design:paramtypes",[Object,Object,Number,Number]),r("design:returntype",void 0)],l.prototype,"renderCell",null),O([S,r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",void 0)],l.prototype,"getRef",null),O([S,r("design:type",Function),r("design:paramtypes",[Array]),r("design:returntype",void 0)],l.prototype,"onSelectAll",null),O([Pe(),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],l.prototype,"render",null),l}(V.Component),je=function(R){ee(l,R);function l(){return R!==null&&R.apply(this,arguments)||this}return l}(Ve),De=fe({type:"transfer"})(je);export{Ve as BaseTransferRenderer,je as TransferRender,De as default,Ne as getCustomFilterOption};
