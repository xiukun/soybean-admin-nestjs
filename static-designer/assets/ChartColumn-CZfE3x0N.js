const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-dFVf76i6.js","assets/react-vendor-DeqkGhWy.js"])))=>i.map(i=>d[i]);
import{b as R,k as N,$ as k,af as _,f as H,ae as D,c as b,aZ as I,a$ as U,a as q,dR as $,aa as Z,b3 as P,bP as K,cc as Q,e_ as X,e4 as Y,R as M,dL as B,dI as O,aT as j,dJ as ee,aq as te,cb as ae,b_ as ie,h as W,dz as re,d as ne,L as se,a2 as oe,fE as le}from"./amis-WMe1Knp9.js";import"./react-vendor-DeqkGhWy.js";var J=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],he=function(f){R(a,f);function a(e){var t=f.call(this,e)||this;return t.mounted=!1,t.refFn=t.refFn.bind(t),t.reload=t.reload.bind(t),t.reloadEcharts=N(t.reloadEcharts.bind(t),300),t.handleClick=t.handleClick.bind(t),t.dispatchEvent=t.dispatchEvent.bind(t),t}return a.prototype.componentDidMount=function(){this.mounted=!0,this.initChart()},a.prototype.componentWillUnmount=function(){this.mounted=!1,this.destroyChart()},a.prototype.initChart=function(){return k(this,void 0,void 0,function(){var e,t,i,r,h,o,l,s;return _(this,function(n){switch(n.label){case 0:return e=this.props,t=e.api,i=e.data,r=e.initFetch,h=e.initFetchOn,o=e.dispatchEvent,l=e.dataSourceType,[4,o("init",i,this)];case 1:return s=n.sent(),s!=null&&s.prevented?[2]:(t&&(r!==!1||h&&H(h,i))&&l==="api"&&this.reload(),[2])}})})},a.prototype.destroyChart=function(){if(this.reloadEcharts.cancel(),clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel),this.echarts){try{this.echarts.off("click",this.handleClick),this.echarts.off("mouseover",this.dispatchEvent),this.echarts.off("legendselectchanged",this.dispatchEvent),this.echarts.dispose()}catch(e){console.warn("清理图表实例出错:",e)}delete this.echarts}this.unSensor&&(this.unSensor(),delete this.unSensor)},a.prototype.handleClick=function(e){return k(this,void 0,void 0,function(){var t,i,r,h,o,l;return _(this,function(s){switch(s.label){case 0:return t=this.props,i=t.onAction,r=t.clickAction,h=t.data,o=t.dispatchEvent,[4,o(e.event,D(h,b({},I(e,J))))];case 1:return l=s.sent(),l!=null&&l.prevented?[2]:(r&&i&&i(null,r,D(h,e)),[2])}})})},a.prototype.dispatchEvent=function(e){var t=this.props,i=t.data,r=t.dispatchEvent;r(e.event||e.type,D(i,b({},I(e,e.type==="legendselectchanged"?["name","selected"]:J))))},a.prototype.refFn=function(e){var t=this,i=this.props.chartRef,r=this.props,h=r.chartTheme,o=r.onChartWillMount,l=r.onChartUnMount,s=r.env,n=this.props.onChartMount;e?Promise.all([U(()=>import("./index-B8Nliqbu.js").then(d=>d.i),[]),U(()=>import("./index-dFVf76i6.js").then(d=>d.i),__vite__mapDeps([0,1]))]).then(function(d){var c=q(d,2),u=c[0],v=c[1];return k(t,void 0,void 0,function(){var S,p,y=this;return _(this,function(A){switch(A.label){case 0:return window.echarts=u,window.ecStat=(v==null?void 0:v.default)||v,S="default",h&&(u.registerTheme("custom",h),S="custom"),o?[4,o(u)]:[3,2];case 1:A.sent(),A.label=2;case 2:return v.transform&&(u.registerTransform(v.transform.regression),u.registerTransform(v.transform.histogram),u.registerTransform(v.transform.clustering)),s.loadChartExtends?[4,s.loadChartExtends()]:[3,4];case 3:A.sent(),A.label=4;case 4:return this.echarts=u.init(e,S),typeof n=="string"&&(n=$(n,"chart","echarts")),n==null||n(this.echarts,u),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),p=N(function(){var m,w=e.offsetWidth,x=e.offsetHeight;(m=y.echarts)===null||m===void 0||m.resize({width:w,height:x})},100),this.unSensor=Z(e,p),i&&i(this.echarts),this.renderChart(),[2]}})})}):(i&&i(null),this.unSensor&&this.unSensor(),this.echarts&&(l==null||l(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=e},a.prototype.doAction=function(e,t){var i,r;return(r=(i=this.echarts)===null||i===void 0?void 0:i.dispatchAction)===null||r===void 0?void 0:r.call(i,b({type:e.actionType},t))},a.prototype.reload=function(e,t,i,r,h){var o,l,s,n,d,c,u;return k(this,void 0,void 0,function(){var v,S,p,y,A,m,w,x,C,L,g,z,V=this;return _(this,function(E){switch(E.label){case 0:if(v=this.props,S=v.api,p=v.env,y=v.store,A=v.translate,m=v.dataSourceType,t)return[2,this.receive(t,void 0,h)];if(!p||!p.fetcher||!Q(S,y==null?void 0:y.data)||m!=="api")return[2];w=S,clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,(o=this.echarts)===null||o===void 0||o.hideLoading()),(l=this.echarts)===null||l===void 0||l.showLoading(),E.label=1;case 1:return E.trys.push([1,4,,5]),[4,p.fetcher(w,y==null?void 0:y.data,{cancelExecutor:function(G){return V.reloadCancel=G}})];case 2:return x=E.sent(),this.mounted?x.ok?(C=K(x.data),L=C.source||C,[4,this.renderChart(this.props.config,L)]):((s=this.echarts)===null||s===void 0||s.hideLoading(),w!=null&&w.silent||p.notify("error",(d=(n=w==null?void 0:w.messages)===null||n===void 0?void 0:n.failed)!==null&&d!==void 0?d:x.msg||A("fetchFailed")),[2]):[2];case 3:return E.sent(),(c=this.echarts)===null||c===void 0||c.hideLoading(),g=this.props.interval,g&&P(g)&&(g=parseInt(g,10)),g&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(g,1e3))),[2,y==null?void 0:y.data];case 4:return z=E.sent(),p.isCancel(z)?[2]:(w!=null&&w.silent||p.notify("error",z),(u=this.echarts)===null||u===void 0||u.hideLoading(),[3,5]);case 5:return[2]}})})},a.prototype.receive=function(e,t,i){var r=this.props.store;r==null||r.updateData(e,void 0,i),this.reload()},a.prototype.renderChart=function(e,t){var i;if(e&&(this.pending=e),t&&(this.pendingCtx=t),!!this.echarts){var r=this.props.onDataFilter,h=this.props.dataFilter;!r&&typeof h=="string"&&(r=new Function("config","echarts","data","source",h)),e=e||this.pending||this.getDefaultConfig(),t=t||this.pendingCtx||this.props.data,typeof e=="string"&&(e=new Function("return "+e)()),e=this.processData(e,t);try{if(r){var o=r(e,window.echarts,t);e=o||e}}catch(d){console.warn("数据过滤器执行出错:",d)}if(e){if(this.props.tooltipShow){var l=this.props.tooltipValueFormatter;if(((i=l==null?void 0:l.trim())===null||i===void 0?void 0:i.length)>5){var s={value:void 0,dataIndex:void 0},n=function(d,c){s.value=d,s.dataIndex=c;try{return new Function("value","dataIndex",l).call(s,d,c)}catch(u){return console.warn("执行tooltipValueFormatter出错:",u),d}};e.tooltip.valueFormatter=n}else e.tooltip.valueFormatter&&delete e.tooltip.valueFormatter}try{this.props.disableDataMapping||(e=X(e,t,function(d,c){return typeof c=="function"||typeof c=="string"&&c.startsWith("function")})),this.reloadEcharts(e)}catch(d){console.warn("渲染图表出错:",d)}}}},a.prototype.reloadEcharts=function(e){var t=this;if(!(!this.echarts||!e))try{requestAnimationFrame(function(){t.mounted&&t.echarts&&t.echarts.setOption(e,t.props.replaceChartOption)})}catch(i){console.warn("更新图表配置出错:",i)}},a.prototype.removeAxis=function(e){return e&&(e.xAxis||e.yAxis)&&(delete e.xAxis,delete e.yAxis),e},a.prototype.render=function(){var e=this,t=this.props,i=t.className,r=t.width,h=t.height,o=t.classPrefix,l=t.unMountOnHidden,s=t.data,n=t.id,d=t.wrapperCustomStyle,c=t.env,u=t.themeCss,v=this.props.style||{};v.width=v.width||r||"100%",v.height=v.height||h||"300px";var S=Y(v,s);return M.createElement("div",{className:B("".concat(o,"Chart"),i,O(b(b({},this.props),{name:"baseControlClassName",id:n,themeCss:u})),O(b(b({},this.props),{name:"wrapperCustomStyle",id:n,themeCss:d}))),style:S},M.createElement(j,{unMountOnHidden:l,placeholder:"...",defaultVisible:!0,component:function(){return M.createElement("div",{className:B("".concat(o,"Chart-content"),i,O(b(b({},e.props),{name:"baseControlClassName",id:n,themeCss:u})),O(b(b({},e.props),{name:"wrapperCustomStyle",id:n,themeCss:d}))),ref:e.refFn,style:{width:"100%",height:"100%"}})}}),M.createElement(ee,b({},this.props,{config:{wrapperCustomStyle:d,id:n,themeCss:u,classNames:[{key:"baseControlClassName"}]},env:c})))},a}(M.Component);function F(f){var a,e;if(!f||typeof f!="object")return null;if(Array.isArray(f))return f;var t=["source","staticJson","items","rows","data","list"];try{for(var i=te(t),r=i.next();!r.done;r=i.next()){var h=r.value;if(Array.isArray(f[h]))return f[h]}}catch(n){a={error:n}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}if(f.result){var o=F(f.result);if(o)return o}for(var l in f){if(Array.isArray(f[l]))return f[l];var s=F(f[l]);if(s)return s}return null}function ue(f){if(!f.length)return{dimensions:[],measures:[]};var a=f[0],e=Object.keys(a),t=[],i=[];return e.forEach(function(r){var h=f.map(function(l){return l[r]}),o=h.every(function(l){return!isNaN(parseFloat(l))});o?i.push({label:r,as:r}):t.push({label:r,as:r})}),!t.length&&e.length>0&&t.push({label:e[0],as:e[0]}),!i.length&&e.length>1&&i.push({label:e[1],as:e[1]}),{dimensions:t,measures:i}}var T=function(){function f(){}return f.handleComponentUpdate=function(a,e,t,i,r,h){var o=e.interval;if(ae(a.api,e.api,a.data,e.data))return i(),!0;if(e.source&&ie(e.source)&&e.dataSourceType==="variable"){var l=a.source?W(a.source,a.data,"| raw"):null,s=W(e.source,e.data,"| raw");if(l!==s)return t(e.config,s),!0}if(e.config!==a.config)return t(e.config),!0;if(e.staticJson!==a.staticJson||e.dimensions!==a.dimensions||e.measures!==a.measures)return t(),!0;if(a.interval!==o){if(clearTimeout(r),o&&h){var n=P(o)?Number.parseInt(o):o;n&&(r=setTimeout(i,Math.max(n,1e3)))}return!0}return!1},f.processChartData=function(a,e,t){var i=t.staticJson,r=t.dimensions,h=t.measures,o=t.dataSourceType,l=t.source,s=[];if(o==="variable"&&l?e&&(s=Array.isArray(e)?e:[e]):o==="api"&&e?s=F(e)||[]:o==="staticJson"&&i&&(s=i),!Array.isArray(s)||!s.length)return a;s=s.map(function(u){return typeof u!="object"?{value:u}:u});var n=r||[],d=h||[];if((!n.length||!d.length)&&s.length>0){var c=ue(s);n.length||(n=c.dimensions),d.length||(d=c.measures)}return{config:a,dataSource:s,dimensions:n,measures:d}},f.reloadEcharts=function(a,e,t,i,r){if(!(!a||!e)){var h=t.dataSourceType,o=t.interval,l=t.replaceChartOption;try{h==="api"&&o&&(e.animation||(e.animation=!0),e.animationDuration||(e.animationDuration=300)),requestAnimationFrame(function(){Promise.resolve().then(function(){if(i&&a&&(a.setOption(e,l),r)){var s=r.offsetWidth,n=r.offsetHeight;s>0&&n>0&&a.resize()}})})}catch(s){console.warn("更新图表配置出错:",s)}}},f.createBaseChartConfig=function(a){var e=a.titleShow,t=a.titleAlignment,i=a.chartTitle,r=a.titleColor,h=a.tooltipShow,o=a.legendShow,l=a.legendAlign,s=a.legendOrient,n=a.legendType,d=a.legendPosition,c=a.legendTextStyle,u=a.colorTheme,v=a.color,S=a.colorBy,p=a.textStyle,y={textStyle:{color:(p==null?void 0:p.color)||void 0,fontSize:(p==null?void 0:p.fontSize)||void 0},tooltip:{show:h!==!1,trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{},yAxis:{},series:[],color:u==="custom"&&Array.isArray(v)&&v.length>0?v:void 0,colorBy:S||"series"};return e===!1&&o===!1&&(y.grid.top="2%"),e!==!1&&(y.title={show:!0,text:i||"",left:t||"left",textStyle:{color:r||(p==null?void 0:p.color)}}),o!==!1&&(y.legend={show:!0,align:l||"auto",orient:s||"horizontal",type:n||"plain",position:d||"top"},c&&(y.legend.textStyle=c)),y},f.configureAxis=function(a,e,t){t===void 0&&(t=!1);var i=e.xAxisShow,r=e.xAxisSplitLineShow,h=e.xAxisSplitAreaShow,o=e.xAxisInverse,l=e.xAxisLabelShow,s=e.xAxisLineShow,n=e.xAxisLabelShowOverlap,d=e.xAxisLabelRotate,c=e.axisTickStyle,u=e.yAxisShow,v=e.yAxisMinAsDataMinAndMaxAsDataMax,S=e.yAxisSplitLineShow,p=e.yAxisSplitAreaShow,y=e.yAxisFormatter,A=e.yAxisTickStyle,m=e.yAxisLabelShow,w=e.yAxisLineShow,x=e.textStyle;return t?(a.xAxis={type:"value",show:i!==!1,splitLine:{show:r===!0},splitArea:{show:h===!0},inverse:o===!0,axisLabel:{show:l!==!1,showMaxLabel:!n,showMinLabel:!n,rotate:d||0},axisLine:{show:s!==!1,lineStyle:{color:x.color||"#000",fontSize:x.fontSize||12,width:(c==null?void 0:c.width)||1}},axisTick:c||{show:!0,length:5,color:x.color||"#000",width:1}},a.yAxis={type:"category",data:[],show:u!==!1,splitLine:{show:S===!0},splitArea:{show:p===!0},axisLabel:{show:m===!0,formatter:y||void 0},axisLine:{show:w===!0,lineStyle:{color:x.color||"#000",fontSize:x.fontSize||12,width:(c==null?void 0:c.width)||1}},axisTick:A||c||{show:!0,length:5,color:x.color||"#000",width:1}}):(a.xAxis={type:"category",data:[],show:i!==!1,splitLine:{show:r===!0},splitArea:{show:h===!0},inverse:o===!0,axisLabel:{show:l!==!1,showMaxLabel:!n,showMinLabel:!n,rotate:d||0},axisLine:{show:s===!0,lineStyle:{color:x.color||"#000",fontSize:x.fontSize||12,width:1}},axisTick:c||{show:!0,length:5,color:x.color||"#000",width:1}},a.yAxis={type:"value",show:u!==!1,splitLine:{show:S===!0},splitArea:{show:p===!0},axisLabel:{show:m===!0,formatter:y||void 0},axisLine:{show:w===!0,lineStyle:{color:x.color||"#000",fontSize:x.fontSize||12,width:1}},min:v?"dataMin":void 0,max:v?"dataMax":void 0,axisTick:A||c||{show:!0,length:5,color:x.color||"#000",width:1}}),a},f.applyGradientColors=function(a,e){return e&&a.series&&a.series.forEach(function(t){var i,r;t.itemStyle={color:new Function('return function(params) { return new echarts.graphic.LinearGradient(0, 0, 0, 1, [{ offset: 0, color: "'.concat(((i=a.color)===null||i===void 0?void 0:i[0])||rgba(0,244,255,1),'" }, { offset: 1, color: "').concat(((r=a.color)===null||r===void 0?void 0:r[1])||rgba(0,77,167,1),'" }], false); }'))()}}),a},f.configureSeriesByChartType=function(a,e,t){t===void 0&&(t={});var i=b({},t);switch(a){case"line":i.type="line",i.smooth=e.asChartType==="smooth",i.areaStyle=e.asChartType==="area"?{}:void 0;break;case"area":i.type="line",i.areaStyle={};break;case"bar":i.type="bar";break;case"scatter":i.type="scatter",i.symbolSize=t.symbolSize||12;break;default:i.type=a}return i.label||(i.label={show:e.labelShow!==!1,position:e.labelPosition||"top",overflow:e.labelOverflow||"truncate",color:e.labelColor||void 0}),i.emphasis||(i.emphasis={focus:"series"}),i},f}(),de=function(f){R(a,f);function a(e){var t=f.call(this,e)||this;return t.mounted=!0,t}return a.prototype.componentDidUpdate=function(e){var t=this.props;if(t.columnType!==e.columnType||t.showLabel!==e.showLabel||t.showLegend!==e.showLegend){this.renderChart(t.config);return}T.handleComponentUpdate(e,t,this.renderChart.bind(this),this.reload.bind(this),this.timer,this.mounted)},a.prototype.getDefaultConfig=function(){var e=this.props,t=e.columnType,i=e.asChartType,r=e.labelShow,h=e.labelPosition,o=e.labelOverflow,l=e.gradientStatus,s=i||t,n=T.createBaseChartConfig(this.props);return n.tooltip&&(n.tooltip.axisPointer={type:"shadow"}),n=T.configureAxis(n,this.props,s==="horizontal"),s==="horizontal"?n.series=[{name:"",type:"bar",data:[],label:{show:r!==!1,position:h||"right",overflow:o||"truncate",color:this.props.labelColor||"#000"}}]:s==="stack"?n.series=[{name:"",type:"bar",stack:"total",label:{show:r!==!1,position:h||"top",overflow:o||"truncate",color:this.props.labelColor||"#000"},data:[]}]:n.series=[{name:"",type:"bar",data:[],label:{show:r!==!1,position:h||"top",overflow:o||"truncate",color:this.props.labelColor||"#000"}}],n=T.applyGradientColors(n,l),n},a.prototype.processData=function(e,t){var i=this,r;try{var h=T.processChartData(e,t,this.props);h.config&&(e=h.config);var o=h.dataSource,l=h.dimensions,s=h.measures;if(!Array.isArray(o)||!o.length||!l.length||!s.length)return e.xAxis.type==="category"?e.xAxis.data=[]:e.yAxis.type==="category"&&(e.yAxis.data=[]),e.series=e.series.map(function(u){return b(b({},u),{data:[]})}),e;var n=[],d=(r=l[0])===null||r===void 0?void 0:r.as;d&&o.forEach(function(u){u[d]!==void 0&&!n.includes(u[d])&&n.push(u[d])}),e.xAxis.type==="category"?e.xAxis.data=n.length?n:e.xAxis.data:e.yAxis.type==="category"&&(e.yAxis.data=n.length?n:e.yAxis.data);var c=[];return s.forEach(function(u,v){var S,p=u.as;if(p){var y=n.map(function(x){var C=o.find(function(g){return g[d]===x}),L=C&&C[p]!==void 0?C[p]:0;return{value:typeof L=="string"?parseFloat(L):L,name:x,itemStyle:(C==null?void 0:C.itemStyle)||(u==null?void 0:u.itemStyle),label:(C==null?void 0:C.label)||{}}}),A=u.chartType||"bar";if(e.series[v]){var m=b({},e.series[v]);m.data=y,m.name=u.label||p,m.emphasis=m.emphasis||{focus:"series"};var w=T.configureSeriesByChartType(A,i.props,{});m.type=w.type,w.smooth&&(m.smooth=w.smooth),m.areaStyle=w.areaStyle,w.symbolSize&&(m.symbolSize=w.symbolSize),c.push(m)}else{var m={name:u.label||p,type:A==="area"?"line":A,data:y,label:{show:i.props.labelShow!==!1,position:i.props.labelPosition||"top",overflow:i.props.labelOverflow||"truncate",color:i.props.labelColor},emphasis:{focus:"series"}};!((S=e.series[0])===null||S===void 0)&&S.stack&&(m.stack="total"),A==="area"&&(m.areaStyle={}),c.push(m)}}}),c.length&&(e.series=c),e}catch(u){return console.warn("处理数据出错:",u),e}},a.prototype.reloadEcharts=function(e){T.reloadEcharts(this.echarts,e,this.props,this.mounted,this.ref)},a.propsList=[],a}(he),ve=function(f){R(a,f);function a(e,t){var i=f.call(this,e)||this,r=t;return r.registerComponent(i),i}return a.prototype.componentWillUnmount=function(){f.prototype.componentWillUnmount.call(this);var e=this.context;e.unRegisterComponent(this)},a.prototype.setData=function(e,t){var i=this.props.store;i.updateData(e,void 0,t),this.renderChart(this.props.config,i.data)},a.prototype.getData=function(){var e=this.props.store;return e.data},a.contextType=re,a=ne([se({type:"chart-column",storeType:le.name}),oe("design:paramtypes",[Object,Object])],a),a}(de);export{de as ChartColumn,ve as ChartColumnRenderer};
