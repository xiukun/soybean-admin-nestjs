import{b as fe,dz as ge,d as T,L as Ce,a2 as c,fJ as Ke,a as $,M as z,h as x,_ as Ne,c as y,as as se,b7 as Ae,av as ue,dF as M,$ as ne,af as ie,dK as ce,e$ as Se,fK as _e,f as he,R as b,dI as V,ae as ve,aY as pe,a9 as ye,dG as W,dJ as re,a8 as Ee,a1 as N}from"./amis-CX4p0iDy.js";import"./react-vendor-DeqkGhWy.js";var we=function(D){fe(l,D);function l(e){var t=D.call(this,e)||this;t.newTabDefaultId=3;var a=e.location||window.location,n=e.tabs,i=e.source,o=e.data,r=0;if(typeof e.activeKey<"u")r=e.activeKey;else if(a&&Array.isArray(n)){var h=a.hash.substring(1),u=z(n,function(A){return A.hash===h});u?r=u.hash:e.defaultKey!==void 0?r=typeof e.defaultKey=="string"?x(e.defaultKey,e.data):e.defaultKey:e.defaultActiveKey&&(r=typeof e.defaultActiveKey=="string"?x(e.defaultActiveKey,e.data):e.defaultActiveKey),r=r||n[0]&&n[0].hash||0}var p=$(t.initTabArray(n,i,o),2),v=p[0],g=p[1];return t.state={prevKey:void 0,activeKey:t.activeKey=r,localTabs:v,isFromSource:g},t}return l.prototype.initTabArray=function(e,t,a){if(!e)return[[],!1];var n=x(t,a,"| raw");if(!Array.isArray(n))return[e,!1];e=Array.isArray(e)?e:[e];var i=[];return n.forEach(function(o){i.push.apply(i,Ne([],$(e.map(function(r){return y(y({},r),{data:o})})),!1))}),[i,!0]},l.prototype.componentDidMount=function(){var e,t;this.autoJumpToNeighbour(this.activeKey);var a=this.props,n=a.name,i=a.value,o=a.onChange,r=a.source;a.tabs;var h=a.data,u=this.state.localTabs;if(!(!n||typeof o!="function"||r))if(i=i??se(h,n),i&&Array.isArray(u)){var p=this.resolveKeyByValue(i);p!==void 0&&this.handleSelect(p)}else{var v=this.resolveTabByKey(this.activeKey);v&&i!==((e=v.value)!==null&&e!==void 0?e:v.title)&&o((t=v.value)!==null&&t!==void 0?t:v.title,n)}},l.prototype.componentDidUpdate=function(e,t){var a,n,i,o=this.props,r=this.state.localTabs,h=x(e.defaultActiveKey,e.data),u=x(o.defaultActiveKey,o.data),p=Ae({tabs:o.tabs,source:x(o.source,o.data,"| raw")},{tabs:e.tabs,source:x(e.source,e.data,"| raw")},!1);if(p){var v=$(this.initTabArray(o.tabs,o.source,o.data),2),g=v[0],A=v[1];this.setState({localTabs:g,isFromSource:A}),r=g}if(o.location&&e.location&&o.location.hash!==e.location.hash){var E=o.location.hash.substring(1);if(!E)return;var f=z(r,function(F){return F.hash===E});f&&f.hash&&f.hash!==this.state.activeKey&&this.setState({activeKey:this.activeKey=f.hash,prevKey:this.state.activeKey})}else if(Array.isArray(r)&&Array.isArray(t.localTabs)&&JSON.stringify(r.map(function(F){return F.hash}))!==JSON.stringify(t.localTabs.map(function(F){return F.hash}))){var S=this.state.activeKey,H=o.location,f=null;if(H&&Array.isArray(r)){var U=H.hash.substring(1);f=z(r,function(_){return _.hash===U})}f?S=f.hash:(!r||!r.some(function(_,Q){return _.hash?_.hash===S:Q===S}))&&(S=r&&r[0]&&r[0].hash||0),this.setState({prevKey:void 0,activeKey:this.activeKey=S})}else if(h!==u){if(u==null)return;var w=null,f=z(r,function(_){return _.hash===u});f?w=f.hash:typeof u=="number"&&r[u]&&(w=u),w!==null&&this.setState({prevKey:h,activeKey:this.activeKey=w})}this.autoJumpToNeighbour(this.activeKey);var O=this.props,J=O.name,C=O.value,k=O.onChange,Y=O.source,q=O.data;if(!(!J||typeof k!="function"||Y)){var R;C=C??se(q,J);var P=(a=e.value)!==null&&a!==void 0?a:se(e.data,e.name);if(C!==P&&(R=this.resolveKeyByValue(C))!==void 0&&R!==this.activeKey)this.handleSelect(R);else if(this.activeKey!==t.activeKey){var f=this.resolveTabByKey(this.activeKey);f&&C!==((n=f.value)!==null&&n!==void 0?n:f.title)&&k((i=f.value)!==null&&i!==void 0?i:f.title,J)}}},l.prototype.resolveTabByKey=function(e){var t=this.state.localTabs;if(Array.isArray(t))return z(t,function(a,n){return a.hash?a.hash===e:n===e})},l.prototype.resolveKeyByValue=function(e){var t=this.state.localTabs;if(Array.isArray(t)){var a=z(t,function(n){var i;return((i=n.value)!==null&&i!==void 0?i:n.title)===e});return a&&a.hash?a.hash:t.indexOf(a)}},l.prototype.autoJumpToNeighbour=function(e){var t=this.props;t.tabs;var a=t.data,n=this.state.localTabs;if(Array.isArray(n)){var i=ue(n,function(p,v){return p.hash?p.hash===e:v===e});if(n[i]&&!M(n[i],this.props.data))for(var o=n.length,r=i,h=i;r-->=0||h++<o;){var u=null;if(r>=0&&M(n[r],a)?u=n[r].hash||r:h<o&&M(n[h],a)&&(u=n[h].hash||h),u!==null){this.setState({activeKey:this.activeKey=u});break}}}},l.prototype.handleAdd=function(){var e=this,t=this.state.localTabs.concat();t.push({title:"tab".concat(this.newTabDefaultId++),body:"tab"}),this.setState({localTabs:t},function(){e.switchTo(e.state.localTabs.length-1)})},l.prototype.handleClose=function(e,t){return ne(this,void 0,void 0,function(){var a,n,i,o;return ie(this,function(r){switch(r.label){case 0:return a=this.state.localTabs.concat(),n=a==null?void 0:a.findIndex(function(h,u){var p;return e===(t?h.hash:(p=h.hash)!==null&&p!==void 0?p:u)}),n===-1?[2]:(a.splice(n,1),i=this.props.dispatchEvent,[4,i("delete",ce(this.props,{value:e}))]);case 1:return o=r.sent(),o!=null&&o.prevented?[2]:(this.setState({localTabs:a}),[2])}})})},l.prototype.handleEdit=function(e,t){var a=this.state.localTabs.concat();a[e].title=t,this.setState({localTabs:a})},l.prototype.handleDragChange=function(e){return ne(this,void 0,void 0,function(){var t,a,n=this;return ie(this,function(i){return t=this.resolveTabByKey(this.activeKey),a=this.state.localTabs.concat(),a.splice(e.newIndex,0,a.splice(e.oldIndex,1)[0]),this.setState({localTabs:a},function(){if(t){var o=a.indexOf(t);n.switchTo(o)}}),[2]})})},l.prototype.handleSelect=function(e){var t;return ne(this,void 0,void 0,function(){var a,n,i,o,r,h,u,p,v;return ie(this,function(g){switch(g.label){case 0:return a=this.props,n=a.dispatchEvent,a.data,i=a.env,o=a.onSelect,r=a.id,h=this.state.localTabs,u=h==null?void 0:h.find(function(A,E){return e===(A.hash?A.hash:E)}),u?((t=i.tracker)===null||t===void 0||t.call(i,{eventType:"tabChange",eventData:{id:r,key:e}}),[4,n("change",ce(this.props,{value:u!=null&&u.hash?u==null?void 0:u.hash:e+1}))]):[2];case 1:return p=g.sent(),p!=null&&p.prevented?[2]:(typeof e=="string"&&i?i.updateLocation("#".concat(e)):typeof this.state.activeKey=="string"&&i&&i.updateLocation("#"),this.setState({activeKey:this.activeKey=e,prevKey:this.state.activeKey}),typeof o=="string"?(v=Se(o,"key","props"),v&&v(e,this.props)):typeof o=="function"&&o(e,this.props),[2])}})})},l.prototype.doAction=function(e,t,a,n){var i=e==null?void 0:e.actionType,o=Number(n==null?void 0:n.activeKey),r=_e(o)?n==null?void 0:n.activeKey:o,h=n==null?void 0:n.deleteHash;i==="changeActiveKey"?this.handleSelect(typeof r=="number"?r-1:r):i==="deleteTab"&&this.handleClose(h,!0)},l.prototype.switchTo=function(e){var t=this.state.localTabs;Array.isArray(t)&&t[e]&&this.setState({activeKey:this.activeKey=t[e].hash||e})},l.prototype.currentIndex=function(){var e=this,t=this.state.localTabs;return Array.isArray(t)?ue(t,function(a,n){return a.hash?a.hash===e.state.activeKey:n===e.state.activeKey}):-1},l.prototype.renderTabTitle=function(e,t,a){var n=this.props.render;return typeof e=="string"||!e?he(e,a):n("tab-title/".concat(t),e,{data:y({index:t,__index:t},a)})},l.prototype.renderToolbar=function(){var e=this.props,t=e.toolbar,a=e.render,n=e.classnames,i=e.toolbarClassName,o=e.id,r=e.themeCss;return t?b.createElement("div",{className:n("Tabs-toolbar",i,V(y(y({},this.props),{name:"toolbarControlClassName",id:o,themeCss:r})))},a("toolbar",t)):null},l.prototype.renderTabs=function(){var e=this,t=this.props,a=t.classnames,n=t.classPrefix,i=t.contentClassName,o=t.linksClassName,r=t.tabRender,h=t.className,u=t.style,p=t.render,v=t.data,g=t.mode,A=t.tabsMode,E=t.unmountOnExit;t.source;var f=t.formStore,S=t.formMode,H=t.formHorizontal,U=t.subFormMode,w=t.subFormHorizontal,O=t.addable,J=t.closable,C=t.draggable,k=t.showTip,Y=t.showTipClassName,q=t.editable,R=t.sidePosition,P=t.translate,F=t.addBtnText,_=t.collapseOnExceed,Q=t.collapseBtnLabel,L=t.disabled,X=t.mobileUI,oe=t.swipeable,I=t.testIdBuilder,G=t.id,le=t.wrapperCustomStyle,Z=t.themeCss,me=t.env,be=A||g,ee=this.props.mountOnEnter;f&&(ee=!1);var de=this.state,m=de.localTabs,Te=de.isFromSource,te=[],ae=[];return Te?(te=m.map(function(s,d){var K,B,j=ve(v,pe(s.data)?y({index:d},s.data):{item:s.data,index:d});return M(s,j)?b.createElement(ye,y({},s,{title:e.renderTabTitle(s.title,d,j),disabled:L||W(s,j),key:d,eventKey:he(s.hash,j)||d,prevKey:d>0?((K=m[d-1])===null||K===void 0?void 0:K.hash)||d-1:0,nextKey:d<m.length-1?((B=m[d+1])===null||B===void 0?void 0:B.hash)||d+1:m.length-1,swipeable:oe,mobileUI:X,mountOnEnter:ee,unmountOnExit:typeof s.reload=="boolean"?s.reload:typeof s.unmountOnExit=="boolean"?s.unmountOnExit:E,onSelect:e.handleSelect,testIdBuilder:I==null?void 0:I.getChild("tab-".concat(typeof s.title=="string"?s.title:d)),className:a(s.className,V(y(y({},s),{name:"panelControlClassName",id:s.id,themeCss:s.themeCss})))}),p("item/".concat(d),s!=null&&s.type?s:s.tab||s.body,{disabled:L||W(s,j)||void 0,data:j,formMode:s.mode||U||S,formHorizontal:s.horizontal||w||H})):null}),ae=m.map(function(s,d){var K=ve(v,pe(s.data)?y({index:d},s.data):{item:s.data,index:d});return M(s,K)?b.createElement(re,y({},s,{config:{id:s.id,themeCss:s.themeCss,classNames:[{key:"panelControlClassName"}]},env:e.props.env,key:"customstyle_".concat(d)})):null})):(te=m.map(function(s,d){var K,B;return M(s,v)?b.createElement(ye,y({},s,{title:e.renderTabTitle(s.title,d,v),disabled:L||W(s,v),key:d,eventKey:s.hash||d,prevKey:d>0?((K=m[d-1])===null||K===void 0?void 0:K.hash)||d-1:0,nextKey:d<m.length-1?((B=m[d+1])===null||B===void 0?void 0:B.hash)||d+1:m.length-1,swipeable:oe,mobileUI:X,mountOnEnter:ee,unmountOnExit:typeof s.reload=="boolean"?s.reload:typeof s.unmountOnExit=="boolean"?s.unmountOnExit:E,onSelect:e.handleSelect,testIdBuilder:I==null?void 0:I.getChild("tab-".concat(typeof s.title=="string"?s.title:d)),className:a(s.className,V(y(y({},s),{name:"panelControlClassName",id:s.id,themeCss:s.themeCss})))}),e.renderTab?e.renderTab(s,e.props,d):r?r(s,e.props,d):p("tab/".concat(d),s!=null&&s.type?s:s.tab||s.body,{disabled:L||W(s,v)||void 0,formMode:s.mode||U||S,formHorizontal:s.horizontal||w||H})):null}),ae=m.map(function(s,d){return M(s,v)?b.createElement(re,{config:{id:s.id,themeCss:s.themeCss,classNames:[{key:"panelControlClassName"}]},env:e.props.env,key:"customstyle_".concat(d)}):null})),b.createElement(b.Fragment,null,b.createElement(Ee,{addBtnText:P(F||"add"),classPrefix:n,classnames:a,mode:be,closable:J,className:a(h,V(y(y({},this.props),{name:"wrapperCustomStyle",id:G,themeCss:le}))),style:u,contentClassName:a(i,V(y(y({},this.props),{name:"contentControlClassName",id:G,themeCss:Z}))),linksClassName:o,titleClassName:a(V(y(y({},this.props),{name:"titleControlClassName",id:G,themeCss:Z}))),onSelect:this.handleSelect,activeKey:this.state.activeKey,toolbar:this.renderToolbar(),addable:O,onAdd:this.handleAdd,onClose:this.handleClose,draggable:C,onDragChange:this.handleDragChange,showTip:k,showTipClassName:Y,editable:q,onEdit:this.handleEdit,sidePosition:R,collapseOnExceed:_,collapseBtnLabel:Q,mobileUI:X,testIdBuilder:I},te),ae,b.createElement(re,y({},this.props,{config:{wrapperCustomStyle:le,id:G,themeCss:Z,classNames:[{key:"titleControlClassName",weights:{default:{important:!0,inner:"> a"},focused:{important:!0,suf:".is-active",inner:"> a"},hover:{important:!0,inner:"> a"},disabled:{important:!0,suf:".is-disabled",inner:"> a"}}},{key:"toolbarControlClassName",weights:{default:{important:!0}}},{key:"contentControlClassName",weights:{default:{important:!0}}}]},env:me})))},l.prototype.render=function(){return this.renderTabs()},l.defaultProps={className:"",mode:"",mountOnEnter:!0,unmountOnExit:!1},T([N,c("design:type",Function),c("design:paramtypes",[Array,String,Object]),c("design:returntype",Array)],l.prototype,"initTabArray",null),T([N,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],l.prototype,"autoJumpToNeighbour",null),T([N,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",void 0)],l.prototype,"handleAdd",null),T([N,c("design:type",Function),c("design:paramtypes",[Object,Boolean]),c("design:returntype",Promise)],l.prototype,"handleClose",null),T([N,c("design:type",Function),c("design:paramtypes",[Number,String]),c("design:returntype",void 0)],l.prototype,"handleEdit",null),T([N,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],l.prototype,"handleDragChange",null),T([N,c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",Promise)],l.prototype,"handleSelect",null),T([N,c("design:type",Function),c("design:paramtypes",[Number]),c("design:returntype",void 0)],l.prototype,"switchTo",null),T([N,c("design:type",Function),c("design:paramtypes",[]),c("design:returntype",Number)],l.prototype,"currentIndex",null),l}(b.Component),Ie=function(D){fe(l,D);function l(e,t){var a=D.call(this,e)||this,n=t;return n.registerComponent(a),a}return l.prototype.componentWillUnmount=function(){var e;(e=D.prototype.componentWillUnmount)===null||e===void 0||e.call(this);var t=this.context;t.unRegisterComponent(this)},l.contextType=ge,l=T([Ce({type:"tabs",onGlobalVarChanged:function(e,t,a){if(Ke(t.source)){var n=$(e.initTabArray(e.props.tabs,e.props.source,a),2),i=n[0],o=n[1];return e.setState({localTabs:i,isFromSource:o}),!1}}}),c("design:paramtypes",[Object,Object])],l),l}(we);export{Ie as TabsRenderer,we as default};
