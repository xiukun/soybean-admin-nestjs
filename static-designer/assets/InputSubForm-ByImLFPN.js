import{b as L,d as _,F as R,ak as w,ae as y,c as s,a7 as z,e3 as U,aZ as H,ag as A,R as l,I as S,dL as j,en as q,a1 as W,a2 as I}from"./amis-CpcGROCB.js";import"./react-vendor-DeqkGhWy.js";var F,T=function(h){return h&&(F=F||document.createElement("div"),F.innerHTML=h,F.innerText)},Z=function(h){L(i,h);function i(a){var e=h.call(this,a)||this;return e.state={},e.id=w(),e.addItem=e.addItem.bind(e),e.removeItem=e.removeItem.bind(e),e.editSingle=e.editSingle.bind(e),e.open=e.open.bind(e),e.close=e.close.bind(e),e.dragTipRef=e.dragTipRef.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e}return i.prototype.addItem=function(){this.setState({dialogData:y(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},i.prototype.removeItem=function(a){a.stopPropagation(),a.preventDefault();var e=parseInt(a.currentTarget.getAttribute("data-index"),10),o=this.props.value;Array.isArray(o)&&(o=o.concat(),o.splice(e,1),this.props.onChange(o))},i.prototype.editSingle=function(){var a=this.props.value;a?this.setState({dialogData:y(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},i.prototype.open=function(a){var e=parseInt(a.currentTarget.getAttribute("data-index"),10),o=this.props.value;!Array.isArray(o)||!o[e]||(this.tempValue=o[e],this.setState({dialogData:y(this.props.data,o[e]),dialogCtx:{mode:"edit",index:e}}))},i.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},i.prototype.handleDialogConfirm=function(a){var e=this.props,o=e.multiple,p=e.onChange,r=e.value,t=this.state.dialogCtx;if(o){var n=Array.isArray(r)?r.concat():[];(t==null?void 0:t.mode)==="add"?n.push(s({},a[0])):n[t.index]=s(s({},n[t.index]),a[0]),p(n)}else p(s(s({},r),a[0]));this.close()},i.prototype.handlePopupConfirm=function(){var a=this.tempValue,e=this.props,o=e.multiple,p=e.onChange,r=e.value,t=this.state.dialogCtx;if(o){var n=Array.isArray(r)?r.concat():[];(t==null?void 0:t.mode)==="add"?n.push(s({},a)):n[t.index]=s(s({},n[t.index]),a),p(n)}else p(s(s({},r),a));this.close()},i.prototype.dragTipRef=function(a){!this.dragTip&&a?this.initDragging():this.dragTip&&!a&&this.destroyDragging(),this.dragTip=a},i.prototype.initDragging=function(){var a=this,e=this.props.classPrefix,o=this.props.submitOnChange,p=z.findDOMNode(this);this.sortable=new U(p.querySelector(".".concat(e,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(e,"SubForm-valueDragBar"),ghostClass:"".concat(e,"SubForm-value--dragging"),onEnd:function(r){if(r.newIndex!==r.oldIndex){var t=r.to;r.oldIndex<t.childNodes.length-1?t.insertBefore(r.item,t.childNodes[r.oldIndex>r.newIndex?r.oldIndex+1:r.oldIndex]):t.appendChild(r.item);var n=a.props.value;if(Array.isArray(n)){var m=n.concat();m.splice(r.newIndex,0,m.splice(r.oldIndex,1)[0]),a.props.onChange(m,o,!0)}}}})},i.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},i.prototype.buildDialogSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return s(s({},H(a,e)),{type:"dialog",body:s(s({type:"form",canAccessSuperData:!1},A(a,e)),{inheritData:!1})})},i.prototype.buildFormSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return s(s({type:"form",canAccessSuperData:!1},A(a,e)),{inheritData:!1})},i.prototype.renderMultipe=function(){var a=this,e=this.props,o=e.addButtonClassName,p=e.itemClassName,r=e.itemsClassName,t=e.disabled,n=e.maxLength,m=e.labelField,b=e.defaultLabel,d=e.value,g=e.btnLabel,v=e.render,C=e.data,u=e.translate,c=e.classnames,B=e.placeholder,E=e.draggable,O=e.draggableTip,P=e.addable,M=e.removable,D=e.minLength,k=e.addButtonText,f=e.testIdBuilder;return l.createElement(l.Fragment,null,Array.isArray(d)&&d.length?l.createElement("div",{className:c("SubForm-values",r),key:"values"},d.map(function(x,N){return l.createElement("div",s({className:c("SubForm-value",{"is-disabled":t},p),key:N},f==null?void 0:f.getChild("item-".concat(N)).getTestId()),E&&d.length>1?l.createElement("a",{className:c("SubForm-valueDragBar")},l.createElement(S,{icon:"drag-bar",className:c("icon")})):null,l.createElement("span",{className:c("SubForm-valueLabel")},g&&v("label",{type:"tpl",tpl:u(g)},{data:y(C,x)}),!g&&(x&&m&&x[m]&&T(x[m])||u(b))),l.createElement("a",{"data-index":N,onClick:a.open,className:c("SubForm-valueEdit")},l.createElement(S,{icon:"pencil",className:"icon"})),!t&&M!==!1&&(!D||d.length>D)?l.createElement("a",{"data-index":N,className:c("SubForm-valueDel"),onClick:a.removeItem},l.createElement(S,{icon:"close",className:"icon"})):null)})):l.createElement("div",{className:c("SubForm-placeholder"),key:"placeholder"},u(B||"placeholder.empty")),l.createElement("div",{key:"toolbar",className:c("SubForm-toolbar")},P!==!1?l.createElement("button",s({type:"button",onClick:this.addItem,className:c("Button SubForm-addBtn",o),disabled:t||!!(n&&Array.isArray(d)&&d.length>=n)},f==null?void 0:f.getChild("add-button").getTestId()),l.createElement(S,{icon:"plus",className:"icon"}),l.createElement("span",null,u(k||"SubForm.add"))):null,E&&Array.isArray(d)&&d.length>1?l.createElement("span",{className:c("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(d)&&d.length>1?u(O):""):null))},i.prototype.renderSingle=function(){var a=this.props,e=a.classnames,o=a.itemsClassName,p=a.itemClassName,r=a.disabled,t=a.value,n=a.labelField,m=a.defaultLabel,b=a.btnLabel,d=a.render,g=a.data,v=a.translate,C=a.testIdBuilder,u=C==null?void 0:C.getChild("edit-single");return l.createElement("div",{className:e("SubForm-values",o),key:"values"},l.createElement("div",s({className:e("SubForm-value",{"is-disabled":r},p),onClick:this.editSingle,"data-tooltip":v("SubForm.editDetail"),"data-position":"bottom"},u==null?void 0:u.getTestId()),l.createElement("span",{className:e("SubForm-valueLabel")},b&&d("label",{type:"tpl",tpl:v(b)},{data:y(g,t)}),!b&&(t&&n&&t[n]&&T(t[n])||v(m))),l.createElement("a",s({className:e("SubForm-valueEdit")},u==null?void 0:u.getChild("icon").getTestId()),l.createElement(S,{icon:"pencil",className:"icon"}))))},i.prototype.render=function(){var a=this,e=this.props,o=e.multiple,p=e.classPrefix,r=e.className;e.style;var t=e.render,n=e.mobileUI,m=e.env,b=e.popOverContainer,d=this.state.dialogData,g=this.state.dialogCtx;return l.createElement("div",{className:j("".concat(p,"SubFormControl"),r)},o?this.renderMultipe():this.renderSingle(),n?l.createElement(q,{isShow:!!g,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:n?m==null?void 0:m.getModalContainer:b||m.getModalContainer},l.createElement("div",{className:"flex-1 pl-10 pr-10"},t("form",this.buildFormSchema(),{data:d,formStore:void 0,wrapWithPanel:!1,onChange:function(v){a.tempValue=v}}))):t("modal",this.buildDialogSchema(),{show:!!g,onClose:this.close,onConfirm:this.handleDialogConfirm,data:d,formStore:void 0}))},i.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},i.propsList=["form","formStore"],_([W,I("design:type",Function),I("design:paramtypes",[]),I("design:returntype",void 0)],i.prototype,"handlePopupConfirm",null),i}(l.PureComponent),J=function(h){L(i,h);function i(){return h!==null&&h.apply(this,arguments)||this}return i=_([R({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],i),i}(Z);export{J as SubFormControlRenderer,Z as default};
