# Soybean Admin Docker部署环境变量配置
# 复制此文件为 .env 并根据实际情况修改配置

# =============================================================================
# 🌍 全局配置
# =============================================================================

# 时区设置
TZ=Asia/Shanghai

# 环境类型 (development|test|production)
NODE_ENV=production

# Docker环境标识
DOCKER_ENV=true

# 首次运行检测
FIRST_RUN_DETECTION=true

# 自动初始化数据
AUTO_INIT_DATA=true

# 运行数据库迁移
RUN_MIGRATIONS=true

# 健康检查启用
HEALTH_CHECK_ENABLED=true

# =============================================================================
# 🗄️ 数据库配置
# =============================================================================

# PostgreSQL配置
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=soybean-admin-nest-backend
POSTGRES_USER=soybean
POSTGRES_PASSWORD=soybean@123.

# 数据库连接URL模板
# 各服务使用不同的schema来隔离数据
DATABASE_URL_TEMPLATE=postgresql://soybean:soybean@123.@postgres:5432/soybean-admin-nest-backend

# 各服务的数据库URL
BACKEND_DATABASE_URL=postgresql://soybean:soybean@123.@postgres:5432/soybean-admin-nest-backend?schema=backend
LOWCODE_DATABASE_URL=postgresql://soybean:soybean@123.@postgres:5432/soybean-admin-nest-backend?schema=lowcode
AMIS_DATABASE_URL=postgresql://soybean:soybean@123.@postgres:5432/soybean-admin-nest-backend?schema=amis

# =============================================================================
# 🔴 Redis配置
# =============================================================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=123456

# 各服务使用不同的数据库编号
BACKEND_REDIS_DB=1
LOWCODE_REDIS_DB=2
AMIS_REDIS_DB=3

# =============================================================================
# 🔐 JWT配置 (统一密钥)
# =============================================================================

# 访问令牌配置
JWT_SECRET=JWT_SECRET-soybean-admin-nest!@#123.
JWT_EXPIRES_IN=2h
JWT_ISSUER=soybean-admin
JWT_AUDIENCE=soybean-admin

# 刷新令牌配置
REFRESH_TOKEN_SECRET=REFRESH_TOKEN_SECRET-soybean-admin-nest!@#123.
REFRESH_TOKEN_EXPIRES_IN=7d

# =============================================================================
# 🌐 服务端口配置
# =============================================================================

# 主后端服务
BACKEND_PORT=9528

# 低代码平台后端
LOWCODE_PLATFORM_PORT=3000

# Amis低代码后端
AMIS_BACKEND_PORT=9522

# 前端应用
FRONTEND_PORT=9527

# =============================================================================
# 🔗 服务间通信配置
# =============================================================================

# 内部服务URL (容器间通信)
BACKEND_INTERNAL_URL=http://backend:9528
LOWCODE_PLATFORM_INTERNAL_URL=http://lowcode-platform:3000
AMIS_BACKEND_INTERNAL_URL=http://amis-backend:9522

# 外部服务URL (浏览器访问)
BACKEND_EXTERNAL_URL=http://localhost:9528
LOWCODE_PLATFORM_EXTERNAL_URL=http://localhost:3000
AMIS_BACKEND_EXTERNAL_URL=http://localhost:9522

# =============================================================================
# 🌍 CORS配置
# =============================================================================

CORS_ENABLED=true
CORS_CREDENTIALS=true
CORS_METHODS=GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS

# 允许的源地址 (根据实际部署环境修改)
CORS_ORIGIN=http://localhost:9527,http://127.0.0.1:9527,http://localhost:9528,http://127.0.0.1:9528,http://localhost:3000,http://127.0.0.1:3000,http://localhost:9522,http://127.0.0.1:9522

# =============================================================================
# 📚 API文档配置
# =============================================================================

# Swagger文档启用
DOC_SWAGGER_ENABLE=true
DOC_SWAGGER_PATH=api-docs

# API版本
API_VERSION=v1

# =============================================================================
# 📊 监控和性能配置
# =============================================================================

# 性能监控启用
PERFORMANCE_MONITORING=true
METRICS_ENABLED=true

# 日志级别 (error|warn|info|debug)
LOG_LEVEL=info

# 健康检查配置
HEALTH_CHECK_TIMEOUT=10000
HEALTH_CHECK_INTERVAL=30000

# =============================================================================
# 🔄 数据同步配置
# =============================================================================

# 数据同步启用
DATA_SYNC_ENABLED=true

# 同步间隔 (毫秒)
DATA_SYNC_INTERVAL=30000

# 批处理大小
DATA_SYNC_BATCH_SIZE=100

# =============================================================================
# 📁 文件存储配置
# =============================================================================

# 上传文件目录
UPLOAD_DIR=/app/uploads

# 生成代码目录
GENERATED_CODE_DIR=/app/generated

# 日志文件目录
LOG_DIR=/app/logs

# 最大文件大小 (字节)
MAX_FILE_SIZE=10485760

# 允许的文件类型
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx

# =============================================================================
# 🔧 低代码平台特定配置
# =============================================================================

# Amis后端路径
AMIS_BACKEND_PATH=/app/amis-backend

# 模板存储路径
TEMPLATE_STORAGE_PATH=/app/templates

# 代码生成配置
CODE_GENERATION_ENABLED=true
CODE_GENERATION_TIMEOUT=60000

# =============================================================================
# 🚀 部署配置
# =============================================================================

# 容器重启策略
RESTART_POLICY=unless-stopped

# 资源限制
MEMORY_LIMIT=1g
CPU_LIMIT=1

# 网络配置
NETWORK_NAME=soybean-admin
SUBNET=172.20.0.0/16

# =============================================================================
# 🔒 安全配置
# =============================================================================

# 安全头启用
SECURITY_HEADERS_ENABLED=true

# 速率限制
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=900000

# CSRF保护
CSRF_ENABLED=false

# =============================================================================
# 🧪 开发和调试配置
# =============================================================================

# 调试模式
DEBUG_MODE=false

# 详细日志
VERBOSE_LOGGING=false

# 开发工具启用
DEV_TOOLS_ENABLED=false

# 热重载启用 (仅开发环境)
HOT_RELOAD_ENABLED=false

# =============================================================================
# 📧 通知配置 (可选)
# =============================================================================

# 邮件通知
EMAIL_ENABLED=false
EMAIL_HOST=smtp.example.com
EMAIL_PORT=587
EMAIL_USER=your-email@example.com
EMAIL_PASS=your-password

# 钉钉通知
DINGTALK_ENABLED=false
DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=your-token

# =============================================================================
# 🔍 监控和告警配置 (可选)
# =============================================================================

# Prometheus监控
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Grafana仪表板
GRAFANA_ENABLED=false
GRAFANA_PORT=3001

# 告警配置
ALERT_ENABLED=false
ALERT_WEBHOOK=https://your-alert-webhook.com
