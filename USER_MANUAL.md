# 低代码平台用户手册

## 📖 目录

1. [快速开始](#快速开始)
2. [系统概述](#系统概述)
3. [项目管理](#项目管理)
4. [实体设计](#实体设计)
5. [字段管理](#字段管理)
6. [关系建模](#关系建模)
7. [API配置](#api配置)
8. [代码生成](#代码生成)
9. [模板管理](#模板管理)
10. [部署指南](#部署指南)
11. [常见问题](#常见问题)
12. [最佳实践](#最佳实践)

## 🚀 快速开始

### 系统要求

- **操作系统**: Windows 10+, macOS 10.15+, Linux (Ubuntu 18.04+)
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **内存**: 最少 4GB RAM，推荐 8GB+
- **存储**: 至少 2GB 可用空间

### 安装部署

#### 方式一：Docker 部署（推荐）

```bash
# 1. 克隆项目
git clone <repository-url>
cd soybean-admin-nestjs

# 2. 启动服务
docker-compose up -d

# 3. 访问系统
# 前端界面: http://localhost:9527
# 基础系统API: http://localhost:9528
# 低代码平台API: http://localhost:3000
```

#### 方式二：本地开发部署

```bash
# 1. 启动数据库服务
docker-compose up -d postgres redis

# 2. 启动后端服务
cd backend && pnpm run start:dev:base-system
cd lowcode-platform-backend && npm run start:dev

# 3. 启动前端服务
cd frontend && pnpm run dev
```

### 首次登录

1. 打开浏览器访问 `http://localhost:9527`
2. 使用默认管理员账号登录：
   - 用户名: `admin`
   - 密码: `admin123`
3. 登录后建议立即修改密码

## 🏗️ 系统概述

### 架构说明

低代码平台采用多服务架构设计：

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│   前端界面      │    │   基础系统       │    │  低代码平台         │
│   (9527端口)    │────│   (9528端口)     │    │    (3000端口)       │
│                 │    │                  │    │                     │
│ - 统一用户界面  │    │ - 用户管理       │    │ - 项目管理          │
│ - 智能路由      │    │ - 权限控制       │    │ - 实体设计          │
│ - 服务监控      │    │ - 菜单管理       │    │ - 代码生成          │
└─────────────────┘    │ - 系统配置       │    │ - 模板管理          │
                       └──────────────────┘    └─────────────────────┘
```

### 核心功能

- **项目管理**: 创建和管理低代码项目
- **实体设计**: 可视化数据模型设计
- **字段管理**: 灵活的字段类型和约束配置
- **关系建模**: 实体间关系的定义和管理
- **API配置**: 自动生成和配置REST API
- **代码生成**: 基于模板的代码自动生成
- **模板管理**: 可扩展的代码模板系统

## 📁 项目管理

### 创建项目

1. 登录系统后，点击左侧菜单 "低代码平台" → "项目管理"
2. 点击右上角 "新建项目" 按钮
3. 填写项目信息：
   - **项目名称**: 项目的显示名称
   - **项目描述**: 项目的详细说明
   - **版本号**: 项目版本（如 1.0.0）
   - **项目类型**: Web应用、移动应用等
   - **技术栈**: React、Vue、Angular等
4. 点击 "确定" 创建项目

### 项目配置

创建项目后，可以进行详细配置：

#### 基础配置
- **数据库配置**: 选择数据库类型（PostgreSQL、MySQL等）
- **认证配置**: 配置用户认证方式
- **部署配置**: 设置部署相关参数

#### 高级配置
- **代码规范**: 设置代码格式化规则
- **构建配置**: 配置构建和打包选项
- **环境变量**: 管理不同环境的配置

### 项目操作

- **查看项目**: 点击项目卡片查看详情
- **编辑项目**: 点击编辑按钮修改项目信息
- **复制项目**: 基于现有项目创建副本
- **删除项目**: 删除不需要的项目（谨慎操作）
- **导出项目**: 导出项目配置和代码

## 🗃️ 实体设计

### 创建实体

1. 进入项目详情页面
2. 点击 "实体管理" 标签
3. 点击 "新建实体" 按钮
4. 填写实体信息：
   - **实体名称**: 如 "用户"、"订单"
   - **实体代码**: 英文标识符，如 "user"、"order"
   - **表名**: 数据库表名，如 "users"、"orders"
   - **分类**: 核心实体、业务实体等
   - **描述**: 实体的详细说明

### 实体属性

每个实体包含以下属性：

- **基础信息**: 名称、代码、描述
- **数据库映射**: 表名、索引配置
- **业务属性**: 分类、状态、版本
- **扩展配置**: 软删除、时间戳、审计等

### 实体状态管理

实体具有以下状态：
- **草稿**: 正在设计中，可以自由修改
- **已发布**: 设计完成，生成代码后的状态
- **已弃用**: 不再使用的实体

### 实体操作

- **编辑实体**: 修改实体基本信息
- **复制实体**: 创建相似实体的副本
- **发布实体**: 将草稿状态的实体发布
- **预览代码**: 查看将要生成的代码
- **删除实体**: 删除不需要的实体

## 🏷️ 字段管理

### 添加字段

1. 在实体详情页面，点击 "字段管理" 标签
2. 点击 "添加字段" 按钮
3. 配置字段属性：

#### 基础属性
- **字段名称**: 显示名称，如 "用户名"
- **字段代码**: 英文标识符，如 "username"
- **字段类型**: 数据类型（见下方类型说明）
- **是否必填**: 字段是否为必填项
- **默认值**: 字段的默认值

#### 约束配置
- **唯一性**: 字段值是否必须唯一
- **主键**: 是否为主键字段
- **外键**: 关联其他实体的字段
- **索引**: 是否创建数据库索引

### 字段类型

系统支持以下字段类型：

#### 文本类型
- **VARCHAR**: 可变长度字符串
  - 长度: 1-65535
  - 用途: 姓名、标题、短文本
- **TEXT**: 长文本
  - 用途: 描述、内容、备注
- **CHAR**: 固定长度字符串
  - 长度: 1-255
  - 用途: 状态码、固定格式编号

#### 数值类型
- **INTEGER**: 整数
  - 范围: -2,147,483,648 到 2,147,483,647
  - 用途: 数量、排序、计数
- **BIGINT**: 长整数
  - 用途: ID、大数值
- **DECIMAL**: 精确小数
  - 精度: 1-65，标度: 0-30
  - 用途: 价格、金额、比率
- **FLOAT**: 浮点数
  - 用途: 科学计算、近似值

#### 日期时间类型
- **DATE**: 日期
  - 格式: YYYY-MM-DD
  - 用途: 生日、截止日期
- **TIME**: 时间
  - 格式: HH:MM:SS
  - 用途: 营业时间、提醒时间
- **TIMESTAMP**: 时间戳
  - 用途: 创建时间、更新时间
- **DATETIME**: 日期时间
  - 用途: 事件时间、预约时间

#### 其他类型
- **BOOLEAN**: 布尔值
  - 值: true/false
  - 用途: 开关、状态标识
- **UUID**: 唯一标识符
  - 用途: 主键、关联ID
- **JSON**: JSON数据
  - 用途: 配置信息、扩展属性
- **ENUM**: 枚举类型
  - 用途: 状态、类型、级别

### 字段验证

为字段设置验证规则：

- **长度验证**: 最小/最大长度
- **数值验证**: 最小/最大值
- **格式验证**: 正则表达式
- **自定义验证**: JavaScript验证函数

### 字段排序

- 拖拽字段调整显示顺序
- 使用上移/下移按钮调整
- 批量排序功能

## 🔗 关系建模

### 关系类型

系统支持以下关系类型：

#### 一对一 (One-to-One)
- **说明**: 一个实体记录对应另一个实体的一个记录
- **示例**: 用户 ↔ 用户资料
- **实现**: 在任一表中添加外键

#### 一对多 (One-to-Many)
- **说明**: 一个实体记录对应另一个实体的多个记录
- **示例**: 用户 → 订单（一个用户有多个订单）
- **实现**: 在"多"的一方添加外键

#### 多对多 (Many-to-Many)
- **说明**: 两个实体间的多对多关系
- **示例**: 用户 ↔ 角色（用户可以有多个角色，角色可以分配给多个用户）
- **实现**: 创建中间关联表

### 创建关系

1. 在项目中点击 "关系管理" 标签
2. 点击 "新建关系" 按钮
3. 配置关系信息：
   - **关系名称**: 如 "用户订单关系"
   - **关系类型**: 选择关系类型
   - **源实体**: 关系的起始实体
   - **目标实体**: 关系的目标实体
   - **关联字段**: 指定关联的字段

### 关系约束

配置关系的约束行为：

- **级联删除**: 删除主记录时同时删除关联记录
- **级联更新**: 更新主记录时同时更新关联记录
- **设置为空**: 删除主记录时将外键设为NULL
- **限制删除**: 存在关联记录时不允许删除主记录

### 关系可视化

- 实体关系图 (ERD) 显示
- 拖拽调整实体位置
- 缩放和平移视图
- 导出关系图

## 🔌 API配置

### 自动生成API

系统会根据实体自动生成标准的REST API：

- `GET /api/{entity}` - 获取实体列表
- `GET /api/{entity}/{id}` - 获取单个实体
- `POST /api/{entity}` - 创建实体
- `PUT /api/{entity}/{id}` - 更新实体
- `DELETE /api/{entity}/{id}` - 删除实体

### 自定义API

1. 进入项目的 "API配置" 页面
2. 点击 "新建API" 按钮
3. 配置API信息：
   - **API名称**: 如 "获取用户订单"
   - **请求路径**: 如 "/api/users/{id}/orders"
   - **请求方法**: GET、POST、PUT、DELETE
   - **关联实体**: 选择相关实体
   - **查询配置**: 设置查询条件、排序、分页

### 查询配置

#### 分页配置
- **启用分页**: 是否支持分页查询
- **默认页大小**: 默认每页记录数
- **最大页大小**: 单页最大记录数

#### 过滤配置
- **可过滤字段**: 选择支持过滤的字段
- **过滤操作符**: 等于、不等于、大于、小于、包含等
- **组合条件**: AND、OR逻辑组合

#### 排序配置
- **可排序字段**: 选择支持排序的字段
- **默认排序**: 设置默认排序规则

### API测试

- **在线测试**: 直接在界面中测试API
- **参数配置**: 设置请求参数和请求体
- **响应查看**: 查看API响应结果
- **错误调试**: 查看错误信息和调试日志

### API文档

- **自动生成**: 基于配置自动生成API文档
- **Swagger集成**: 支持Swagger/OpenAPI格式
- **在线查看**: 在浏览器中查看API文档
- **导出文档**: 导出为PDF或HTML格式

## ⚙️ 代码生成

### 生成配置

1. 在项目中点击 "代码生成" 标签
2. 选择要生成代码的实体
3. 配置生成选项：
   - **目标框架**: React、Vue、Angular等
   - **代码风格**: TypeScript、JavaScript
   - **包含内容**: 控制器、服务、模型、测试等
   - **输出路径**: 代码生成的目录

### 生成内容

系统可以生成以下类型的代码：

#### 后端代码
- **控制器 (Controller)**: API接口实现
- **服务 (Service)**: 业务逻辑处理
- **模型 (Model)**: 数据模型定义
- **DTO**: 数据传输对象
- **验证器**: 数据验证规则
- **测试代码**: 单元测试和集成测试

#### 前端代码
- **组件 (Component)**: UI组件
- **页面 (Page)**: 完整页面
- **服务 (Service)**: API调用服务
- **类型定义**: TypeScript类型
- **路由配置**: 页面路由
- **样式文件**: CSS/SCSS样式

#### 数据库代码
- **迁移文件**: 数据库迁移脚本
- **种子数据**: 初始化数据
- **索引脚本**: 数据库索引创建

### 代码预览

生成前可以预览代码：
- **文件树**: 查看将要生成的文件结构
- **代码内容**: 预览具体的代码内容
- **差异对比**: 与现有代码的差异对比

### 生成执行

- **一键生成**: 生成所有选中的代码
- **增量生成**: 只生成变更的部分
- **批量生成**: 同时为多个实体生成代码
- **进度监控**: 实时查看生成进度

### 代码管理

- **版本控制**: 代码生成历史记录
- **回滚功能**: 回滚到之前的版本
- **冲突处理**: 处理代码冲突
- **备份恢复**: 代码备份和恢复

## 📝 模板管理

### 模板类型

系统支持多种类型的代码模板：

- **组件模板**: UI组件代码模板
- **页面模板**: 完整页面代码模板
- **服务模板**: 后端服务代码模板
- **配置模板**: 配置文件模板
- **文档模板**: 文档生成模板

### 创建模板

1. 进入 "模板管理" 页面
2. 点击 "新建模板" 按钮
3. 配置模板信息：
   - **模板名称**: 如 "React组件模板"
   - **模板类型**: 选择模板类型
   - **目标语言**: JavaScript、TypeScript等
   - **适用框架**: React、Vue等
   - **模板内容**: 编写模板代码

### 模板语法

使用 Handlebars 语法编写模板：

```handlebars
import React from 'react';

interface {{componentName}}Props {
  {{#each fields}}
  {{name}}: {{type}};
  {{/each}}
}

const {{componentName}}: React.FC<{{componentName}}Props> = (props) => {
  return (
    <div className="{{kebabCase componentName}}">
      <h1>{{title}}</h1>
      {{#each fields}}
      <div>
        <label>{{label}}:</label>
        <input type="{{inputType}}" name="{{name}}" />
      </div>
      {{/each}}
    </div>
  );
};

export default {{componentName}};
```

### 模板变量

定义模板中使用的变量：

- **变量名**: 变量标识符
- **变量类型**: string、number、boolean、array、object
- **默认值**: 变量的默认值
- **描述**: 变量的说明
- **是否必填**: 变量是否为必填

### 模板测试

- **实时预览**: 输入变量值实时预览生成结果
- **测试数据**: 使用测试数据验证模板
- **错误检查**: 检查模板语法错误

### 模板版本

- **版本管理**: 管理模板的不同版本
- **版本对比**: 对比不同版本的差异
- **版本发布**: 发布新版本模板
- **回滚版本**: 回滚到之前的版本

### 模板分享

- **公开模板**: 将模板设为公开，供其他用户使用
- **模板市场**: 浏览和使用其他用户分享的模板
- **导入导出**: 导入和导出模板文件
- **模板评价**: 对模板进行评价和反馈

## 🚀 部署指南

### 开发环境部署

#### 前置要求
- Node.js 18+
- pnpm 8+
- Docker & Docker Compose
- PostgreSQL 15+
- Redis 7+

#### 部署步骤

1. **克隆代码**
```bash
git clone <repository-url>
cd soybean-admin-nestjs
```

2. **安装依赖**
```bash
# 后端依赖
cd backend && pnpm install
cd ../lowcode-platform-backend && npm install

# 前端依赖
cd ../frontend && pnpm install
```

3. **配置环境变量**
```bash
# 复制环境变量模板
cp .env.example .env

# 编辑环境变量
vim .env
```

4. **启动数据库**
```bash
docker-compose up -d postgres redis
```

5. **初始化数据库**
```bash
cd backend && pnpm prisma:migrate
cd ../lowcode-platform-backend && npm run prisma:migrate
```

6. **启动服务**
```bash
# 启动后端服务
cd backend && pnpm run start:dev:base-system
cd ../lowcode-platform-backend && npm run start:dev

# 启动前端服务
cd ../frontend && pnpm run dev
```

### 生产环境部署

#### Docker部署（推荐）

1. **配置生产环境变量**
```bash
# 编辑docker-compose.yml中的环境变量
vim docker-compose.yml
```

2. **构建和启动**
```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d
```

3. **验证部署**
```bash
# 检查服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

#### 手动部署

1. **构建应用**
```bash
# 构建后端
cd backend && pnpm run build
cd ../lowcode-platform-backend && npm run build

# 构建前端
cd ../frontend && pnpm run build
```

2. **配置Nginx**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # 前端静态文件
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    # 基础系统API
    location /v1/ {
        proxy_pass http://localhost:9528;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # 低代码平台API
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

3. **配置进程管理**
```bash
# 使用PM2管理Node.js进程
npm install -g pm2

# 启动后端服务
pm2 start ecosystem.config.js
```

### 监控和维护

#### 健康检查
- 服务状态监控
- 数据库连接检查
- API响应时间监控
- 错误日志监控

#### 备份策略
- 数据库定期备份
- 代码版本控制
- 配置文件备份
- 生成代码备份

#### 性能优化
- 数据库索引优化
- 缓存策略配置
- CDN加速配置
- 负载均衡配置

## ❓ 常见问题

### 安装和部署问题

**Q: Docker启动失败怎么办？**
A: 
1. 检查Docker是否正常运行：`docker --version`
2. 检查端口是否被占用：`lsof -i :9527`
3. 查看错误日志：`docker-compose logs`
4. 清理Docker缓存：`docker system prune`

**Q: 数据库连接失败？**
A:
1. 检查数据库服务状态：`docker-compose ps postgres`
2. 验证连接字符串配置
3. 检查防火墙设置
4. 查看数据库日志：`docker-compose logs postgres`

### 使用问题

**Q: 代码生成失败？**
A:
1. 检查实体和字段配置是否完整
2. 验证模板语法是否正确
3. 确认输出目录权限
4. 查看生成日志获取详细错误信息

**Q: API调用返回401错误？**
A:
1. 检查用户是否已登录
2. 验证JWT Token是否有效
3. 确认API权限配置
4. 检查CORS设置

**Q: 前端页面显示异常？**
A:
1. 清除浏览器缓存
2. 检查控制台错误信息
3. 验证API接口是否正常
4. 确认路由配置

### 性能问题

**Q: 系统响应慢？**
A:
1. 检查数据库查询性能
2. 优化数据库索引
3. 启用Redis缓存
4. 检查网络连接

**Q: 内存使用过高？**
A:
1. 检查是否有内存泄漏
2. 优化数据库连接池
3. 调整Node.js内存限制
4. 监控系统资源使用

## 💡 最佳实践

### 项目设计

1. **命名规范**
   - 使用有意义的名称
   - 遵循驼峰命名法
   - 避免使用保留字
   - 保持命名一致性

2. **实体设计**
   - 合理划分实体粒度
   - 避免过度设计
   - 考虑扩展性
   - 遵循数据库设计范式

3. **关系建模**
   - 明确关系类型
   - 设置合适的约束
   - 考虑性能影响
   - 避免循环依赖

### 开发流程

1. **需求分析**
   - 明确业务需求
   - 设计数据模型
   - 规划API接口
   - 制定开发计划

2. **迭代开发**
   - 小步快跑
   - 频繁测试
   - 及时反馈
   - 持续改进

3. **代码管理**
   - 使用版本控制
   - 编写清晰注释
   - 遵循代码规范
   - 定期代码审查

### 部署运维

1. **环境管理**
   - 区分开发、测试、生产环境
   - 使用环境变量管理配置
   - 自动化部署流程
   - 监控系统状态

2. **安全考虑**
   - 定期更新依赖
   - 配置HTTPS
   - 实施访问控制
   - 备份重要数据

3. **性能优化**
   - 监控关键指标
   - 优化数据库查询
   - 使用缓存策略
   - 负载均衡配置

### 代码生成最佳实践

1. **模板设计**
   - 保持模板简洁明了
   - 使用有意义的变量名
   - 添加适当的注释
   - 考虑代码可读性

2. **生成策略**
   - 分层生成代码
   - 保留自定义修改
   - 使用版本控制
   - 定期更新模板

3. **质量保证**
   - 生成后进行代码审查
   - 运行自动化测试
   - 检查代码规范
   - 验证功能完整性

---

## 📞 技术支持

如果您在使用过程中遇到问题，可以通过以下方式获取帮助：

- **文档中心**: 查看详细的技术文档
- **问题反馈**: 在GitHub上提交Issue
- **社区讨论**: 参与社区讨论和交流
- **技术支持**: 联系技术支持团队

---

**版本**: v1.0.0  
**更新时间**: 2024年1月  
**维护团队**: 低代码平台开发团队
