# 低代码平台开发需求文档

## 📋 项目概述

### 项目目标
完善 SoybeanAdmin NestJS 低代码平台的完整功能闭环，实现从项目管理到代码生成的端到端流程。

### 核心功能模块
1. **项目管理** - 低代码项目的创建、配置、管理
2. **实体管理** - 数据模型设计和管理
3. **字段管理** - 实体字段的详细配置
4. **关系管理** - 实体间关系的设计和维护
5. **查询管理** - 数据查询配置和优化
6. **API配置** - RESTful API的自动生成和配置
7. **API测试** - 生成的API的在线测试
8. **模板管理** - 代码生成模板的管理
9. **代码生成器** - 基于模板和实体的智能代码生成
10. **amis-lowcode-backend服务** - 动态业务API服务

## 🔍 当前系统状态分析

### ✅ 已完成功能

#### lowcode-platform-backend
- ✅ 基础架构搭建 (DDD + CQRS + 事件驱动)
- ✅ 数据库设计 (Prisma Schema 完整)
- ✅ 核心控制器框架 (ProjectController, EntityController等)
- ✅ 基础服务层架构
- ✅ JWT认证框架
- ✅ Swagger API文档框架
- ✅ 代码生成引擎基础架构
- ✅ 模板引擎基础实现

#### amis-lowcode-backend
- ✅ 基础服务框架
- ✅ 自动生成的CRUD接口
- ✅ Amis兼容的响应格式
- ✅ 健康检查和基础监控
- ✅ Docker部署配置

#### 前端界面
- ✅ 低代码平台页面框架
- ✅ 项目管理界面基础
- ✅ 实体管理界面基础
- ✅ 模板管理界面基础
- ✅ 代码生成界面基础
- ✅ X6可视化实体设计器

### ❌ 缺失和需要完善的功能

#### 1. 后端API实现缺失
- ❌ 项目管理完整CRUD API
- ❌ 实体管理完整业务逻辑
- ❌ 字段管理详细配置API
- ❌ 关系管理复杂关联处理
- ❌ 查询构建器实现
- ❌ API配置动态生成
- ❌ 模板管理完整功能
- ❌ 代码生成完整流程

#### 2. 前后端集成缺失
- ❌ API接口调用实现
- ❌ 数据流转和状态管理
- ❌ 错误处理机制
- ❌ 实时数据更新

#### 3. 数据库功能缺失
- ❌ 数据迁移脚本
- ❌ 种子数据初始化
- ❌ 数据库表结构动态调整

#### 4. 部署和运维缺失
- ❌ Docker服务编排优化
- ❌ 环境变量统一管理
- ❌ 健康检查完善
- ❌ 日志收集和监控

## 📝 详细开发需求

### 需求1: 项目管理完整实现

#### 1.1 后端API开发
**文件**: `lowcode-platform-backend/src/api/lowcode/project.controller.ts`

**需要实现的功能**:
```typescript
// 完整实现所有API端点
@Get('paginated') // ✅ 已存在，需测试
@Post() // ⚠️ 需完善业务逻辑
@Get(':id') // ⚠️ 需完善
@Put(':id') // ⚠️ 需完善
@Delete(':id') // ⚠️ 需完善
@Post(':id/deploy') // ❌ 需新增
@Post(':id/stop') // ❌ 需新增
```

**具体实现要求**:
- 项目创建时自动生成代码结构
- 项目配置验证和存储
- 项目部署状态管理
- 项目模板应用

#### 1.2 前端界面完善
**文件**: `frontend/src/views/lowcode/project/index.vue`

**需要完善的功能**:
- ✅ 项目列表展示 (已实现)
- ⚠️ 项目创建表单 (需完善验证)
- ❌ 项目编辑功能
- ❌ 项目部署管理
- ❌ 项目导入/导出
- ❌ 项目状态监控

### 需求2: 实体管理完整实现

#### 2.1 后端API开发
**文件**: `lowcode-platform-backend/src/api/lowcode/entity.controller.ts`

**需要实现的功能**:
```typescript
// 增强实体管理功能
@Post('validate') // ❌ 实体验证
@Post('preview-table') // ❌ 数据表预览
@Post(':id/generate-migration') // ❌ 生成迁移脚本
@Get(':id/relationships') // ❌ 获取实体关系
@Post('batch') // ❌ 批量操作
```

#### 2.2 实体字段管理
**文件**: `lowcode-platform-backend/src/api/lowcode/field.controller.ts`

**需要实现的功能**:
- 字段类型验证和转换
- 字段约束配置
- 字段依赖关系处理
- 字段索引管理

#### 2.3 前端可视化设计器
**文件**: `frontend/src/views/lowcode/entity/components/X6EntityDesigner.vue`

**需要完善的功能**:
- ✅ 基础拖拽设计器 (已实现)
- ❌ 实体关系连线
- ❌ 实体属性编辑面板
- ❌ 设计器状态保存
- ❌ 实体导入/导出

### 需求3: 关系管理完整实现

#### 3.1 后端关系引擎
**文件**: `lowcode-platform-backend/src/api/lowcode/relationship.controller.ts`

**需要实现的功能**:
```typescript
// 关系管理API
@Get('project/:projectId/graph') // ❌ 关系图数据
@Post('validate') // ❌ 关系验证
@Post('generate-join-table') // ❌ 中间表生成
@Get(':id/preview-sql') // ❌ SQL预览
```

#### 3.2 关系类型支持
- OneToOne (一对一)
- OneToMany (一对多)  
- ManyToMany (多对多)
- 自关联关系
- 级联操作配置

### 需求4: 查询管理实现

#### 4.1 查询构建器
**文件**: `lowcode-platform-backend/src/api/lowcode/query.controller.ts`

**需要实现的功能**:
```typescript
// 查询管理API
@Post('build') // ❌ 查询构建
@Post('validate') // ❌ 查询验证
@Post('preview') // ❌ 查询预览
@Post('optimize') // ❌ 查询优化
@Get(':id/sql') // ❌ 生成SQL
```

#### 4.2 查询功能支持
- 多表关联查询
- 条件筛选器
- 排序和分页
- 聚合函数
- 查询性能分析

### 需求5: API配置和测试

#### 5.1 API动态生成
**文件**: `lowcode-platform-backend/src/api/lowcode/api-config.controller.ts`

**需要实现的功能**:
```typescript
// API配置管理
@Post('generate') // ❌ 自动生成API
@Post('test') // ❌ API测试
@Get(':id/documentation') // ❌ API文档生成
@Post(':id/deploy') // ❌ API部署
```

#### 5.2 API测试界面
**文件**: `frontend/src/views/lowcode/api-test/index.vue`

**需要创建的功能**:
- 在线API测试工具
- 请求参数配置
- 响应结果展示
- 测试用例管理

### 需求6: 模板管理完整实现

#### 6.1 模板引擎增强
**文件**: `lowcode-platform-backend/src/api/lowcode/template.controller.ts`

**需要实现的功能**:
```typescript
// 模板管理API  
@Post('preview') // ❌ 模板预览
@Post('validate') // ❌ 模板验证
@Post('import') // ❌ 模板导入
@Get('marketplace') // ❌ 模板市场
```

#### 6.2 模板编辑器
**文件**: `frontend/src/views/lowcode/template/editor.vue`

**需要创建的功能**:
- 在线模板编辑器
- 语法高亮和智能提示
- 模板变量管理
- 实时预览功能

### 需求7: 代码生成器完整实现

#### 7.1 代码生成引擎
**文件**: `lowcode-platform-backend/src/api/lowcode/code-generation.controller.ts`

**需要实现的功能**:
```typescript
// 代码生成API
@Post('generate') // ⚠️ 需完善
@Post('preview') // ⚠️ 需完善  
@Get('progress') // ❌ 生成进度
@Post('download') // ❌ 代码下载
@Post('deploy') // ❌ 直接部署
```

#### 7.2 生成策略支持
- Base-Biz 双层架构
- DDD 领域驱动设计
- Clean Architecture
- 微服务架构

### 需求8: amis-lowcode-backend服务完善

#### 8.1 动态服务生成
**文件**: `amis-lowcode-backend/src/app.module.ts`

**需要实现的功能**:
- 根据lowcode项目动态生成服务
- 热更新机制
- 服务版本管理
- 自动API文档生成

#### 8.2 业务逻辑引擎
**需要创建的功能**:
- 业务规则配置
- 工作流引擎
- 数据验证规则
- 权限控制

## 🚀 实施计划

### 第一阶段: 核心功能完善 (预计3-5天)

#### Day 1: 项目管理和实体管理
- 完善项目管理CRUD API
- 实现实体管理完整功能
- 前端项目列表和实体列表集成

#### Day 2: 字段管理和关系管理  
- 实现字段管理详细配置
- 完善关系管理功能
- 实体关系图可视化

#### Day 3: 查询管理和API配置
- 实现查询构建器
- 完善API配置功能
- API测试界面开发

### 第二阶段: 代码生成和部署 (预计2-3天)

#### Day 4: 模板管理和代码生成
- 完善模板管理功能
- 实现代码生成完整流程
- 生成结果预览和下载

#### Day 5: amis服务集成
- 完善amis-lowcode-backend
- 实现动态服务生成
- 服务部署和监控

### 第三阶段: 集成测试和优化 (预计1-2天)

#### Day 6: 端到端测试
- 完整流程测试
- 性能优化
- Bug修复

#### Day 7: 部署和文档
- 部署脚本完善
- 用户文档更新
- 系统监控配置

## 📊 技术规格要求

### 后端技术要求
- **框架**: NestJS + Fastify
- **数据库**: PostgreSQL + Prisma
- **认证**: JWT
- **架构**: DDD + CQRS + Event Sourcing
- **文档**: Swagger/OpenAPI 3.0
- **测试**: Jest (单元测试 + 集成测试)

### 前端技术要求
- **框架**: Vue 3 + TypeScript
- **构建**: Vite 6
- **UI库**: Naive UI
- **状态管理**: Pinia
- **图表**: AntV X6 (实体关系图)
- **代码编辑**: Monaco Editor

### 部署技术要求
- **容器**: Docker + Docker Compose
- **数据库**: PostgreSQL 13+
- **反向代理**: Nginx (可选)
- **监控**: Health Check + 日志收集

## 🔧 开发环境配置

### 端口分配
- **lowcode-platform-backend**: 3003
- **amis-lowcode-backend**: 9522  
- **frontend**: 5173 (开发) / 3000 (生产)
- **PostgreSQL**: 25432

### 环境变量配置
```bash
# lowcode-platform-backend
DATABASE_URL="postgresql://soybean:soybean@123.@localhost:25432/soybean-admin-nest-backend?schema=lowcode"
JWT_SECRET="your-secret-key"
JWT_EXPIRES_IN="7d"

# amis-lowcode-backend  
DATABASE_URL="postgresql://soybean:soybean@123.@localhost:25432/soybean-admin-nest-backend?schema=amis"
JWT_SECRET="your-secret-key"
PORT=9522
```

## 🧪 测试策略

### 测试类型
1. **单元测试** - 核心业务逻辑
2. **集成测试** - API接口测试
3. **端到端测试** - 完整流程测试
4. **性能测试** - 代码生成性能
5. **安全测试** - 权限和数据安全

### 测试用例设计
- 项目创建到代码生成完整流程
- 实体设计和关系管理
- 模板应用和自定义
- API生成和测试
- 数据迁移和回滚

## 📚 验收标准

### 功能验收
- ✅ 可以创建完整的低代码项目
- ✅ 可以设计实体和关系
- ✅ 可以生成完整的CRUD代码
- ✅ 可以部署和运行生成的服务
- ✅ 前后端完全打通

### 性能验收
- 代码生成时间 < 30秒 (中等复杂度项目)
- API响应时间 < 200ms
- 前端页面加载时间 < 3秒
- 支持并发用户 > 50

### 质量验收  
- 代码覆盖率 > 80%
- 生成代码可编译运行
- 符合代码规范
- 完整的错误处理

## 🔄 持续集成和部署

### CI/CD 流程
1. **代码提交** → **自动测试** → **构建镜像** → **部署测试环境**
2. **集成测试通过** → **部署预生产** → **人工验收** → **生产部署**

### Git 工作流
- **主分支**: main (生产代码)
- **开发分支**: develop (开发集成)
- **功能分支**: feature/* (功能开发)
- **修复分支**: hotfix/* (紧急修复)

## 📋 交付清单

### 代码交付
- [ ] lowcode-platform-backend 完整实现
- [ ] amis-lowcode-backend 完整实现  
- [ ] frontend 完整实现
- [ ] 数据库迁移脚本
- [ ] Docker 部署配置

### 文档交付
- [ ] API 接口文档
- [ ] 用户使用手册
- [ ] 开发者文档
- [ ] 部署运维手册
- [ ] 测试报告

### 其他交付
- [ ] 演示视频
- [ ] 培训材料  
- [ ] 技术支持计划

---

**文档版本**: 1.0  
**创建时间**: 2025-08-22  
**负责人**: 开发团队  
**审核人**: 技术负责人