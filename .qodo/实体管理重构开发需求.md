# å®ä½“ç®¡ç†é‡æ„å¼€å‘éœ€æ±‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºç°æœ‰çš„ä½ä»£ç å¹³å°å®ä½“ç®¡ç†åŠŸèƒ½ï¼Œè¿›è¡Œå…¨é¢çš„UI/UXé‡æ„å’ŒæŠ€æœ¯å‡çº§ã€‚ä¸»è¦ç›®æ ‡æ˜¯ä¼˜åŒ–ç©ºé—´åˆ©ç”¨ç‡ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä½¿ç”¨ç°ä»£åŒ–çš„å›¾å½¢å¼•æ“é‡æ„å®ä½“è®¾è®¡å™¨ã€‚

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### 1. UIå¸ƒå±€é‡æ„
- **ç§»é™¤Tabså¸ƒå±€**: ä¸å†ä½¿ç”¨NTabsç»„ä»¶å±•ç¤ºåˆ—è¡¨è§†å›¾å’Œè®¾è®¡å™¨è§†å›¾
- **é¡¶éƒ¨åˆ‡æ¢æŒ‰é’®**: åœ¨å®ä½“ç®¡ç†é¡µé¢é¡¶éƒ¨å¢åŠ è§†å›¾åˆ‡æ¢æŒ‰é’®ç»„
- **ç©ºé—´ä¼˜åŒ–**: æœ€å¤§åŒ–åˆ©ç”¨é¡µé¢ç©ºé—´ï¼Œæä¾›æ›´å¥½çš„è§†è§‰ä½“éªŒ
- **é»˜è®¤è§†å›¾**: é»˜è®¤å±•ç¤ºè®¾è®¡å™¨çš„å¯è§†åŒ–ç•Œé¢

### 2. å®ä½“è®¾è®¡å™¨é‡æ„
- **æŠ€æœ¯æ ˆå‡çº§**: ä½¿ç”¨Vue3 + AntV X6é‡æ„å®ä½“è®¾è®¡å™¨
- **å¯è§†åŒ–å¢å¼º**: æä¾›æ›´ä¸°å¯Œçš„å›¾å½¢äº¤äº’å’Œè§†è§‰æ•ˆæœ
- **æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒå¤§é‡å®ä½“çš„æµç•…æ¸²æŸ“å’Œæ“ä½œ
- **äº¤äº’æ”¹è¿›**: æ›´ç›´è§‚çš„æ‹–æ‹½ã€è¿çº¿ã€ç¼–è¾‘æ“ä½œ

### 3. å‰åç«¯é€»è¾‘æ¢³ç†
- **æ¥å£è§„èŒƒ**: é‡æ–°æ¢³ç†å’Œä¼˜åŒ–å®ä½“ç®¡ç†ç›¸å…³APIæ¥å£
- **æ•°æ®æµ**: ä¼˜åŒ–å‰åç«¯æ•°æ®äº¤äº’æµç¨‹
- **çŠ¶æ€ç®¡ç†**: å®Œå–„å‰ç«¯çŠ¶æ€ç®¡ç†å’Œæ•°æ®ç¼“å­˜

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
```typescript
// æ ¸å¿ƒæ¡†æ¶
Vue 3.5+ (Composition API)
TypeScript 5.0+
Vite 6+

// UIç»„ä»¶åº“
Naive UI 2.41+

// å›¾å½¢å¼•æ“
AntV X6 2.18+

// çŠ¶æ€ç®¡ç†
Pinia 3.0+

// å·¥å…·åº“
VueUse
Lodash-es
```

### åç«¯æŠ€æœ¯æ ˆ
```typescript
// æ¡†æ¶
NestJS 11.x
Prisma ORM
PostgreSQL

// æ¶æ„æ¨¡å¼
DDD (é¢†åŸŸé©±åŠ¨è®¾è®¡)
CQRS + Event Sourcing
```

## ğŸ“ è¯¦ç»†è®¾è®¡

### 1. é¡µé¢å¸ƒå±€è®¾è®¡

#### 1.1 é¡¶éƒ¨å·¥å…·æ 
```vue
<template>
  <div class="entity-management">
    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <div class="toolbar">
      <div class="view-switcher">
        <NButtonGroup>
          <NButton 
            :type="currentView === 'designer' ? 'primary' : 'default'"
            @click="switchView('designer')"
          >
            <template #icon>
              <NIcon><icon-mdi-vector-polyline /></NIcon>
            </template>
            è®¾è®¡å™¨è§†å›¾
          </NButton>
          <NButton 
            :type="currentView === 'list' ? 'primary' : 'default'"
            @click="switchView('list')"
          >
            <template #icon>
              <NIcon><icon-mdi-table /></NIcon>
            </template>
            åˆ—è¡¨è§†å›¾
          </NButton>
        </NButtonGroup>
      </div>
      
      <div class="actions">
        <NButton type="primary" @click="createEntity">
          <template #icon>
            <NIcon><icon-mdi-plus /></NIcon>
          </template>
          åˆ›å»ºå®ä½“
        </NButton>
        <NButton @click="importEntities">
          <template #icon>
            <NIcon><icon-mdi-import /></NIcon>
          </template>
          å¯¼å…¥å®ä½“
        </NButton>
      </div>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
      <EntityDesigner v-if="currentView === 'designer'" />
      <EntityList v-else-if="currentView === 'list'" />
    </div>
  </div>
</template>
```

#### 1.2 è®¾è®¡å™¨å¸ƒå±€
```vue
<template>
  <div class="entity-designer">
    <!-- å·¦ä¾§å·¥å…·é¢æ¿ -->
    <div class="left-panel">
      <EntityToolbox />
    </div>
    
    <!-- ä¸­å¤®ç”»å¸ƒåŒºåŸŸ -->
    <div class="canvas-area">
      <X6Canvas ref="canvasRef" />
    </div>
    
    <!-- å³ä¾§å±æ€§é¢æ¿ -->
    <div class="right-panel">
      <EntityPropertyPanel />
    </div>
  </div>
</template>
```

### 2. AntV X6 è®¾è®¡å™¨å®ç°

#### 2.1 ç”»å¸ƒåˆå§‹åŒ–
```typescript
// composables/useX6Canvas.ts
import { Graph, Node, Edge } from '@antv/x6'
import { Selection } from '@antv/x6-plugin-selection'
import { Snapline } from '@antv/x6-plugin-snapline'
import { Keyboard } from '@antv/x6-plugin-keyboard'
import { Clipboard } from '@antv/x6-plugin-clipboard'
import { History } from '@antv/x6-plugin-history'

export function useX6Canvas() {
  const graph = ref<Graph | null>(null)
  const container = ref<HTMLElement | null>(null)
  
  /**
   * åˆå§‹åŒ–X6ç”»å¸ƒ
   */
  const initGraph = () => {
    if (!container.value) return
    
    graph.value = new Graph({
      container: container.value,
      width: container.value.clientWidth,
      height: container.value.clientHeight,
      grid: {
        visible: true,
        type: 'doubleMesh',
        args: [
          {
            color: '#E7E8EA',
            thickness: 1,
          },
          {
            color: '#CBCED3',
            thickness: 1,
            factor: 4,
          },
        ],
      },
      selecting: {
        enabled: true,
        rubberband: true,
        movable: true,
        showNodeSelectionBox: true,
      },
      connecting: {
        router: 'manhattan',
        connector: {
          name: 'rounded',
          args: {
            radius: 8,
          },
        },
        anchor: 'center',
        connectionPoint: 'anchor',
        allowBlank: false,
        snap: {
          radius: 20,
        },
        createEdge() {
          return new Edge({
            attrs: {
              line: {
                stroke: '#A2B1C3',
                strokeWidth: 2,
                targetMarker: {
                  name: 'block',
                  width: 12,
                  height: 8,
                },
              },
            },
            zIndex: 0,
          })
        },
        validateConnection({ targetMagnet }) {
          return !!targetMagnet
        },
      },
      highlighting: {
        magnetAdsorbed: {
          name: 'stroke',
          args: {
            attrs: {
              fill: '#5F95FF',
              stroke: '#5F95FF',
            },
          },
        },
      },
      resizing: true,
      rotating: true,
      history: true,
      clipboard: true,
      keyboard: true,
    })
    
    // æ³¨å†Œæ’ä»¶
    graph.value
      .use(new Selection({ enabled: true, multiple: true, rubberband: true }))
      .use(new Snapline({ enabled: true }))
      .use(new Keyboard({ enabled: true }))
      .use(new Clipboard({ enabled: true }))
      .use(new History({ enabled: true }))
  }
  
  return {
    graph,
    container,
    initGraph
  }
}
```

#### 2.2 å®ä½“èŠ‚ç‚¹å®šä¹‰
```typescript
// components/EntityNode.ts
import { Node } from '@antv/x6'

/**
 * å®ä½“èŠ‚ç‚¹ç±»
 */
export class EntityNode extends Node {
  constructor(options: EntityNodeOptions) {
    super({
      ...options,
      shape: 'entity-node',
      width: 200,
      height: 'auto',
      attrs: {
        body: {
          stroke: '#5F95FF',
          strokeWidth: 1,
          fill: '#EFF4FF',
          rx: 6,
          ry: 6,
        },
        header: {
          fill: '#5F95FF',
          height: 40,
          rx: 6,
          ry: 6,
        },
        title: {
          fontSize: 14,
          fontWeight: 'bold',
          fill: '#FFFFFF',
          textAnchor: 'middle',
          textVerticalAnchor: 'middle',
        },
        fields: {
          fontSize: 12,
          fill: '#262626',
        },
      },
      markup: [
        {
          tagName: 'rect',
          selector: 'body',
        },
        {
          tagName: 'rect',
          selector: 'header',
        },
        {
          tagName: 'text',
          selector: 'title',
        },
        {
          tagName: 'foreignObject',
          selector: 'fields',
        },
      ],
      ports: {
        groups: {
          top: {
            position: 'top',
            attrs: {
              circle: {
                r: 4,
                magnet: true,
                stroke: '#5F95FF',
                strokeWidth: 1,
                fill: '#fff',
                style: {
                  visibility: 'hidden',
                },
              },
            },
          },
          right: {
            position: 'right',
            attrs: {
              circle: {
                r: 4,
                magnet: true,
                stroke: '#5F95FF',
                strokeWidth: 1,
                fill: '#fff',
                style: {
                  visibility: 'hidden',
                },
              },
            },
          },
          bottom: {
            position: 'bottom',
            attrs: {
              circle: {
                r: 4,
                magnet: true,
                stroke: '#5F95FF',
                strokeWidth: 1,
                fill: '#fff',
                style: {
                  visibility: 'hidden',
                },
              },
            },
          },
          left: {
            position: 'left',
            attrs: {
              circle: {
                r: 4,
                magnet: true,
                stroke: '#5F95FF',
                strokeWidth: 1,
                fill: '#fff',
                style: {
                  visibility: 'hidden',
                },
              },
            },
          },
        },
        items: [
          {
            group: 'top',
          },
          {
            group: 'right',
          },
          {
            group: 'bottom',
          },
          {
            group: 'left',
          },
        ],
      },
    })
  }
  
  /**
   * æ›´æ–°å®ä½“å­—æ®µæ˜¾ç¤º
   */
  updateFields(fields: EntityField[]) {
    const fieldsHtml = this.generateFieldsHtml(fields)
    this.attr('fields/html', fieldsHtml)
    
    // åŠ¨æ€è°ƒæ•´èŠ‚ç‚¹é«˜åº¦
    const height = 40 + fields.length * 24 + 20
    this.resize(200, height)
  }
  
  /**
   * ç”Ÿæˆå­—æ®µHTML
   */
  private generateFieldsHtml(fields: EntityField[]): string {
    return `
      <div style="padding: 10px; font-size: 12px;">
        ${fields.map(field => `
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="${field.isPrimaryKey ? 'font-weight: bold; color: #f5222d;' : ''}">
              ${field.isPrimaryKey ? 'ğŸ”‘ ' : ''}${field.name}
            </span>
            <span style="color: #8c8c8c; font-size: 11px;">${field.dataType}</span>
          </div>
        `).join('')}
      </div>
    `
  }
}

// æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹
Node.registry.register('entity-node', EntityNode, true)
```

### 3. çŠ¶æ€ç®¡ç†è®¾è®¡

#### 3.1 å®ä½“ç®¡ç†Store
```typescript
// stores/entityStore.ts
import { defineStore } from 'pinia'
import type { Entity, EntityField, EntityRelationship } from '@/types/entity'

export const useEntityStore = defineStore('entity', () => {
  // çŠ¶æ€
  const entities = ref<Entity[]>([])
  const selectedEntity = ref<Entity | null>(null)
  const currentView = ref<'designer' | 'list'>('designer')
  const loading = ref(false)
  const currentProjectId = ref<string | null>(null)
  
  // è®¡ç®—å±æ€§
  const entitiesByProject = computed(() => {
    if (!currentProjectId.value) return []
    return entities.value.filter(entity => entity.projectId === currentProjectId.value)
  })
  
  const entityCount = computed(() => entitiesByProject.value.length)
  
  const relationshipCount = computed(() => {
    return entitiesByProject.value.reduce((count, entity) => {
      return count + (entity.relationships?.length || 0)
    }, 0)
  })
  
  // æ“ä½œæ–¹æ³•
  
  /**
   * åŠ è½½é¡¹ç›®å®ä½“åˆ—è¡¨
   */
  const loadEntities = async (projectId: string) => {
    loading.value = true
    try {
      const response = await fetchEntitiesByProject(projectId)
      entities.value = response.data
      currentProjectId.value = projectId
    } catch (error) {
      console.error('Failed to load entities:', error)
      throw error
    } finally {
      loading.value = false
    }
  }
  
  /**
   * åˆ›å»ºå®ä½“
   */
  const createEntity = async (entityData: CreateEntityDto) => {
    try {
      const response = await fetchCreateEntity(entityData)
      entities.value.push(response.data)
      return response.data
    } catch (error) {
      console.error('Failed to create entity:', error)
      throw error
    }
  }
  
  /**
   * æ›´æ–°å®ä½“
   */
  const updateEntity = async (entityId: string, entityData: UpdateEntityDto) => {
    try {
      const response = await fetchUpdateEntity(entityId, entityData)
      const index = entities.value.findIndex(e => e.id === entityId)
      if (index > -1) {
        entities.value[index] = response.data
      }
      return response.data
    } catch (error) {
      console.error('Failed to update entity:', error)
      throw error
    }
  }
  
  /**
   * åˆ é™¤å®ä½“
   */
  const deleteEntity = async (entityId: string) => {
    try {
      await fetchDeleteEntity(entityId)
      const index = entities.value.findIndex(e => e.id === entityId)
      if (index > -1) {
        entities.value.splice(index, 1)
      }
      if (selectedEntity.value?.id === entityId) {
        selectedEntity.value = null
      }
    } catch (error) {
      console.error('Failed to delete entity:', error)
      throw error
    }
  }
  
  /**
   * é€‰æ‹©å®ä½“
   */
  const selectEntity = (entity: Entity | null) => {
    selectedEntity.value = entity
  }
  
  /**
   * åˆ‡æ¢è§†å›¾
   */
  const switchView = (view: 'designer' | 'list') => {
    currentView.value = view
  }
  
  return {
    // çŠ¶æ€
    entities,
    selectedEntity,
    currentView,
    loading,
    currentProjectId,
    
    // è®¡ç®—å±æ€§
    entitiesByProject,
    entityCount,
    relationshipCount,
    
    // æ–¹æ³•
    loadEntities,
    createEntity,
    updateEntity,
    deleteEntity,
    selectEntity,
    switchView
  }
})
```

### 4. APIæ¥å£ä¼˜åŒ–

#### 4.1 å®ä½“ç®¡ç†API
```typescript
// api/entity.ts
import { request } from '@/utils/request'
import type { 
  Entity, 
  CreateEntityDto, 
  UpdateEntityDto, 
  EntityListQuery,
  EntityListResponse 
} from '@/types/entity'

/**
 * è·å–é¡¹ç›®å®ä½“åˆ—è¡¨
 */
export function fetchEntitiesByProject(projectId: string): Promise<ApiResponse<Entity[]>> {
  return request.get(`/api/v1/entities/project/${projectId}`)
}

/**
 * è·å–å®ä½“åˆ†é¡µåˆ—è¡¨
 */
export function fetchEntitiesPaginated(
  projectId: string, 
  query: EntityListQuery
): Promise<ApiResponse<EntityListResponse>> {
  return request.get(`/api/v1/entities/project/${projectId}/paginated`, {
    params: query
  })
}

/**
 * è·å–å®ä½“è¯¦æƒ…
 */
export function fetchEntityById(entityId: string): Promise<ApiResponse<Entity>> {
  return request.get(`/api/v1/entities/${entityId}`)
}

/**
 * åˆ›å»ºå®ä½“
 */
export function fetchCreateEntity(data: CreateEntityDto): Promise<ApiResponse<Entity>> {
  return request.post('/api/v1/entities', data)
}

/**
 * æ›´æ–°å®ä½“
 */
export function fetchUpdateEntity(
  entityId: string, 
  data: UpdateEntityDto
): Promise<ApiResponse<Entity>> {
  return request.put(`/api/v1/entities/${entityId}`, data)
}

/**
 * åˆ é™¤å®ä½“
 */
export function fetchDeleteEntity(entityId: string): Promise<ApiResponse<void>> {
  return request.delete(`/api/v1/entities/${entityId}`)
}

/**
 * è·å–å®ä½“è®¾è®¡å™¨æ•°æ®
 */
export function fetchEntityDesignerData(
  projectId: string
): Promise<ApiResponse<EntityDesignerData>> {
  return request.get(`/api/v1/entities/project/${projectId}/designer-data`)
}

/**
 * ä¿å­˜å®ä½“è®¾è®¡å™¨æ•°æ®
 */
export function saveEntityDesignerData(
  projectId: string,
  data: EntityDesignerData
): Promise<ApiResponse<void>> {
  return request.post(`/api/v1/entities/project/${projectId}/designer-data`, data)
}
```

## ğŸ“‹ å¼€å‘ä»»åŠ¡æ¸…å•

### Phase 1: åŸºç¡€é‡æ„ (1-2å‘¨)

#### 1.1 UIå¸ƒå±€é‡æ„
- [ ] ç§»é™¤ç°æœ‰çš„NTabsç»„ä»¶
- [ ] å®ç°é¡¶éƒ¨è§†å›¾åˆ‡æ¢æŒ‰é’®ç»„
- [ ] è°ƒæ•´é¡µé¢å¸ƒå±€å’Œæ ·å¼
- [ ] å®ç°è§†å›¾çŠ¶æ€ç®¡ç†

#### 1.2 ç»„ä»¶ç»“æ„è°ƒæ•´
- [ ] é‡æ„EntityManagementä¸»ç»„ä»¶
- [ ] åˆ†ç¦»EntityDesignerå’ŒEntityListç»„ä»¶
- [ ] ä¼˜åŒ–ç»„ä»¶é—´é€šä¿¡æœºåˆ¶

### Phase 2: X6è®¾è®¡å™¨å¼€å‘ (2-3å‘¨)

#### 2.1 X6ç”»å¸ƒé›†æˆ
- [ ] å®‰è£…å’Œé…ç½®AntV X6
- [ ] å®ç°åŸºç¡€ç”»å¸ƒç»„ä»¶
- [ ] é…ç½®ç”»å¸ƒæ’ä»¶(é€‰æ‹©ã€å¯¹é½çº¿ã€é”®ç›˜ã€å‰ªè´´æ¿ç­‰)

#### 2.2 å®ä½“èŠ‚ç‚¹å¼€å‘
- [ ] è®¾è®¡å®ä½“èŠ‚ç‚¹æ ·å¼
- [ ] å®ç°è‡ªå®šä¹‰EntityNodeç±»
- [ ] æ”¯æŒå­—æ®µåŠ¨æ€æ˜¾ç¤º
- [ ] å®ç°èŠ‚ç‚¹æ‹–æ‹½å’Œè°ƒæ•´å¤§å°

#### 2.3 å…³ç³»è¿çº¿å¼€å‘
- [ ] å®ç°å®ä½“é—´è¿çº¿åŠŸèƒ½
- [ ] æ”¯æŒä¸åŒå…³ç³»ç±»å‹çš„è§†è§‰åŒºåˆ†
- [ ] å®ç°è¿çº¿ç¼–è¾‘å’Œåˆ é™¤

#### 2.4 äº¤äº’åŠŸèƒ½
- [ ] å®ç°èŠ‚ç‚¹é€‰æ‹©å’Œå¤šé€‰
- [ ] æ”¯æŒå³é”®èœå•æ“ä½œ
- [ ] å®ç°æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] æ”¯æŒç”»å¸ƒç¼©æ”¾å’Œå¹³ç§»

### Phase 3: åŠŸèƒ½å®Œå–„ (1-2å‘¨)

#### 3.1 å±æ€§é¢æ¿
- [ ] é‡æ„EntityPropertyPanelç»„ä»¶
- [ ] å®ç°å®ä½“å±æ€§ç¼–è¾‘
- [ ] å®ç°å­—æ®µç®¡ç†åŠŸèƒ½
- [ ] æ”¯æŒå…³ç³»å±æ€§ç¼–è¾‘

#### 3.2 å·¥å…·é¢æ¿
- [ ] å®ç°EntityToolboxç»„ä»¶
- [ ] æä¾›å®ä½“æ¨¡æ¿æ‹–æ‹½
- [ ] å®ç°å¿«æ·æ“ä½œæŒ‰é’®

#### 3.3 æ•°æ®æŒä¹…åŒ–
- [ ] å®ç°è®¾è®¡å™¨æ•°æ®ä¿å­˜
- [ ] æ”¯æŒè‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- [ ] å®ç°ç‰ˆæœ¬å†å²è®°å½•

### Phase 4: åç«¯APIä¼˜åŒ– (1å‘¨)

#### 4.1 æ¥å£æ¢³ç†
- [ ] å®¡æŸ¥ç°æœ‰å®ä½“ç®¡ç†API
- [ ] ä¼˜åŒ–æ•°æ®ä¼ è¾“æ ¼å¼
- [ ] å¢åŠ è®¾è®¡å™¨ä¸“ç”¨æ¥å£

#### 4.2 æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°å¢é‡æ•°æ®æ›´æ–°
- [ ] ä¼˜åŒ–å¤§é‡å®ä½“çš„æŸ¥è¯¢æ€§èƒ½
- [ ] æ·»åŠ æ•°æ®ç¼“å­˜æœºåˆ¶

### Phase 5: æµ‹è¯•å’Œä¼˜åŒ– (1å‘¨)

#### 5.1 åŠŸèƒ½æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™
- [ ] é›†æˆæµ‹è¯•
- [ ] E2Eæµ‹è¯•

#### 5.2 æ€§èƒ½æµ‹è¯•
- [ ] å¤§æ•°æ®é‡æµ‹è¯•
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥
- [ ] æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### 5.3 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] äº¤äº’ç»†èŠ‚ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 1.1 è™šæ‹ŸåŒ–æ¸²æŸ“
```typescript
// å¯¹äºå¤§é‡å®ä½“çš„åœºæ™¯ï¼Œå®ç°è™šæ‹ŸåŒ–æ¸²æŸ“
const useVirtualization = () => {
  const visibleNodes = computed(() => {
    // åªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„èŠ‚ç‚¹
    return entities.value.filter(entity => {
      return isInViewport(entity.position, viewport.value)
    })
  })
  
  return { visibleNodes }
}
```

#### 1.2 å¢é‡æ›´æ–°
```typescript
// å®ç°å¢é‡æ•°æ®æ›´æ–°ï¼Œé¿å…å…¨é‡åˆ·æ–°
const updateEntityIncremental = (entityId: string, changes: Partial<Entity>) => {
  const entity = entities.value.find(e => e.id === entityId)
  if (entity) {
    Object.assign(entity, changes)
    // åªæ›´æ–°å˜åŒ–çš„èŠ‚ç‚¹
    updateNodeInGraph(entityId, changes)
  }
}
```

### 2. æ•°æ®ç»“æ„è®¾è®¡

#### 2.1 å®ä½“æ•°æ®ç»“æ„
```typescript
interface Entity {
  id: string
  projectId: string
  name: string
  code: string
  tableName: string
  description?: string
  category: string
  status: EntityStatus
  
  // è®¾è®¡å™¨ç›¸å…³
  position: { x: number; y: number }
  size: { width: number; height: number }
  style: EntityStyle
  
  // ä¸šåŠ¡æ•°æ®
  fields: EntityField[]
  relationships: EntityRelationship[]
  
  // å…ƒæ•°æ®
  createdAt: string
  updatedAt: string
  createdBy: string
  updatedBy?: string
}

interface EntityField {
  id: string
  entityId: string
  name: string
  code: string
  dataType: string
  length?: number
  precision?: number
  scale?: number
  nullable: boolean
  unique: boolean
  primaryKey: boolean
  autoIncrement: boolean
  defaultValue?: string
  comment?: string
  sortOrder: number
}

interface EntityRelationship {
  id: string
  sourceEntityId: string
  targetEntityId: string
  sourceFieldId: string
  targetFieldId: string
  type: RelationshipType
  name: string
  description?: string
  onDelete: CascadeAction
  onUpdate: CascadeAction
}
```

### 3. é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

#### 3.1 å…¨å±€é”™è¯¯å¤„ç†
```typescript
// å®ç°å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶
const useErrorHandler = () => {
  const handleError = (error: Error, context: string) => {
    console.error(`Error in ${context}:`, error)
    
    // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
    const userMessage = getUserFriendlyMessage(error)
    window.$message?.error(userMessage)
    
    // é”™è¯¯ä¸ŠæŠ¥
    reportError(error, context)
  }
  
  return { handleError }
}
```

#### 3.2 æ“ä½œåé¦ˆ
```typescript
// æä¾›åŠæ—¶çš„æ“ä½œåé¦ˆ
const useOperationFeedback = () => {
  const showSuccess = (message: string) => {
    window.$message?.success(message)
  }
  
  const showLoading = (message: string) => {
    return window.$loading?.start(message)
  }
  
  return { showSuccess, showLoading }
}
```

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### 1. åŠŸèƒ½éªŒæ”¶
- [ ] é¡¶éƒ¨åˆ‡æ¢æŒ‰é’®æ­£å¸¸å·¥ä½œï¼Œé»˜è®¤æ˜¾ç¤ºè®¾è®¡å™¨è§†å›¾
- [ ] è®¾è®¡å™¨æ”¯æŒå®ä½“çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ
- [ ] æ”¯æŒå®ä½“é—´å…³ç³»çš„å¯è§†åŒ–è¿çº¿
- [ ] å±æ€§é¢æ¿èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œç¼–è¾‘å®ä½“/å­—æ®µä¿¡æ¯
- [ ] åˆ—è¡¨è§†å›¾ä¿æŒåŸæœ‰åŠŸèƒ½ä¸å˜
- [ ] æ•°æ®ä¿å­˜å’ŒåŠ è½½åŠŸèƒ½æ­£å¸¸

### 2. æ€§èƒ½éªŒæ”¶
- [ ] æ”¯æŒ100+å®ä½“çš„æµç•…æ¸²æŸ“
- [ ] ç”»å¸ƒæ“ä½œå“åº”æ—¶é—´ < 100ms
- [ ] é¡µé¢åˆå§‹åŠ è½½æ—¶é—´ < 2s
- [ ] å†…å­˜ä½¿ç”¨ç¨³å®šï¼Œæ— æ˜æ˜¾æ³„æ¼

### 3. ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [ ] ç•Œé¢å¸ƒå±€åˆç†ï¼Œç©ºé—´åˆ©ç”¨ç‡é«˜
- [ ] äº¤äº’æ“ä½œç›´è§‚æ˜“æ‡‚
- [ ] é”™è¯¯æç¤ºæ¸…æ™°å‹å¥½
- [ ] æ”¯æŒé”®ç›˜å¿«æ·é”®æ“ä½œ

### 4. å…¼å®¹æ€§éªŒæ”¶
- [ ] æ”¯æŒä¸»æµæµè§ˆå™¨(Chrome, Firefox, Safari, Edge)
- [ ] å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒä¸åŒå±å¹•å°ºå¯¸
- [ ] ä¸ç°æœ‰ç³»ç»ŸåŠŸèƒ½æ— å†²çª

## ğŸš€ éƒ¨ç½²å’Œå‘å¸ƒ

### 1. å¼€å‘ç¯å¢ƒé…ç½®
```bash
# å®‰è£…æ–°ä¾èµ–
pnpm add @antv/x6 @antv/x6-plugin-selection @antv/x6-plugin-snapline
pnpm add @antv/x6-plugin-keyboard @antv/x6-plugin-clipboard @antv/x6-plugin-history

# å¼€å‘è°ƒè¯•
pnpm run dev
```

### 2. æ„å»ºå’Œæµ‹è¯•
```bash
# ç±»å‹æ£€æŸ¥
pnpm run type-check

# å•å…ƒæµ‹è¯•
pnpm run test:unit

# E2Eæµ‹è¯•
pnpm run test:e2e

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm run build
```

### 3. å‘å¸ƒæµç¨‹
1. ä»£ç å®¡æŸ¥å’Œæµ‹è¯•
2. ç‰ˆæœ¬æ ‡è®°å’Œå‘å¸ƒè¯´æ˜
3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
4. åŠŸèƒ½éªŒè¯å’Œç›‘æ§

## ğŸ“ æ–‡æ¡£å’ŒåŸ¹è®­

### 1. æŠ€æœ¯æ–‡æ¡£
- [ ] APIæ¥å£æ–‡æ¡£æ›´æ–°
- [ ] ç»„ä»¶ä½¿ç”¨è¯´æ˜
- [ ] æ¶æ„è®¾è®¡æ–‡æ¡£

### 2. ç”¨æˆ·æ–‡æ¡£
- [ ] åŠŸèƒ½ä½¿ç”¨æŒ‡å—
- [ ] æ“ä½œè§†é¢‘æ•™ç¨‹
- [ ] å¸¸è§é—®é¢˜è§£ç­”

### 3. å¼€å‘è€…æ–‡æ¡£
- [ ] ä»£ç ç»“æ„è¯´æ˜
- [ ] æ‰©å±•å¼€å‘æŒ‡å—
- [ ] è°ƒè¯•å’Œæ•…éšœæ’é™¤

---

**é¡¹ç›®è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ  
**é¢„è®¡å·¥æœŸ**: 6-8å‘¨  
**ä¼˜å…ˆçº§**: é«˜  
**é£é™©è¯„ä¼°**: ä¸­ç­‰ï¼ˆä¸»è¦é£é™©åœ¨äºX6é›†æˆå’Œæ€§èƒ½ä¼˜åŒ–ï¼‰